// ==UserScript==
// @name         Ritsu x Emerald
// @version      0.11.1
// @description  Custom Emerald Chat themes and fixes.
// @author       Atsos/Ritsu, Aqua, Strawberry.
// @icon         https://i.imgur.com/KLtVhho.png
// @match        *://emeraldchat.com/app
// @match        *://www.emeraldchat.com/app
// @namespace    Emerald Bot - Ritsu Project
// @run-at       document-end
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        unsafeWindow
// ==/UserScript==
!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=46)}([function(t,e){t.exports=React},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var r=(s=o,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),i=o.sources.map((function(t){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(t," */")}));return[n].concat(i).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(o)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);o&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},function(t,e){t.exports=ReactDOM},,,function(t,e,n){"use strict";var o=n(1),r=n.n(o)()(!0);r.push([t.i,'._3B6q_5OTXi-a3CXdwPEQy-{margin:2em;text-align:center;color:#e33}._3tf_pFd0gVgIPLUPiJgMkk{height:calc(100% - 46px);overflow:auto}._3Sq5HmxyS1XyN6bIcGdQH2{padding-top:1em}._3eP0_BWRRPqybKC0gcIAwL{width:80px;height:80px}._3eP0_BWRRPqybKC0gcIAwL:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid #8ac;border-color:#8ac transparent #8ac transparent;animation:_3eP0_BWRRPqybKC0gcIAwL 1.2s linear infinite}@keyframes _3eP0_BWRRPqybKC0gcIAwL{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}._3lNXtBAgkogbcB5t6_cJmF{margin-left:.5em;cursor:pointer}',"",{version:3,sources:["webpack://src/components/style.module.scss"],names:[],mappings:"AAAA,yBACE,UAAA,CACA,iBAAA,CACA,UAAA,CAGF,yBACE,wBAAA,CACA,aAAA,CAGF,yBACE,eAAA,CAIF,yBACE,UAAA,CACA,WAAA,CAEF,+BACE,WAAA,CACA,aAAA,CACA,UAAA,CACA,WAAA,CACA,UAAA,CACA,iBAAA,CACA,qBAAA,CACA,8CAAA,CACA,sDAAA,CAEF,mCACE,GACE,sBAAA,CAEF,KACE,wBAAA,CAAA,CAIJ,yBACE,gBAAA,CACA,cAAA",sourcesContent:['.reload-warning {\n  margin: 2em;\n  text-align: center;\n  color: #e33;\n}\n\n.ritsu-menu-container {\n  height: calc(100% - 46px);\n  overflow: auto;\n}\n\n.settings-section {\n  padding-top: 1em;\n}\n\n// spinner thingy\n.lds-dual-ring {\n  width: 80px;\n  height: 80px;\n}\n.lds-dual-ring:after {\n  content: " ";\n  display: block;\n  width: 64px;\n  height: 64px;\n  margin: 8px;\n  border-radius: 50%;\n  border: 6px solid #8ac;\n  border-color: #8ac transparent #8ac transparent;\n  animation: lds-dual-ring 1.2s linear infinite;\n}\n@keyframes lds-dual-ring {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n.permamute-list {\n  margin-left: 0.5em;\n  cursor: pointer;\n}\n'],sourceRoot:""}]),r.locals={reloadWarning:"_3B6q_5OTXi-a3CXdwPEQy-",ritsuMenuContainer:"_3tf_pFd0gVgIPLUPiJgMkk",settingsSection:"_3Sq5HmxyS1XyN6bIcGdQH2",ldsDualRing:"_3eP0_BWRRPqybKC0gcIAwL",permamuteList:"_3lNXtBAgkogbcB5t6_cJmF"},e.a=r},function(t,e,n){var o=n(38);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(29);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(30);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(31);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(32);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(33);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(34);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(35);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(36);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){"use strict";var o,r=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},i=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function a(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},o=[],r=0;r<t.length;r++){var i=t[r],c=e.base?i[0]+e.base:i[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var d=a(u),m={css:i[1],media:i[2],sourceMap:i[3]};-1!==d?(s[d].references++,s[d].updater(m)):s.push({identifier:u,updater:g(m,e),references:1}),o.push(u)}return o}function l(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var r=n.nc;r&&(o.nonce=r)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var s=i(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var u,d=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function m(t,e,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var i=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function f(t,e,n){var o=n.css,r=n.media,i=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var h=null,p=0;function g(t,e){var n,o,r;if(e.singleton){var i=p++;n=h||(h=l(e)),o=m.bind(null,n,i,!1),r=m.bind(null,n,i,!0)}else n=l(e),o=f.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var r=a(n[o]);s[r].references--}for(var i=c(t,e),l=0;l<n.length;l++){var u=a(n[l]);0===s[u].references&&(s[u].updater(),s.splice(u,1))}n=i}}}},function(t,e,n){var o=n(37);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(39);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(40);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(41);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(42);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(43);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(44);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(45);t.exports="string"==typeof o?o:o.toString()},,,,,,function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.adBlocker .emerald-jumbotron-message{display:none}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.picture-upload-info{font-size:14px;font-weight:400;color:"#adb6c7"}.picture-upload-info div{margin-bottom:1em}.picture-upload-error{color:red;font-weight:bold}.picture-upload-error-reason{font-weight:initial}.upload-thing{vertical-align:middle;margin-right:5px}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".top-message{position:absolute;top:2px;font-size:1.5em;font-weight:bold;padding:6px;margin:auto;border:solid 4px #800;border-radius:8px;background-color:#f88;color:#300;cursor:pointer}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.imgBlur div.ritsu-would-blur>img{filter:blur(7px);transition:filter 1s ease}html.imgBlur div:hover.ritsu-would-blur>img{filter:blur(0px)}.room-component-message-text.room-component-message-text,.notification-unit-body.notification-unit-body{overflow:visible}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.showGender .room-component-message-avatar,html.showGender .navigation-notification-unit-image{border-color:#fff;border:2px inset;width:36px;height:36px;margin:-2px 10px -2px -2px}html.showGender .room-component-message-avatar[data-gender=m],html.showGender .navigation-notification-unit-image[data-gender=m]{border-color:#0070ff}html.showGender .room-component-message-avatar[data-gender=f],html.showGender .navigation-notification-unit-image[data-gender=f]{border-color:#ff80ea}html.showGender .room-component-message-avatar{width:42px;height:42px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.hidePfp .room-component-message-left,html.hidePfp .navigation-notification-unit-image{display:none}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".karma-tracker,.karma-delta{display:none}html.trackKarma .karma-tracker{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:1.5em;color:var(--menu-fg-color)}html.trackKarma .karma-delta{display:block;position:absolute;top:50%;left:50%;opacity:1;transform:translateX(-50%) translateY(-50%) scale(0.1);transition:all 2s ease-out;pointer-events:none}html.trackKarma .karma-delta.positive{color:green}html.trackKarma .karma-delta.negative{color:red}html.trackKarma .karma-delta.zoom{opacity:0;transform:translateX(-50%) translateY(-50%) scale(20)}html.trackKarma .notification-unit-body.down{background:#ff808080}html.trackKarma .notification-unit-body.up{background:#80ff8080}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".room-component-message-right{flex-direction:row;justify-content:flex-start;align-items:baseline}.user-badge-container{align-self:center}.user-badge-tick{display:flex;position:static}.room-component-flair{max-width:100%}.jumbo-message:not(.ritsu-message-hidden>*){font-size:5em}.user-extra{padding:0 .5em}html.imgBlur .ritsu-would-blur{filter:blur(4px);transition:filter .3s}html.imgBlur .ritsu-would-blur-heavy{filter:blur(8px);transition:filter .3s}html.imgBlur .ritsu-would-blur:hover,html.imgBlur .ritsu-would-blur-heavy:hover{filter:blur(0px)}.text-only{max-height:8em;overflow:auto !important}div.ritsu-avatar-hidden{color:var(--app-fg-color);font-size:32px;padding:3px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.actionicon-mega:last-child{display:none}.main-logo.main-logo{height:38px}.room-component-message-picture-container{position:relative}.picture-control{display:none;position:absolute;top:0;font-size:2em;font-weight:900}.room-component-message-picture:hover+.picture-control,.picture-control:hover{display:block;cursor:pointer}.picture-button{padding:.5em;border:1px solid var(--app-fg-color);border-radius:2px;background:var(--app-bg-color);color:var(--app-fg-color)}.picture-button.block:hover{color:red}.picture-button.save:hover{color:green}.image-grid div{display:inline-block;width:6em;height:6em;margin:5px;background-size:contain;background-repeat:no-repeat;background-position:center;cursor:pointer}.image-grid div>div{width:unset;height:unset;zoom:.6}.disable-after::after{content:"";display:none}.picker-flair-select{height:3em !important;vertical-align:bottom}.navigation-dropdown-ritsu{color:#f965fec4}.main-logo-text{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:.5em}@media screen and (max-width: 640px){.main-logo-text{display:none}}body.themeChange *{transition:background-color .3s,color .3s,border-color .3s}@media screen and (min-width: 640px){body{overflow:hidden}}body.tmp-message span.room-component-print:last-of-type{margin:-1em 0}.user-profile-micro.user-profile-micro{width:auto}.navigation-notification-badge{position:absolute}.channel-expand-icon{padding:8px}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--ritsu-hair-color: #f965fec4;--ritsu-hair-dark-color: #b821bd}html>body{background:var(--app-bg-color)}body>div>nav{background:var(--header-bg-color)}.room-component-left.room-component-left{background:var(--roomlist-bg-color)}.room-component-center.room-component-center{background:var(--chat-bg-color)}.room-component-right.room-component-right{background:var(--userlist-bg-color)}.room-component-messages{background:var(--chat-bg-color)}.room-notification.room-notification{background:var(--chat-bg-color)}.room-component-print.room-component-print{color:var(--message-fg-color)}.room-component-input{background:var(--input-bg-color)}.room-component-input-textarea.room-component-input-textarea{color:var(--input-fg-color)}.ui-button-match{background:var(--input-bg-color)}#container{background:var(--app-bg-color)}.room-component-container.room-component-container{color:var(--app-fg-color)}.dashboard-button.animated.zoomIn{background:var(--dashboard-button-bg-color)}.navigation-notification-icons.navigation-notification-icons{background:transparent}.ui-search-box{background:var(--search-bg-color);color:var(--search-fg-color)}.side-panel.side-panel{background:var(--panel-bg-color)}.actionicon-mega.actionicon-mega{color:var(--panel-fg-color)}.actionicon-mega.actionicon-mega:hover{background:var(--item-hover-bg-color)}.ui-bg.ui-bg{background:var(--dialog-overlay-bg-color)}.ui-menu.ui-menu,.notification-unit.notification-unit{background:var(--dialog-bg-color);color:var(--dialog-fg-color)}.ui-interests-bg.ui-interests-bg{background:var(--interests-bg-color) !important}.navigation-notification-unit.navigation-notification-unit:hover{background:var(--header-hover-bg-color);color:var(--header-hover-fg-color)}.navigation-notification-unit{color:var(--header-fg-color)}:last-child>.navigation-notification-unit{color:var(--header-hover-fg-color)}.navigation-dropdown-content.navigation-dropdown-content{background:var(--menu-bg-color);color:var(--menu-fg-color)}.dashboard-icon.dashboard-icon{color:var(--dashboard-icon-fg-color)}.dashboard-button.dashboard-button:hover{color:var(--dashboard-hover-fg-color);background:var(--dashboard-hover-bg-color)}.actionicon-icon.actionicon-icon{color:var(--dashboard-icon-fg-color)}.main-hamburger.main-hamburger{color:var(--header-fg-color)}.main-hamburger.main-hamburger:hover,.main-logo.main-logo:hover{background:var(--header-hover-bg-color) !important;color:var(--header-hover-fg-color)}.user-profile-menu.user-profile-menu{background:var(--dialog-bg-color)}.user-micropost-input-background.user-micropost-input-background{background:var(--dialog-input-bg-color)}.user-micropost-input.user-micropost-input{color:var(--dialog-input-fg-color)}.ui-button-micro.ui-button-micro{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.user-profile-tab.user-profile-tab,.ui-tab.ui-tab{color:var(--tab-fg-color)}.user-profile-tab-active.user-profile-tab-active,.ui-tab-active.ui-tab-active{color:var(--tab-active-fg-color)}.ui-button-mega.ui-button-mega:hover{background:var(--dialog-button-hover-bg-color);color:var(--dialog-button-hover-fg-color)}.ui-button-mega.ui-button-mega{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.ui-input.ui-input{background:var(--dialog-input-bg-color) !important}.dashboard-card-image.dashboard-card-image{border-color:var(--dashboard-icon-fg-color)}.user-comment-input-background.user-comment-input-background{background:var(--dialog-input-bg-color)}.user-comment-input.user-comment-input{color:var(--dialog-input-fg-color)}.room-component-left .room-user-label{color:var(--roomlist-title-fg-color)}.room-component-right .room-user-label{color:var(--userlist-title-fg-color)}.picture-upload-button.picture-upload-button+label{background:var(--upload-button-bg-color);color:var(--upload-button-fg-color)}.main-logo-text{color:var(--menu-fg-color)}.navigation-dropdown-ritsu{color:var(--ritsu-menu-fg-color)}.navigation-dropdown-ritsu:hover{color:var(--ritsu-menu-hover-fg-color)}.notification-menu-container-text{color:var(--dialog-fg-color)}.notification-menu-container-text span{text-shadow:#000 0 0 3px}.user-flair.user-flair,.user-extra-gender{text-shadow:-0.05em -0.05em #fff5}.user-profile-picture-wrapper .btn{margin-top:.2rem;margin-bottom:.5rem;color:var(--upload-button-fg-color);border:solid;border-color:#26292f;border-width:2px;background-color:var(--dashboard-icon-bg-color)}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--header-bg-color: #100f10;--header-alt-bg-color: #232529;--header-hover-bg-color: #3d4046;--app-bg-color: black;--dialog-bg-color: #111;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.93);--dialog-button-bg-color: #17191b;--dialog-button-hover-bg-color: #151515;--dialog-input-bg-color: #17191b;--dashboard-button-bg-color: #100f10;--dashboard-hover-bg-color: #33323270;--roomlist-bg-color: black;--chat-bg-color: black;--userlist-bg-color: black;--input-bg-color: #211f21;--search-bg-color: #0b0b0b;--panel-bg-color: #0c0c0c;--item-hover-bg-color: #35383e;--interests-bg-color: #2c2f35;--menu-bg-color: #0a0a0a;--upload-button-bg-color: #41444a;--header-fg-color: white;--header-hover-fg-color: var(--ritsu-hair-color);--app-fg-color: #bebfc5;--dialog-fg-color: #f1f1f2;--dialog-button-fg-color: #d5dcec;--dialog-button-hover-fg-color: var(--ritsu-hair-color);--dialog-input-fg-color: #d7dfec;--dashboard-icon-fg-color: var(--ritsu-hair-color);--dashboard-hover-fg-color: var(--ritsu-hair-color);--roomlist-title-fg-color: #99a3b4;--userlist-title-fg-color: #99a3b4;--tab-fg-color: #c2c8d6;--tab-active-fg-color: var(--ritsu-hair-color);--message-fg-color: #afbacd;--input-fg-color: #caccd0;--search-fg-color: #f0f0f1;--panel-fg-color: white;--menu-fg-color: white;--upload-button-fg-color: #b4bccc;--ritsu-menu-fg-color: var(--ritsu-hair-color);--ritsu-menu-hover-fg-color: var(--ritsu-hair-color)}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--header-bg-color: #bbb;--header-alt-bg-color: #ccc;--header-hover-bg-color: #aaa;--app-bg-color: #ddd;--dialog-bg-color: #ddd;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.5);--dialog-button-bg-color: #cfdeec;--dialog-button-hover-bg-color: #f0f0f0;--dialog-input-bg-color: #cfdeec;--dashboard-button-bg-color: #f0e4f0;--dashboard-hover-bg-color: #cfcdcd70;--roomlist-bg-color: #ccc;--chat-bg-color: #ddd;--userlist-bg-color: #ccc;--input-bg-color: #fff;--search-bg-color: #f7f7f7;--panel-bg-color: #ccc;--item-hover-bg-color: #a3adc0;--interests-bg-color: #aab6ce;--menu-bg-color: #aaa;--upload-button-bg-color: #ccc;--header-fg-color: #333;--header-hover-fg-color: var(--ritsu-hair-dark-color);--app-fg-color: #333;--dialog-fg-color: #333;--dialog-button-fg-color: #000;--dialog-button-hover-fg-color: var(--ritsu-hair-dark-color);--dialog-input-fg-color: #000;--dashboard-icon-fg-color: var(--ritsu-hair-dark-color);--dashboard-hover-fg-color: var(--ritsu-hair-dark-color);--roomlist-title-fg-color: #555;--userlist-title-fg-color: #555;--tab-fg-color: #444;--tab-active-fg-color: var(--ritsu-hair-dark-color);--message-fg-color: #666;--input-fg-color: #222;--search-fg-color: #222;--panel-fg-color: #333;--menu-fg-color: #333;--upload-button-fg-color: #444;--ritsu-menu-fg-color: var(--ritsu-hair-dark-color);--ritsu-menu-hover-fg-color: var(--ritsu-hair-color)}.user-flair.user-flair,.user-extra-gender{text-shadow:1px 1px 1px #000}.actionicon-mega.actionicon-mega:hover{background:#aaa}.ui-button-text.ui-button-text:hover{color:#666}.user-profile-menu.user-profile-menu{background:#ddd;color:#333}.user-micropost-unit.user-micropost-unit{color:#333}.ritsu-menu-container li{color:#666}.ritsu-menu-container li.selected{color:#222}.ritsu-menu-container li:hover{background:#fff}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.lookup-button{border:0;padding:0;background:none;margin-right:.5em;margin-top:-4px}.sort-button{width:20px;height:20px;font-weight:normal;text-transform:none}.sort-button>span{padding:0;margin-top:-4px}.sort-button>div.navigation-dropdown-content{text-align:left;width:180px;top:92px}.sort-button>div.navigation-dropdown-content>div{padding:7px;font-weight:500}.sort-button>div.navigation-dropdown-content>li{display:list-item;list-style:"   "}.sort-button>div.navigation-dropdown-content>li.selected{list-style:"✓"}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".user-profile-bottom{width:100%;height:100%;overflow:clip;max-height:480px}.user-profile-menu{max-height:700px;height:700px}.user-comment-input-background{height:75px}.user-comment-input{resize:none;height:75px;line-height:normal}.user-micropost-input{max-height:133px;min-height:35px}.user-microposts{height:auto;max-height:420px}.room-component-input-textarea{bottom:0;max-height:133px}.room-component-input{bottom:0;height:auto;max-height:133px;min-height:35px;padding-top:4px;padding-bottom:4px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".user-profile-picture-wrapper:hover .user-profile-picture-hover{display:inline-flex}.user-profile-picture-wrapper .user-profile-picture-hover{flex-direction:column;padding:0;justify-content:center;align-items:center}.room-component-message-avatar{color:transparent}#ritsu-profile-picture-upload{display:none}.ritsu-avatar-karma-warning{position:absolute;top:116px;left:0px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"a.ritsu-message-anchor{text-decoration:underline}.material-icons-inline{font-size:inherit}.material-icons{user-select:none}html.largerText .room-component-message-text{font-size:1.3rem}.bio-image{padding:.3em;margin:.5em;background-color:var(--ritsu-hair-color);color:#000;display:inline-block;user-select:none;border-radius:.3em;font-size:.8em}.bio-expand{color:#00abf3;font-weight:bold;cursor:pointer}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".embed{width:auto !important;height:auto !important;object-fit:contain;margin-top:2px}.img-fluid{width:100%;height:100%;max-width:300px;max-height:300px;object-fit:contain}.spotify{width:100%;max-width:300px;border-radius:6px;frameborder:0}",""]),t.exports=o},function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"setPrefix",(function(){return f})),n.d(o,"setLogger",(function(){return h})),n.d(o,"log",(function(){return p})),n.d(o,"info",(function(){return g})),n.d(o,"warning",(function(){return v})),n.d(o,"error",(function(){return b}));var r={};n.r(r),n.d(r,"subscriptable",(function(){return w})),n.d(r,"loggingResponseHandler",(function(){return y})),n.d(r,"noopResponseHandler",(function(){return R}));var i={};n.r(i),n.d(i,"unpack",(function(){return co})),n.d(i,"compress",(function(){return lo})),n.d(i,"parse",(function(){return uo}));var s="ritsu-emerald",a="Ritsu x Emerald",c="RxE",l="0.11.1",u="https://i.imgur.com/KLtVhho.png";let d="",m=console;function f(t){d=t}function h(t){m=t}function p(t){m.log(d,t)}function g(t){m.info(d,t)}function v(t){m.warn(d,t)}function b(t){m.error(d,t)}function w(t){const e=new Set;return{subscribe:t=>{e.add(t)},unsubscribe:t=>{e.delete(t)},handler:(n,o)=>("set"===n.action&&e.forEach(t=>t(n.preference)),t(n,o))}}function y(t,e){const n=t.response;switch(n.status){case 0:return n;case 1:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' (${JSON.stringify(n.saved)}) was invalid. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),"set"===t.action&&v(`Could not set value ${JSON.stringify(n.value)} for preference '${t.preference.key}' because it was invalid.`),n;case 2:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' had the wrong type. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),n;case 3:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' could not be parsed. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),n;case 4:switch(t.action){case"get":b(`Could not read preference '${t.preference.key}' because localStorage could not be accessed. Using value ${JSON.stringify(t.preference.default)}.`);break;case"set":b(`Could not save value ${JSON.stringify(t.response.value)} for preference '${t.preference.key}' because localStorage could not be accessed.`);break;default:k(t.action)}return n;default:return k(n.status)}}function R(t,e){return t.response}function k(t){throw new Error("assertUnreachable: "+t)}var x="undefined"!=typeof unsafeWindow?unsafeWindow:window;function A(t,e){return void 0===e?t:e}function C(t,e){switch(!0){case Number.isNaN(e):return"NaN";case e===1/0:return"Infinity";case e===-1/0:return"-Infinity";default:return e}}function E(t){return JSON.stringify(t,C)}const M=[function(t){return"boolean"==typeof t},function(t){return"number"==typeof t},N,function(t){return"symbol"==typeof t},P,function(t){return void 0===t}];function N(t){return"string"==typeof t}function P(t){return null===t}function U(t){return M.some(e=>e(t))}function _(t,e,n){return o=`${t.name}(${e.name})`,r=n,Object.defineProperty(r,"name",{value:o,writable:!1});var o,r}function S(t){return U(t)?t=>!1:_(S,t,e=>e instanceof t)}function T(t,e){e.constraints=t.concat(A([],e.constraints))}class O{constructor(t){if(""===t.key)throw new TypeError(`Empty preference key in this ${this.getClassName()}:\n${E(t)}`);this.key=t.key,this.default=t.default,this.label=t.label,this.description=A("",t.description),this.constraints=A([],t.constraints),this.dependencies=A([],t.dependencies),this.extras=A({},t.extras);const e=this.validate(t.default);N(e)&&this.invalidValue(t.default,e)}validate(t){const e=this.constraints;for(let n=0,o=e.length;n<o;n++){const o=e[n];if(!o.requirement(t))return o.message(t)}return{value:t}}toValid(t){return N(this.validate(t))?this.default:t}toString(){return`${this.getClassName()} '${this.key}'`}invalidValue(t,e){throw new Error(`${E(t)} is not a valid value for ${this}. Reason: ${e}`)}}class I extends O{constructor(t){const e=A(0,t.minLength),n=A(1/0,t.maxLength),o=[];if(t.multiline||o.push({requirement:t=>!t.includes("\n"),message:t=>"Line breaks are not allowed."}),e>0&&o.push({requirement:t=>t.length>=e,message:t=>`Minimum length is ${e} characters.`}),n<1/0&&o.push({requirement:t=>t.length<=n,message:t=>`Maximum length ${n} exceeded.`}),T(o,t),super(t),e<0)throw new Error(`Parameter 'minLength' cannot be negative, but it was ${e} in ${this}.`);this.multiline=t.multiline,this.maxLength=n,this.minLength=e}getClassName(){return"StringPreference"}toValid(t){const e=t.substring(0,this.maxLength);return super.toValid(this.multiline?e:e.replace(I.REGEX_LINE_BREAKS," "))}fromString(t){return this.validate(t)}}I.REGEX_LINE_BREAKS=/\n+/g;class j extends O{getClassName(){return"BooleanPreference"}}class B extends O{getClassName(){return"ListPreference"}}class L extends O{constructor(t){const e=t.options;if(T([{requirement:t=>e.some(e=>e.value===t),message:t=>E(t)+" is not among the available options."}],t),super(t),e.length<2)throw new Error(`Parameter 'options' has less than two elements in ${this}.`);const n=[];e.forEach(t=>{const e=this.validate(t.value);if(N(e))throw new Error(`Option value ${E(t.value)} in ${this} is invalid. Reason: ${e}`);if(n.indexOf(t.value)>-1)throw new Error(`Multiple options with value ${E(t.value)} in ${this}.`);n.push(t.value)}),this.options=e}getClassName(){return"MultichoicePreference"}toValid(t){return this.default}}class D extends O{static postParse(t,e){return N(e)?e:t.validate(e.value)}constructor(t){T([{requirement:Number.isFinite,message:t=>t+" is not a finite number."}],t),super(t)}}class F extends D{constructor(t){T([F.CONSTRAINT_INTEGER],t),super(t)}getClassName(){return"IntegerPreference"}static parse(t){const e=parseInt(t,10);return Number.isNaN(e)?`"${t}" is not an integer.`:{value:e}}toValid(t){return super.toValid(Math.round(t))}fromString(t){return D.postParse(this,F.parse(t))}}var z;F.CONSTRAINT_INTEGER={requirement:Number.isInteger,message:t=>t+" is not an integer."},function(t){t.OK="OK",t.ABSENT="ABSENT",t.TYPE_ERROR="TYPE_ERROR",t.JSON_ERROR="JSON_ERROR",t.STORAGE_ERROR="STORAGE_ERROR",t.NUMBER_ERROR="NUMBER_ERROR"}(z||(z={}));const G=()=>localStorage;function V(t,e,n){try{const o=function(t,e,n){if(null===t)throw new DOMException;const o=t.getItem(e);if(P(o))return null;const r=JSON.parse(o);if(function t(e){for(const t of M)if(t(e))return e=>t(e);if(S(Array)(e)){const n=e;return e=>S(Array)(e)&&(!(n.length>0)||e.every(t(n[0])))}if(e.constructor===Object)return n=>![void 0,null].includes(n)&&Object.keys(e).every(o=>t(e[o])(n[o]));if(e.constructor instanceof Function)return S(e.constructor);throw new TypeError(t.name+" cannot use this object as reference because it has no constructor: "+JSON.stringify(e))}(n)(r))return r;throw new TypeError("Saved value had wrong type.")}(t(),e,n);return P(o)?{status:"ABSENT",value:n}:{status:"OK",value:o}}catch(t){return{status:S(SyntaxError)(t)?"JSON_ERROR":S(TypeError)(t)?"TYPE_ERROR":"STORAGE_ERROR",value:n}}}function K(t,e,n){try{return function(t,e,n){const o=JSON.stringify(n,(t,e)=>{if("number"==typeof e&&!Number.isFinite(e))throw new RangeError(e.toString());return e});if(null===t)throw new DOMException;t.setItem(e,o)}(t(),e,n),{status:"OK",value:n}}catch(t){return{status:S(RangeError)(t)?"NUMBER_ERROR":S(SyntaxError)(t)||S(TypeError)(t)?"JSON_ERROR":"STORAGE_ERROR",value:n}}}function H(t,e){try{return t().removeItem(e),{status:"OK",value:!0}}catch(t){return{status:"STORAGE_ERROR",value:!1}}}var q;!function(t){t[t.OK=0]="OK",t[t.INVALID_VALUE=1]="INVALID_VALUE",t[t.TYPE_ERROR=2]="TYPE_ERROR",t[t.JSON_ERROR=3]="JSON_ERROR",t[t.STORAGE_ERROR=4]="STORAGE_ERROR"}(q||(q={}));const J=(t,e)=>t.response;function W(t){return`Unknown preference:\n\n${E(t)}.`}function X(t){switch(t){case"OK":case"ABSENT":return 0;case"NUMBER_ERROR":return 1;case"TYPE_ERROR":return 2;case"JSON_ERROR":return 3;case"STORAGE_ERROR":return 4}}var Y=Object.assign(Object.assign(Object.assign(Object.assign({title:`${a} ${l}`,themeTitle:"Choose your theme"},!1),{generalTitle:"General Settings",imagesTitle:"Image Settings",messageTitle:"Message Settings",mutelistTitle:"Permanent Mutes",advancedTitle:"Advanced Settings",preferences:Object.assign(Object.assign({theme:{label:"Theme",description:"Reskin the chat"}},!1),{adBlocker:{label:"Remove ads and nags"},fancyColors:{label:"Choose your own flair color"},imgControl:{label:"Block and favorite images"},imgProtect:{label:"Hide images from low karma accounts"},imgBlur:{label:"Blur user images"},hidePfp:{label:"Hide profile pictures in chat"},showInfo:{label:"Show extra user info"},antiSpam:{label:"Mute spammers automatically"},showGender:{label:"Show gender on profile pictures"},trackKarma:{label:"Show live karma & flash changes"},mutelist:{label:"Perma mute list"},userSort:{label:"Sort users by..","name.asc":"Name Asc.","name.desc":"Name Desc.","age.asc":"Account age Asc.","age.desc":"Account age Desc."},blockReqs:{label:"Block friend requests from new accounts"},highlightMentions:{label:"Highlight your name when you're mentioned"},altpfpBackground:{label:"Choose the background colour for transparent pictures"},bigEmoji:{label:"Jumbo-sized emoji"},hideImageFallback:{label:"Hide your images from non-RxE users"},ignoreURLBlacklist:{label:"Ignore URL blacklist"},imgurAPIKey:{placeholder:"Imgur API Key",label:"Leave blank for default"},muteRegexes:{label:"Mute users matching"},toggleEmbeds:{label:"Show embeds"},largerText:{label:"Increase text size"},showAnimatedImages:{label:"Show GIFs"}}),hiddenChannels:"hidden channels",WFAF:"WFAF ⌛",privateRooms:"Private Rooms 🔒",privateRoomsPrompt:"Enter a private room key:\nOnly people with the key can enter this room.",privateRoomsWarning:"Chat history and user list is not available in unlisted rooms."}),!1),{introduction:{title:"Welcome to RxE.",content:"How do you want to use Emerald?",presetsTitle:"Choose your preset",presets:{safe:{title:"Safe",content:"Block requests from new accounts. Images from low karma accounts are hidden, all others blurred. GIFs and embeds are not shown."},normal:{title:"Normal",content:"Anyone can add you. Images from low karma accounts are hidden. GIFs and embeds are shown."},unsafe:{title:"Wild West",content:"Anyone can add you. No restrictions on images or profile pictures."}}}});const Q=null;var Z;!function(t){t[t.None=0]="None",t[t.Hide=1]="Hide",t[t.Reject=2]="Reject"}(Z||(Z={}));const tt={theme:new I({key:"theme",label:Y.preferences.theme.label,description:Y.preferences.theme.description,default:"ritsu",multiline:!1}),adBlocker:new j({key:"adBlocker",label:Y.preferences.adBlocker.label,default:!0}),fancyColors:new j({key:"fancyColors",label:Y.preferences.fancyColors.label,default:!0}),imgControl:new j({key:"imgControl",label:Y.preferences.imgControl.label,default:!0}),imgProtect:new j({key:"imgProtect",label:Y.preferences.imgProtect.label,default:!0}),imgBlur:new j({key:"imgBlur",label:Y.preferences.imgBlur.label,default:!1}),hidePfp:new j({key:"hidePfP",label:Y.preferences.hidePfp.label,default:!1}),showInfo:new j({key:"showInfo",label:Y.preferences.showInfo.label,default:!0}),antiSpam:new j({key:"antiSpam",label:Y.preferences.antiSpam.label,default:!0}),permaMuteList:new B({key:"permaMuteList",label:Y.preferences.mutelist.label,default:[]}),showGender:new j({key:"showGender",label:Y.preferences.showGender.label,default:!0}),trackKarma:new j({key:"trackKarma",label:Y.preferences.trackKarma.label,default:!0}),blockedHashes:new B({key:"blockedHashes",label:"blockedHashes",default:[]}),savedPictures:new B({key:"savedPictures",label:"savedPictures",default:[]}),userSort:new I({key:"userSort",label:Y.preferences.userSort.label,default:"name.asc",multiline:!1}),blockReqs:new L({key:"blockReqs",label:Y.preferences.blockReqs.label,default:0,options:[{value:Z.None,label:"Off"},{value:Z.Hide,label:"Hide"},{value:Z.Reject,label:"Reject"}]}),highlightMentions:new j({key:"highlightMentions",label:Y.preferences.highlightMentions.label,default:!0}),altpfpBackground:new I({key:"altpfpBackground",label:Y.preferences.altpfpBackground.label,default:"#fff",multiline:!1}),bigEmoji:new j({key:"bigEmoji",label:Y.preferences.bigEmoji.label,default:!0}),toggleEmbeds:new j({key:"toggleEmbeds",label:Y.preferences.toggleEmbeds.label,default:!0}),largerText:new j({key:"largerText",label:Y.preferences.largerText.label,default:!1}),imgurLastUploadTimes:new B({key:"imgurLastUploadTimes",label:"imgurLastUploadTimes",default:[]}),imgurPfpAlbum:new B({key:"imgurPfpAlbum",label:"imgurPfpAlbum",default:[]}),hideImageFallback:new j({key:"hideImageFallback",label:Y.preferences.hideImageFallback.label,default:!1}),imgurDeleteHashes:new B({key:"imgurDeleteHashes",label:"imgurDeleteHashes",default:[]}),ignoreURLBlacklist:new j({key:"ignoreURLBlacklist",label:Y.preferences.ignoreURLBlacklist.label,default:!1}),imgurAPIKey:new I({key:"imgurAPIKey",label:Y.preferences.imgurAPIKey.label,default:"",multiline:!1}),muteRegexes:new B({key:"muteRegexes",label:Y.preferences.muteRegexes.label,default:[]}),showAnimatedImages:new j({key:"showAnimatedImages",label:Y.preferences.showAnimatedImages.label,default:!0}),introductionCompletedVersion:new F({key:"introductionCompletedVersion",label:"introductionCompletedVersion",default:0})},et=Object.assign(Object.assign({},tt),Q),nt=new class{constructor(t,e,n=J){this.localStoragePrefix=e,this.responseHandler=n,this.cache=new Map;const o=[],r=function t(e){return Object.values(e).reduce((e,n)=>e.concat(S(O)(n)?n:t(n.h)),[])}(t);r.forEach(t=>{const e=t.key;if(o.includes(e))throw new Error(`Duplicate preference key ${E(e)}.`);this.cache.set(t,t.default),o.push(e)}),r.forEach(t=>{t.dependencies.forEach(e=>{if(void 0===this.cache.get(e.preference))throw new Error(`Dependency error in ${t}: ${W(e.preference)}`)})})}get(t){return this.getWith(this.responseHandler,t)}set(t,e){this.setWith(this.responseHandler,t,e)}getWith(t,e){return t({action:"get",preference:e,response:this.getRaw(e)},this).value}setWith(t,e,n){t({action:"set",preference:e,response:this.setRaw(e,n)},this)}reset(t){var e;this.getFromCacheOrThrowIfUnknown(t),e=this.localStoragePrefix+t.key,H(G,e)}resetAll(){for(const t of this.cache.keys())this.reset(t)}shouldBeAvailable(t){return t.dependencies.every(t=>t.condition(this.getRaw(t.preference).value))}getRaw(t){const e=this.getFromCacheOrThrowIfUnknown(t),n=(o=this.localStoragePrefix+t.key,r=t.default,V(G,o,r));var o,r;if("OK"===n.status){const e=n.value;return N(t.validate(e))?{status:1,value:t.toValid(e),saved:e}:{status:0,value:e}}return{status:X(n.status),value:e}}setRaw(t,e){if(this.getFromCacheOrThrowIfUnknown(t),N(t.validate(e)))return{status:1,value:e};this.cache.set(t,e);const n=function(t,e){return K(G,t,e)}(this.localStoragePrefix+t.key,e);return{status:X(n.status),value:n.value}}getFromCacheOrThrowIfUnknown(t){const e=this.cache.get(t);if(void 0===e)throw new Error(W(t));return e}}(et,s+"-preference-",r.loggingResponseHandler);var ot=n(0),rt=n.n(ot);const{max:it,min:st}=Math,at=(t,e={})=>Object.assign(document.createElement(t),e),ct=[];function lt(t){ct.push(t),Promise.resolve().then(()=>{if(!ct.length)return;const t=ct.join("\n");ct.length=0,document.head.append(at("style",{type:"text/css",textContent:t}))})}function ut(t,e,n,o=!1){const r=t[e];t[e]=function(...t){const e=o&&n.apply(this,t);let i=null;return o&&!1===e||(i=r.apply(this,t)),o||n.apply(this,t),i}}function dt(t,e){const n=[];for(let o=0;o<t.length;o+=e){const r=t.slice(o,o+e);n.push(r)}return n}function mt(t,e){return dt(t.split(""),e).map(t=>t.join(""))}function ft(t,e,n){return st(n,it(e,t))}let ht;function pt(t){clearTimeout(ht),Promise.resolve().then(()=>null===RoomClient||void 0===RoomClient?void 0:RoomClient.print_append(rt.a.createElement("div",null,t)))}function gt(t){pt(t),document.body.classList.add("tmp-message"),ht=+setTimeout(()=>{null===RoomClient||void 0===RoomClient||RoomClient.print_append(),document.body.classList.remove("tmp-message")},5e3)}const vt=(t=0)=>new Promise(e=>setTimeout(e,t));function bt(t,e,n="Timed out"){return Promise.race([t,vt(e).then(()=>Promise.reject(new Error(n)))])}var wt;function yt(t){return(e,n)=>t(n,e)}!function(t){t.string=(t,e)=>t.localeCompare(e),t.numeric=(t,e)=>t-e}(wt||(wt={}));const Rt=t=>{if(null===t)throw new Error("got null");if(void 0===t)throw new Error("got undefined");if("number"==typeof t&&Number.isNaN(t))throw new Error("got NaN");return t},kt=t=>e=>t===e;function xt(t,e){return(n,o)=>e(t(n),t(o))}function At(t,e,n,o=!1){const r=o?t:Array.from(t),i="asc"===n?e:yt(e);return r.sort(i),r}function Ct(t,e,n,o,r=!1){return At(t,(i=e,s=n,(t,e)=>s(t[i],e[i])),o,r);var i,s}const Et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Mt=Array.from({length:65},(t,e)=>String.fromCodePoint(e+917536)).join("");function Nt(t){const e=btoa(t);let n="";for(let t=0;t<e.length;t+=1){const o=Et.indexOf(e[t]);if(-1===o)return null;n+=Mt[2*o]+Mt[2*o+1]}return n}function $t(t){return"#"+t.map(t=>t.toString(16).padStart(2,"0")).join("")}function Pt(t,e,n,o,r=1){const i=Array.from(t.entries());return function(t,e){const n=document.createElement("canvas"),o=n.getContext("2d");return t(n,o),n.toDataURL(e)}((t,s)=>{t.width=r*e,t.height=r*n,o&&(s.fillStyle=$t(o)),s.fillRect(0,0,r*e,r*n),i.forEach(([t,o])=>{const i=r*(t%e),a=r*~~(t/n);s.fillStyle=$t(o),s.fillRect(i,a,r,r)})})}function Ut(t,e,n,o){return ft(Math.round(t/e),n,o)}function _t(t){return!t.some(t=>t<0||t>255)}function St(t){if(!_t(t))throw new Error("Invalid colour "+t)}function Tt([t,e,n],[o,r,i]){return[t-o,e-r,n-i].map(t=>(t/255)**2).reduce((t,e)=>t+e,0)/3}function Ot(t,e){const n=t.map((t,n)=>[n,Tt(t,e),t]);return n.sort((t,e)=>t[1]-e[1]),n[0]}function It(t,e,n){return new Promise(o=>{t.addEventListener(e,o),n&&n(t)})}function jt(t){return t.includes(null)||t.includes(void 0)?null:t}function Bt(t){return null==t?[]:t.filter(t=>null!=t)}function Lt(t){return+new Date-+new Date(t)}function Dt(t,e,n){let o=!1;return t.flatMap(t=>{o=!o;const r=o?e(t):n(t);return null===r?[]:r instanceof Array?r:[r]})}function Ft(t,e,n){if(0===e.length)return[t];const o=e.flatMap(t=>{if("number"==typeof t){if(void 0===n)throw new Error("Length must not be undefined if matches is of type number[]");return[t,t+n]}const[e,o]=t;return[e,e+o]});o.push(void 0);return o.map((e,n,{[n-1]:o})=>t.slice(null!=o?o:0,e))}function zt(t,e,n,o){const r=Array.from(t.matchAll(e)).map(t=>{if(void 0===t.index)throw new Error("So TypeScript really was right about match.index");return[t.index,t[0].length]});return Dt(Ft(t,r),o,n)}function Gt(t,e,n,o,r=!1){const i=function(t,e,n=!1){let o=n?t:t.toLowerCase();const r=n?e:e.toLowerCase(),i=[];let s=0;for(;o.length>0;){if(s=o.indexOf(r),-1===s)return i;i.push(s+t.length-o.length),o=o.slice(s+Math.max(r.length,1))}return i}(t,e,r);return Dt(Ft(t,i,Math.max(e.length,1)),o,n)}function Vt(t){const e=Math.abs(t)>=1e3?(t/1e3).toPrecision(3)+"K":""+t;return t>=0?"+"+e:""+e}function Kt(t,e){const n=Object.getOwnPropertyNames(t).map(n=>[n,e(n,t[n])]);return Object.fromEntries(n)}function Ht(t){const e=[];for(let n=0;n<t.length;n+=1)for(let o=n+1;o<t.length;o+=1)e.push([t[n],t[o]]);return e}function qt(t,e=""){const n=t.split(e).sort(),o=n.length;return n.filter((t,e,n)=>t!==n[e-1]).map(t=>n.reduce((e,n)=>n===t?e+1:e,0)).map(t=>t/o).reduce((t,e)=>t+-e*Math.log2(e),0)}function Jt(t){const e=(t+t).indexOf(t,1);return e>-1&&e!==t.length?t.length/e:0}const Wt={allowSpace:!1,otherKeysPreventDefault:!1,otherKeysStopPropagation:!1};function Xt(t,{allowSpace:e,otherKeysStopPropagation:n,otherKeysPreventDefault:o}=Wt){return{onClick:t,onKeyUp:r=>{"Enter"===r.key||e&&""===r.key?t(r):(n&&r.stopPropagation(),o&&r.preventDefault())}}}function Yt(...t){if(0===t.length)throw new Error("Must supply at least one RegExp");const e=t[t.length-1],n="string"==typeof e,o=t.slice(0,n?-1:0),r="string"==typeof e?e:e.flags;return new RegExp(o.map(t=>"string"==typeof t?t:t.source).join(""),r)}class Qt extends Error{}function Zt(t){let e=!1,n=null;return()=>(n=e?n:t(),e=!0,n)}function te(t){if("number"!=typeof t)return t}function ee(t){return null===t?NaN:"number"==typeof t?t:t.id}var ne=n(7),oe=n.n(ne);const re=["captcha","youtube","about:blank","open.spotify.com","i.redd.it","ibb.co"];function ie(){if(!nt.get(tt.adBlocker))return;Array.from(document.querySelectorAll("iframe")).forEach(t=>{const{src:e}=t;e&&!re.some(t=>e.includes(t))&&t.remove()})}function se(t){var e;return null!==(e=Array.from(t.matchAll(/\[?rxe-pfp:?([A-Za-z0-9+/=\u{E0020}-\u{E005F}]+)\]?/gu)).map(t=>t[1]).slice(-1)[0])&&void 0!==e?e:null}function ae(t){const e=Array.from(t.matchAll(/\[?rxe-pfp:?([A-Za-z0-9+/=\u{E0020}-\u{E005F}]+)\]?/gu)).map(t=>t.index).filter(t=>void 0!==t).slice(-1)[0];return t.slice(0,e)}async function ce(t,e){return new Promise((n,o)=>{const r={display_name:t.display_name,bio:e,flair:{color:t.flair.color},gender:t.gender};$.ajax({type:"GET",url:"/update_profile?"+$.param(r),dataType:"json",success(){null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(t.id),yo(e),n()},error:()=>o()})})}async function le(t,e){await ce(t,function(t,e){const n=ae(t);return n+("\n"===n[n.length-1]?"":"\n")+(t=>`[rxe-pfp:${t}]`)(e)}(t.bio,e))}var ue;!function(t){t[t.Created=0]="Created",t[t.Alive=1]="Alive",t[t.Destroyed=2]="Destroyed"}(ue||(ue={}));const de=new Map;class me{constructor(t,e=!1){this.state=ue.Created,this.preference=t,e&&this.load()}assertAlive(){if(this.state===ue.Destroyed)throw new Error("Attempted to use destroyed ListPreferenceCache object");if(this.state===ue.Created)throw new Error("Attempted to use uninitialized ListPreferenceCache object")}get store(){return this.assertAlive(),this.realStore}set store(t){this.assertAlive(),this.realStore=t}destroy(){this.assertAlive(),this.state=ue.Destroyed,this.preference&&de.delete(this.preference.key)}load(){const{preference:t}=this;if(de.has(t.key)&&de.get(t.key)!==this)throw new Error(me.ERR_PREF_IN_USE);de.set(t.key,this),this.state=ue.Alive,this.loadFrom(nt.get(this.preference))}save(){nt.set(this.preference,this.asSaved())}}me.ERR_PREF_IN_USE="Cannot create multiple ListPreferenceCache instances     linked to the same preference. Hint: .destroy() the previous instance";class fe extends me{setItem(t,e){this._setItem(t,e),this.save()}addItem(t,e){this.setItem(t,e)}removeItem(t){const e=this._removeItem(t);return this.save(),e}}class he extends me{add(t){this._add(t),this.save()}remove(t){const e=this._remove(t);return this.save(),e}}class pe extends he{hasItem(t){return this.store.has(t)}hasKey(t){return!1}values(){return[...this.store.values()]}entries(){return this.values()}_add(t){this.store.add(t)}_remove(t){return this.store.delete(t)}asSaved(){return this.values()}loadFrom(t){this.store=new Set(t)}}class ge extends fe{hasKey(t){return this.store.has(t)}hasItem(t){return this.values().some(e=>e===t)}getItem(t){return this.store.get(t)}_removeItem(t){return this.store.delete(t)}_setItem(t,e){return this.store.set(t,e)}values(){return[...this.store.values()]}entries(){return[...this.store.entries()]}asSaved(){return[...this.store.entries()]}loadFrom(t){this.store=new Map(t)}static just(t,e){const n=new ge(e,!0);t(n),n.destroy()}static addItem({key:t,item:e},n){return ge.just(n=>n.addItem(t,e),n)}static removeItem({key:t},e){return ge.just(e=>e.removeItem(t),e)}}const ve=t=>`\n\t · ${JSON.stringify(t)} (U+${t.charCodeAt(0).toString(16).padStart(4,"0").toUpperCase()})`;function be(t){return t.replace(/(\S)\.([a-z][a-z])/gi,"$1%2E$2").replace(/https?:\/\//gi,"")}const we=t=>t.replace(/%2E/gi,".").replace(/\s?\(\s?(\.|dot)\s?\)\s?/g,".").replace(/\.\u200b/g,"."),ye=Yt("(?:",["%2E","dot",/\./.source,/ ?\( ?(?:\.|dot) ?\) ?/.source].join("|"),")","").source,Re=/(https?:\/\/)?/.source,ke=/[-a-z0-9@:%_+[\]~#?&=]/.source,xe=()=>Yt(...[/\bi\.ibb\.co\/[a-z0-9]+\/[^\s.]+\.[a-z0-9]+\b/gi,/\bi\.redd\.it\/[a-z0-9]+\.[a-z0-9]+\b/gi,/\bi\.imgur\.com\/[a-z0-9]+\.[a-z0-9]+\b/gi].map(t=>`(${t.source})`).join("|"),"gi"),Ae=()=>nt.get(tt.imgurLastUploadTimes),Ce=()=>Ae().filter(t=>Lt(new Date(t))<=108e5),Ee=()=>Ce().length<50;function Me(){var t;t=[...Ae(),+new Date].slice(-50),nt.set(tt.imgurLastUploadTimes,t)}const Ne=`You can upload 50 new images per ${$.timeago(+new Date-108e5)}.`,$e=()=>nt.get(tt.hideImageFallback),Pe="https://api.imgur.com/3/image/",Ue=Nt("rxe-imgur:"),_e=()=>new RegExp(`imgur${ye}com/([a-z0-9]+)`,"i"),Se=t=>`https://i.imgur.com/${t}.png`,Te=()=>({Authorization:"Client-ID "+(nt.get(tt.imgurAPIKey)||"b8f69bdcc4d1373")});function Oe({id:t,payload:e}){return{url:Se(t),payload:e,version:"0.11.0"}}function Ie(t){return $e()?`${Ue}${Nt(t)}`:be(Se(t))}async function je(t){const e=new FormData;e.append("image",t);const n=await fetch(Pe,{method:"POST",headers:Te(),body:e});if(!n.ok)throw new Error(n.statusText);const{data:o}=await n.json(),{id:r,deletehash:i}=o;return ge.addItem({key:r,item:i},tt.imgurDeleteHashes),Me(),{id:r,payload:Ie(r)}}function Be(t,e=!0){const n=t.match(_e());return n&&Oe({payload:e?Ie(n[1]):be(n[0]),id:n[1]})}function Le(t){var e;const n=Be(t,!1);if(n)return n;const o=null===(e=t.match(new RegExp(Ue+"(\\S*)")))||void 0===e?void 0:e[1];if(void 0===o)return null;return Oe({id:function(t){let e="";for(let n=1;n<t.length;n+=2){const o=Mt.indexOf(t[n]);if(-1===o)throw new Error("bad image path");e+=Et[(o-1)/2]}return atob(e)}(o),payload:o})}const De=["You are uploading your image to ",rt.a.createElement("a",{href:"https://imgurinc.com/privacy"},"Imgur"),". Anyone with the link can save or share it."];var Fe=n(2),ze=n.n(Fe);const Ge="https://github.com/Ritsu-Projects/Public-Releases/",Ve=be(Ge),Ke=(t,e)=>`${e} · ${$e()?"Can't see it":"See just a link"}? Get RxE ${t}+: ${Ve}`;function He(t){const e=/\w/.test(t.payload)?"Image: "+t.payload:`[Image${t.payload}]`;return Math.random()<.5?Ke(t.version,e):e}function qe({url:t}){return rt.a.createElement(MessagePicture,{picture:{url:t}})}function Je({url:t},e=App.user){return{user:e,messages:[],picture:{url:t}}}function We(t){return Le(t)}async function Xe(t){return async function(t){return Oe(await je(t))}(t)}const Ye={ratelimit:Ne,destination:De,lowKarma:"Warning: Due to low karma, images sent by you may be hidden from other users."};var Qe=n(8),Ze=n.n(Qe);const tn=()=>rt.a.createElement(MenuMicro,null,rt.a.createElement(PictureUpload,null));function en(t){const{text:e}=t;return rt.a.createElement("div",null,rt.a.createElement("b",null,"Note"),": ",e)}function nn(t){const{failureReason:e}=t;return rt.a.createElement("div",{className:"picture-upload-error"},rt.a.createElement("div",null,"We couldn't upload your picture."),rt.a.createElement("div",null,"Reason: ",rt.a.createElement("span",{className:"picture-upload-error-reason"},e)))}function on(){lt(Ze.a),Room.prototype.room_input=function(){return rt.a.createElement("div",{className:"room-component-input"},rt.a.createElement("textarea",{id:"room-input",className:"room-component-input-textarea",onMouseDown:()=>this.scroll(),onKeyDown:t=>this.input(t),placeholder:"Say Something..."}),rt.a.createElement("span",{className:"room-component-input-icon material-icons",title:"Attach image",onMouseDown:()=>this.upload_picture(),role:"button",tabIndex:0},"photo_camera"))},PictureUpload.prototype.body=function(){const{failureReason:t}=this.state,e=Ee(),n=rt.a.createElement("div",{className:"picture-upload-info"},rt.a.createElement(en,{text:Ye.destination}),rt.a.createElement(en,{text:Ye.ratelimit}),App.user._karma<10&&rt.a.createElement(en,{text:Ye.lowKarma}),t&&rt.a.createElement(nn,{failureReason:t})),o=e?" Choose a file":` Wait ${$.timeago(function(){const t=Ce().slice(0,-49);if(0===t.length)return 0;const e=Math.max(...t);return+new Date+(108e5-Lt(new Date(e)))}())} before uploading again.`,r=rt.a.createElement("label",{htmlFor:"image"},rt.a.createElement("span",{className:"material-icons upload-thing",style:{cursor:e?"pointer":"not-allowed"}},e?"cloud_upload":"hourglass_top"),o),i=rt.a.createElement("input",{id:"image",className:"picture-upload-button",name:"image",type:"file",accept:"image/*",disabled:!e,onChange:()=>{var t;return e&&(null===(t=this.uploadImage)||void 0===t?void 0:t.call(this))}});return rt.a.createElement("form",{id:"picture_upload",name:"picture_upload","data-remote":"true",method:"post",action:Pe},i,r,n)}}const{min:rn,max:sn}=Math;class an{constructor(t){this.__pointer=0,this.data=t}get pointer(){return this.__pointer}set pointer(t){this.__pointer=t}advance(t=1){return this.pointer+=t,this.data[this.pointer]}read(t=1){const e=this.peek(t);return this.advance(t),e}readExactly(t){const e=this.read(t);if(void 0!==e&&e.length===t)return e}peek(t=1){const e=this.pointer+rn(0,t),n=this.pointer+sn(0,t);return this.data.slice(e,n)}peekExactly(t){const e=this.peek(t);if(void 0!==e&&e.length===t)return e}get length(){return this.data.length}debug(){console.log(`${this.data.slice(0,this.pointer)}[${this.peek()}]${this.data.slice(this.pointer+1)}`)}warnExpected(t,e=1,n=!0){const{data:o,pointer:r}=this,i=n?r-e:r,s=o.slice(i-5,i),a=o.slice(i,i+e).padEnd(e,"_");return console.warn(`${t}: ${s}[${a}]`),null}outOfBounds(){return this.pointer>=this.data.length-1}}const{max:cn,ceil:ln,log2:un}=Math;function dn(t,e,n=cn(0,ln(un(t)))){if(t<0)throw new RangeError("bits can't be negative");const o=~~(n/e),r=2**o-1;return n%e!=0&&console.warn(`bitsplit: splits (${e}) does not divide evenly into relevantBits (${n}).`),Array.from({length:e},(e,n)=>{const i=n*o;return(t&r<<i)>>i}).reverse()}function mn(t,e){return Array.from(t).reverse().map((t,n)=>t<<n*e).reduce((t,e)=>t+e,0)}function fn(t){if(t<0||t>63)throw new RangeError("u8 has to be from 0 to 63");return Et[t]}class hn{constructor(t,e=[]){this.numberBits=t,this._numbers=Array.from(e),this._lastBits=t}get length(){return this._numbers.length}get lastBits(){return this._lastBits}set lastBits(t){if(!(t>0&&t<=this.numberBits))throw new RangeError(`lastBits must be between 1 and ${this.numberBits} (was set to ${t})`);this._lastBits=t}set last(t){this._numbers[this.length-1]=t}get last(){return this._numbers[this.length-1]}push(t){t>1&&console.warn("GroupedBits.push got bit > 1"),this.lastBits===this.numberBits?(this._numbers.push(0),this.lastBits=1):this.lastBits+=1,this.last<<=1,this.last+=1&t}pushNumber(t,e){if(t<0)throw new RangeError("num can't be negative");this.extend(dn(t,e,e))}extend(t){t.forEach(t=>this.push(t))}pushNumbers(t,e){t.forEach(t=>this.pushNumber(t,e))}shift(){if(0===this.length)return;const t=1<<this.numberBits,e=t-1,n=1<<this.lastBits-1;let o=this.last&n?1:0;this.last-=o?n:0;const r=this.length-2;1===this.lastBits?(this._numbers.pop(),this.lastBits=this.numberBits):this.lastBits-=1;for(let n=r;n>=0;n-=1)this._numbers[n]<<=1,this._numbers[n]+=o,o=t&this._numbers[n]?1:0,this._numbers[n]&=e;return o}get numBits(){return(this.length-1)*this.numberBits+this.lastBits}shiftBits(t){const e=[];if(!(this.numBits<t)){for(let n=0;n<t;n+=1)e.push(this.shift());return mn(e,1)}}pop(){if(0===this.length)return;if(1===this.lastBits)return this.lastBits=this.numberBits,this._numbers.pop()?1:0;this.lastBits-=1;const t=1&this.last?1:0;return this.last>>=1,t}consume(t){for(;t.length>0;)this.push(t.pop())}consumeLeft(t){for(;t.length>0;)this.push(t.shift())}reverse(){const t=new hn(this.numberBits);return t.consume(this),t}topUp(){return this.last<<=this.numberBits-this.lastBits,this.lastBits=this.numberBits,this}trim(){return this.lastBits===this.numberBits||(this._numbers.pop(),this.lastBits=this.numberBits),this}toNumber(){return(mn(this._numbers.slice(0,-1),this.numberBits)<<this.lastBits)+this.last}regroup(t){const e=new hn(t);return e.consumeLeft(this),e}get numbers(){return Array.from(this._numbers)}representIndex(t){const e=t===this.length-1;return this.numbers[t].toString(2).padStart(e?this.lastBits:this.numberBits,"0")}debug(t=""){const e=t?t+" ":t;console.log(e+this.numbers.map((t,e)=>this.representIndex(e)).join("."))}}function pn(t,e,n){return new hn(e,t).regroup(n).topUp().numbers}function gn(t){if(!t)return null;const e=Mt.indexOf(t);if(-1!==e)return e;const n=Et.indexOf(t);return-1!==n?n:null}function vn(t){const e=jt(t.split("").map(gn));return e?new Uint8Array(e):null}function bn(t){return Array.from(t).map(fn).join("")}function wn(t){return dn(t,3,6).map(t=>255*t/3)}function yn(t){const[e,n,o]=t.map(t=>ft(Math.round(3*t/255),0,3));return(e<<4)+(n<<2)+o}class Rn{constructor(t,e=[255,255,255]){this.length=t,this.backgroundColour=e,this._pointer=0,this._nextPixel=0,this.pixels=Array.from({length:t}).fill(e)}get nextPixel(){return this._nextPixel}set nextPixel(t){if(t<0)throw new Error("nextPixel can't be negative");if(t>this.pointer)throw new RangeError("nextPixel can't be greater than pointer");if(t>this.length)throw new RangeError("nextPixel can't be out of bounds");this._nextPixel=t}get pointer(){return this._pointer}set pointer(t){if(t<0)throw new RangeError("pointer can't be negative");if(t>this.length)throw new RangeError("pointer can't be out of bounds");if(t<this.nextPixel)throw new RangeError("pointer can't be less than nextPixel");this._pointer=t}_place(t){this.pixels[this.pointer]=Array.from(t),this.pointer+=1,this.nextPixel=this.pointer}_peek(t){return this.pixels.slice(this.pointer,this.pointer+t)}inBounds(t){return t>=0&&t<=this.length}canMoveBy(t){return this.inBounds(this.pointer+t)}remaining(){return this.length-this.pointer}done(){return this.pointer>=this.length}finish(){this.pointer=this.length}seek(t){const e=this.pointer+t,n=this.inBounds(e);return n&&(this._nextPixel=e,this._pointer=e),n}get offset(){const t=this.pointer-this.nextPixel;if(t<0)throw new Error("Offset can't be negative");return t}get skipped(){return this.pixels.slice(this.nextPixel,this.pointer)}toImage(){return Array.from(this.pixels)}getNext(){var t;return null===(t=this._peek(1))||void 0===t?void 0:t[0]}pixelLogAt(t){return`${this.pixels.slice(t-10,t).map($t).join(" ")} [${t}: ${$t(this.pixels[t])}]`}debug(){console.log("backgroundColour",$t(this.backgroundColour)),console.log("nextPixel:",this.pixelLogAt(this.nextPixel)),console.log("pointer:",this.pixelLogAt(this.pointer))}}class kn extends Rn{skip(t){return!!this.canMoveBy(t)&&(this.pixels.fill(this.backgroundColour,this.pointer,this.pointer+t),this.pointer+=t,!0)}placeOne(t){return!!this.canMoveBy(1)&&(this._place(t),!0)}place(t){return!!this.canMoveBy(t.length)&&(t.forEach(t=>this._place(t)),!0)}finish(){this.pixels.fill(this.backgroundColour,this.nextPixel),this.pointer=this.length,this.nextPixel=this.length}}class xn extends Rn{constructor(){super(...arguments),this.lastPreviewed=null,this.lastPreviewTrace=""}static fromImage(t){const e=new xn(t.length);return e.pixels=Array.from(t),e}preview(t){var e;if(this.assertNoLastPreview(),this.lastPreviewTrace=null!==(e=(new Error).stack)&&void 0!==e?e:"",!this.canMoveBy(t))return null;const n=this._peek(t);return this.lastPreviewed=n,Array.from(n)}previewAtMost(t){if(this.done())return null;const e=Math.min(t,this.remaining());return this.preview(e)}peekOne(t=!0){var e,n;const o=null!==(n=null===(e=this.preview(1))||void 0===e?void 0:e[0])&&void 0!==n?n:null;return t||this.backtrack(),o}backtrack(){this.assertLastPreview(),this.lastPreviewed=null}skip(){this.assertLastPreview(),this.pointer+=this.lastPreviewed.length,this.lastPreviewed=null}consume(){this.assertLastPreview(),this.pointer+=this.lastPreviewed.length,this.nextPixel=this.pointer,this.lastPreviewed=null}skipIf(t){t?this.skip():this.backtrack()}skipCount(t){if(!this.canMoveBy(t))throw new Error("Cannot skip by given amount of pixels.");this.pointer+=t}consumeIf(t){t?this.consume():this.backtrack()}consumeCount(t){if(!this.canMoveBy(t))throw new Error("Cannot consume given amount of pixels.");this.pointer+=t,this.nextPixel=this.pointer}consumeSkipped(t){if(this.offset<t)throw new Error("Cannot consume given amount of skipped pixels.");this.nextPixel+=t}lastPreview(){return this.assertLastPreview(),Array.from(this.lastPreviewed)}findNext(t,e=1/0){const n=this.pointer+e;for(let e=this.pointer;e<this.length&&e<n;e+=1)if(t(this.pixels[e]))return e-this.pointer;return null}assertLastPreview(){if(!this.lastPreviewed)throw new Error("No last preview to reference")}assertNoLastPreview(){if(null!==this.lastPreviewed)throw o.error("Last preview happened here: \n"+this.lastPreviewTrace),new Error("Last preview wasn't closed")}}const An={PALETTE_SELECTION:"00",BACKGROUND_SELECTION_STREAM:"1",OFFSET:"01"},Cn={OFFSET:1,BACKGROUND_SELECTION_STREAM:2,PALETTE_SELECTION:3},En=()=>.01,Mn=()=>.5,{round:Nn}=Math,$n={none:(t,[e,n])=>t(Nn(e),Nn(n))},Pn=2,Un=3,_n={colour64:{map(t){const e=(1<<Pn)-1,n=255/e;return t.map(t=>Ut(t,n,0,e)*n)},deserialize:t=>wn(t[0]),serialize:t=>[yn(t)],digits:1},colour512:{map(t){const e=(1<<Un)-1,n=255/e;return t.map(t=>ft(Nn(Ut(t,n,0,e)*n),0,255))},deserialize(t){if(!t)return null;const e=255/((1<<Un)-1);return pn(Array.from(t),6,Un).slice(0,3).map(t=>ft(Nn(t*e),0,255))},serialize(t){const e=(1<<Un)-1,n=255/e;return pn(t.map(t=>Ut(t,n,0,e)),Un,6)},digits:2}};function Sn(t){var e;const{width:n}=t,o=function(t){const e=document.createElement("canvas"),n=e.getContext("2d"),{width:o,height:r}=t;return e.width=o,e.height=r,n.drawImage(t,0,0),n.getImageData(0,0,o,r)}(t),r=null!==(e=function(t){const e=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);return null===e?null:mt(6===e[1].length?e[1]:e[1].replace(/[0-9a-f]/gi,"$&$&"),2).map(t=>parseInt(t,16))}(nt.get(tt.altpfpBackground)))&&void 0!==e?e:[255,255,255];return(t,e)=>{const i=4*(e*n+t),s=Array.prototype.slice.call(o.data,i,i+3),a=o.data[i+3]/255;return 3!==s.length?(console.warn(`Failed getting image data for index ${i} (data[${o.data.length}])`,s),null):(s.forEach((t,e)=>{s[e]=a*t+(1-a)*r[e]}),s)}}function Tn(t,{interpolator:e,width:n,height:o}){const r=Array.from({length:n*o}),i=Sn(t),s=Math.min(t.height/o,t.width/n),[a,c]=[s*n,s*o],l=(t.width-a)/2,u=(t.height-c)/2;for(let t=0;t<n;t+=1)for(let a=0;a<o;a+=1){const o=e(i,[l+t*s,u+a*s],[0,0]);null===o&&console.warn(`Interpolation failed at ${t}, ${a}`),r[a*n+t]=null!=o?o:[0,0,0]}return r}const{ceil:On}=Math,In=Kt(An,(t,e)=>parseInt(e,2)),jn=Kt(An,(t,e)=>e.length),Bn=Kt(Cn,(t,e)=>6*e-jn[t]),Ln=Kt(Bn,(t,e)=>(1<<e)-1),Dn=t=>Object.keys(In).find(e=>(t&(t=>64-(1<<6-jn[t]))(e))==In[e]<<6-jn[e]);{0;const t=Ht(Object.entries(An)).find(([[t,e],[n,o]])=>e.startsWith(o)||o.startsWith(e));if(void 0!==t)throw new Error(`The following header types overlap: ${t[0][0]} and ${t[1][0]}`)}const Fn=_n.colour64,zn=_n.colour512;function Gn(t,e){St(t),St(e);const n=Fn.map(t),o=Tt(t,e),r=Tt(n,e);return Math.min(r,o)<=En()}function Vn(t,e){St(t);const[n,o,r]=Ot(e,t);return o>En()?null:[n,r]}function Kn(t,e){var n;return null!==(n=Vn(t,e))&&void 0!==n?n:Vn(Fn.map(t),e)}class Hn{get name(){return this.constructor.name}}class qn extends Hn{}class Jn extends Hn{constructor(t,e){super(),this.width=Jn.clampSize(t),this.height=Jn.clampSize(e)}get pixels(){return this.width*this.height}toString(){return`${this.width}, ${this.height}`}static clampSize(t){return ft(16*On(t/16),16,128)}static parseSize(t){return 16*(t+1)}static compressSize(t){return t/16-1}representation(){return`${this.name}(${this.width}, ${this.height})`}serialize(){const t=Jn.compressSize(this.width),e=Jn.compressSize(this.height);return console.assert(t<8&&e<8,"width or height of SizeSpecifier token exceed 3 bits"),fn((t<<3)+e)}static readTape(t){const e=gn(t.read());if(null===e)return null;const[n,o]=dn(e,2,6);return new Jn(Jn.parseSize(n),Jn.parseSize(o))}static fromTape(t){var e;return null!==(e=this.readTape(t))&&void 0!==e?e:t.warnExpected("expected size specifier")}}class Wn extends Hn{constructor(t){if(super(),this.colours=t,0===t.length)throw new Error("No colours supplied");if(t.length>Wn.paletteLength)throw new Error("Too many colours supplied");if(t.some(t=>!_t(t)))throw new RangeError("Invalid colour");const e=16-this.colours.length;this.completePalette=[...this.colours,...Array.from({length:e},()=>this.colours.slice(-1)[0])]}representation(){const{name:t,colours:e}=this;return`${t}([${Array.from(e).map($t).join(", ")}])`}serialize(){return bn(this.completePalette.map(Wn.colourSpace.serialize).flat())}static readTape(t){const e=t.readExactly(Wn.expectedDigits);if(!e)return null;const n=jt(e.split("").map(gn));if(!n)return null;const o=jt(dt(n,Wn.colourSpace.digits).map(Wn.colourSpace.deserialize));return o?new Wn(o):null}static fromTape(t){var e;return null!==(e=this.readTape(t))&&void 0!==e?e:t.warnExpected("expected palette specifier",Wn.expectedDigits)}static fromRGB(t){return new Wn(t)}}Wn.paletteLength=16,Wn.expectedDigits=16*zn.digits,Wn.colourSpace=zn;class Xn extends qn{}const Yn=(Qn="PALETTE_SELECTION",(Zn=class t extends Xn{constructor(e){if(super(),this.paletteIndices=e,e.length!==t.expectedColours)throw new Error(`Palette selection size does not match ${t.expectedColours} expected colours: ${e}`);if(e.some(t=>t<0||t>Wn.paletteLength))throw new Error("Invalid palette indicies: "+e)}static matchHeader(t){return Dn(t)===Qn}get name(){return"PALETTE_SELECTION"===Qn?"PaletteSelection":"PaletteSelectionShort"}representation(){return`${this.name}([${this.paletteIndices.join(", ")}])`}serialize(){const t=new hn(6);return t.pushNumber(In[Qn],jn[Qn]),t.pushNumbers(Array.from(this.paletteIndices),4),bn(t.topUp().numbers)}static tryMake(e,n){if(n.length>Wn.paletteLength)throw new Error("Palette too long");if(e.length<t.expectedColours)return null;const o=jt(Array.from(e.slice(0,t.expectedColours)).map(t=>{var e;return null===(e=Kn(t,n))||void 0===e?void 0:e[0]}));return o?new t(o):null}static fromTape(e){const n=this.readTape(e);return null==n?e.warnExpected("expected PaletteSelection token",t.expectedDigits):n}static readTape(e){const n=e.readExactly(t.expectedDigits);if(void 0===n)return null;const o=vn(n);if(null===o)return null;const r=new hn(4);r.pushNumbers(Array.from(o),6);const i=r.shiftBits(jn[Qn]);if(i!==In[Qn])throw new Error(`Bytes read (${null==i?void 0:i.toString(2)}) do not start with palette selection header`);return new t(r.trim().numbers)}renderFrom(t){if(t.length<16)throw new Error("Received incomplete palette");return Array.from(this.paletteIndices).map(e=>t[e])}toPixelBuffer(t,e){return t.place(this.renderFrom(e.palette.completePalette))}static fromPixelBuffer(e,n,o=!1){const{expectedColours:r}=t;if(!(o?e.offset>=r:0===e.offset))return null;const i=o?e.skipped.slice(0,r):e.preview(r);if(!i)return null;const s=n.palette.completePalette,a=t.tryMake(i,s);return o?null!==a&&e.consumeSkipped(r):e.consumeIf(null!==a),a}}).expectedColours=(t=>~~(Bn[t]/4))(Qn),Zn.expectedDigits=Cn[Qn],Zn);var Qn,Zn;class to extends qn{constructor(t,e){if(super(),this.paletteIndex=t,this.length=e,t>16)throw new Error("Invalid palette index");if(e<=0)throw new Error("Length must be positive");if(e>to.maxLength)throw new Error("Length too big")}static matchHeader(t){return"BACKGROUND_SELECTION_STREAM"===Dn(t)}representation(){return`${this.name}(${this.paletteIndex}, ${this.length})`}serialize(){const t=new hn(6);return t.pushNumber(In.BACKGROUND_SELECTION_STREAM,jn.BACKGROUND_SELECTION_STREAM),t.pushNumber(this.paletteIndex,4),t.pushNumber(this.length-1,Bn.BACKGROUND_SELECTION_STREAM-4),bn(t.topUp().numbers)}renderFrom(t){if(t.length<16)throw new Error("Received incomplete palette");return Array.from({length:this.length}).fill(t[this.paletteIndex])}static fromTape(t){const e=this.readTape(t);return null===e&&t.warnExpected("expected BackgroundSelectionStream token",to.expectedDigits),e}static readTape(t){const e=t.readExactly(to.expectedDigits);if(void 0===e)return null;const n=vn(e);if(null===n)return null;const o=new hn(6,Array.from(n)),r=o.shiftBits(jn.BACKGROUND_SELECTION_STREAM);if(r!==In.BACKGROUND_SELECTION_STREAM)throw new Error(`Bytes read (${null==r?void 0:r.toString(2)}) do not start with background selection header`);const i=o.shiftBits(4),s=o.shiftBits(Bn.BACKGROUND_SELECTION_STREAM-4);return void 0===i||void 0===s?null:new to(i,s+1)}toPixelBuffer(t,e){return t.backgroundColour=e.palette.completePalette[this.paletteIndex],t.skip(this.length)}static fromPixelBuffer(t,e,n=!1){if(t.done())throw new Error("Buffer is exhausted");const{offset:o,backgroundColour:r,skipped:i}=t,{completePalette:s}=e.palette;if(o<(n?1:Yn.expectedColours))return null;if(Gn(i[i.length-1],r)||i.pop(),i.some(t=>!Gn(t,r)))throw t.debug(),new Error("Cannot create stream over non-bg colour");const a=Kn(r,s);return t.consumeSkipped(i.length),new to(a[0],i.length)}}to.expectedDigits=Cn.BACKGROUND_SELECTION_STREAM,to.maxLength=1<<Bn.BACKGROUND_SELECTION_STREAM-4;class eo extends qn{constructor(){super(...arguments),this.offset=NaN}}const no=function(t){var e;return(e=class e extends eo{constructor(e,n){if(super(),e<0)throw new RangeError("Offset can't be negative");if(e>Ln[t])throw new Error(`Offset ${e} too big to encode`);this.colour=Fn.map(n),this.offset=e}static matchHeader(e){return Dn(e)===t}get name(){return"OFFSET"===t?"OffsetColour":"OffsetColourLong"}representation(){return`${this.name}(${this.offset}, ${$t(this.colour)})`}serialize(){const n=new hn(6);n.pushNumber(In[t],jn[t]),n.pushNumber(this.offset,Bn[t]),n.topUp();const o=bn([...n.numbers,...Fn.serialize(this.colour)]);if(o.length!==e.expectedDigits)throw new Error(`Expected token serialization of length ${e.expectedDigits}, got "${o}"`);return o}static fromTape(t){const n=this.readTape(t);return n||t.warnExpected("expected OffsetColour token",e.expectedDigits),n}static readTape(n){const o=n.readExactly(Cn[t]);if(!o)return n.advance(Fn.digits),null;const r=vn(o);if(!r)return n.advance(Fn.digits),null;const i=new hn(6);i.pushNumbers(Array.from(r),6);const s=i.shiftBits(jn[t]);if(s!==In[t])throw new Error(`Bytes read (${null==s?void 0:s.toString(2)}) do not start with offset header`);const a=i.toNumber(),c=n.read(Fn.digits);if(null===c)return null;const l=vn(c);if(null===l||l.length!==Fn.digits)return null;const u=Fn.deserialize(Array.from(l));return null===u?null:new e(a,u)}getRGB(){return this.colour}toPixelBuffer(t,e){const n=t.skip(this.offset);return n&&t.placeOne(this.getRGB()),n}static fromPixelBuffer(t,n=!1){const o=n?t.skipped.slice(-1)[0]:t.getNext(),r=n?t.offset-1:t.offset;if(r<0)throw new Error("Can't use last skipped pixel");const i=new e(r,o);return n?t.consumeSkipped(1):t.consumeCount(1),i}}).expectedDigits=Cn[t]+Fn.digits,e.maxOffset=Ln[t],e}("OFFSET"),oo=no;function ro(t){return console.log("tokens:\n",t.map(t=>t instanceof Hn?`${t.representation()}: '${t.serialize()}'`:t).join("\n"))}class io{static serializeTokens(t){console.time("serializeTokens()");const e=t.map(t=>t.serialize()).join("");return console.timeEnd("serializeTokens()"),e}static writeImage(t,e){const{size:n,palette:o}=e,r=o.completePalette[0],i=new kn(e.size.pixels,r);t.forEach(t=>t.toPixelBuffer(i,e));return Pt(i.toImage(),n.width,n.height,r,4)}}var so;!function(t){t[t.BackgroundColour=0]="BackgroundColour",t[t.PaletteColour=1]="PaletteColour",t[t.CustomColour=2]="CustomColour"}(so||(so={}));class ao{static readToken(t,e){if(t.done())throw new Error("Pixel buffer exhausted");const{maxLength:n}=to,{maxOffset:o}=oo,{BackgroundColour:r,CustomColour:i,PaletteColour:s}=so,{offset:a,backgroundColour:c}=t,{completePalette:l}=e.palette,u=function(t,e,n){const o=Kn(t,n);if(null===o)return[so.CustomColour,t];const r=o[1];return function([t,e,n]){return([o,r,i])=>t===o&&e===r&&n===i}(r)(e)?[so.BackgroundColour,e]:[so.PaletteColour,r]}(t.getNext(),c,l),[d,m]=u,f=a-n,h=a-o;if(f>0){if(h>0)throw t.debug(),new Error("Unreachable");n>=o&&console.warn("strangely, this happened (1)");const e=d===r,i=Rt(oo.fromPixelBuffer(t,e));return d===s&&(t.backgroundColour=m),i}if(h<0)return d===r?null:d===i?Rt(oo.fromPixelBuffer(t)):this.backgroundChangeToken(t,e,m);if(n<o&&console.warn("strangely, this happened (2)"),d===r&&f<0)return null;const p=to.fromPixelBuffer(t,e,!0);return d===s&&(t.backgroundColour=m),Rt(p)}static backgroundChangeToken(t,e,n){const o=Zt(()=>to.fromPixelBuffer(t,e)),{offset:r}=t;if(0===r||o())return t.backgroundColour=n,0===r?null:Rt(o());const i=e.palette.completePalette,s=Yn.expectedColours-t.offset;if(s<0)throw t.debug(),new Error("Expected offset less than PaletteSelection's worth, got "+t.offset);const a=t.preview(s);if(null==a?void 0:a.every(t=>Kn(t,i))){t.skip();const n=Yn.fromPixelBuffer(t,e,!0);if(!n)throw new Error("Checks insufficient");return n}a&&t.backtrack();const c=to.fromPixelBuffer(t,e,!0);return c?(t.backgroundColour=n,c):Rt(no.fromPixelBuffer(t))}static toTokens(t,e){console.time(`fromPixels(${e.size.toString()})`);const n=[];for(;!t.done();){const o=t.remaining(),{offset:r}=t,i=this.readToken(t,e);null!==i?n.push(i):t.skipCount(1);const s=t.skipped.slice(-1)[0];if(t.offset&&!Gn(s,t.backgroundColour))throw t.debug(),console.log("Last token",null==i?void 0:i.representation()),ro(Bt(n).slice(-10)),new Error("Last skipped colour is not background color");if(o===t.remaining()&&r===t.offset)throw console.error("Last token",null==i?void 0:i.representation()),t.debug(),new Error("No pixels processed")}for(;this.isFinalTokenUseless(n,t,e);)n.pop();return console.timeEnd(`fromPixels(${e.size.toString()})`),n}static isFinalTokenUseless(t,e,n){var o;const r=t[t.length-1];if(void 0===r)return!1;const i=null===(o=Kn(e.backgroundColour,n.palette.completePalette))||void 0===o?void 0:o[0];if(null===i)throw new Error(`pixels.backgroundColour ${e.backgroundColour} strayed from palette`);return r instanceof to&&r.paletteIndex===i||(!!(r instanceof Yn&&r.paletteIndices.every(kt(i)))||!!(r instanceof eo&&Gn(r.getRGB(),e.backgroundColour)))}static parseMetadata(t){const e=Jn.fromTape(t);if(!e)return null;const n=Wn.fromTape(t);return n?{size:e,palette:n}:null}static parseContent(t){const e=[];for(;!t.outOfBounds();){const n=gn(t.peek());if(null===n)return t.warnExpected("expected valid b64 digit",1,!1);if(no.matchHeader(n)){const n=no.fromTape(t);if(!n)return null;e.push(n)}else if(oo.matchHeader(n)){const n=oo.fromTape(t);if(!n)return null;e.push(n)}else if(Yn.matchHeader(n)){const n=Yn.fromTape(t);if(!n)return null;e.push(n)}else{if(!to.matchHeader(n))return t.warnExpected("unknown header type: 0b"+n.toString(2));{const n=to.fromTape(t);if(!n)return null;e.push(n)}}}return e}}const co=function(t){const e={};return n=>(Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t(n)),e[n])}(t=>{const e=new an(t),n=ao.parseMetadata(e);if(!n)return null;const o=ao.parseContent(e);return null===o?null:io.writeImage(o,n)});async function lo(t,e){const n=await bt(async function(t){const e=new FileReader;if(await It(e,"load",e=>e.readAsDataURL(t)),!e.result)throw new Error("Got no result reading file");return e.result.toString()}(t),5e3,"Could not read file"),r=await bt(async function(t){const e=new Image;return await It(e,"load",e=>{e.src=t}),e}(n),5e3,"Could not load image");x.open(Pt(Tn(r,{interpolator:$n.none,width:r.width,height:r.height}),r.width,r.height));const{pixels:i,metadata:s}=class{static readImage(t,e){console.time("readImage()");const n=new Jn(e.width,e.height),{width:o,height:r}=n;Object.assign(e,{width:o,height:r});const i=Tn(t,e).map(_n.colour512.map);if(0===i.length)throw new Error("Error sampling image");const s=i.map(_n.colour512.serialize).map(t=>t.map(fn).join("")),a=this.selectPalette(s),c=Wn.fromRGB(a),l={pixels:xn.fromImage(i),metadata:{size:n,palette:c}};return console.timeEnd("readImage()"),l}static selectPalette(t){const e=_n.colour512,n=[];let o=function(t){const e={};Array.prototype.forEach.call(t,t=>{var n;const o=(null!==(n=e[t])&&void 0!==n?n:0)+1;e[t]=o});const n=Array.from(Object.entries(e));return Ct(n,"1",wt.numeric,"desc",!0),Array.from(n)}(t).map(([t,e])=>[t,e,1]);for(;n.length<Wn.paletteLength&&o.length>0;){const t=Array.from(vn(o.shift()[0]));n.push(e.deserialize(t)),o=o.map(([t,o])=>{const r=e.deserialize(Array.from(vn(t))),i=n.map(t=>Tt(t,r));return[t,o,Math.min(...i)]}),At(o,xt(([t,e,n])=>e*n**Mn(),wt.numeric),"desc",!0)}return n}}.readImage(r,e),{width:a,height:c}=s.size;const l=[s.size,s.palette],u=ao.toTokens(i,s);const d=[...l,...u];const m=io.serializeTokens(d);return function(t){if(t.length<=7500)return;const{length:e}=t;throw o.warning(`attempted to produce string (${e}): ${t}`),new Qt(`Resolution too big (result would be ${e} characters long)`)}(m),m}function uo(t){return t}const mo="0",fo="i";const ho={0:i,i:{unpack:t=>Se(t),compress:async t=>(await je(t)).id,parse:t=>function(t){const e=t.match(_e());return e?e[1]:null}(t)}};function po(t,e){if(!(e in ho))throw new Error(`Format '${e}' not implemented`);const n=ho[e].parse(t);return null===n?null:e+n}const go={feed:{name:"Feed"},info:{name:"Info"},pictures:{name:"My Album"}};function vo(){const{id:t}=App.user;MenuReactMicro.close(),null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(t)}function bo(...t){return t.map(t=>{return e=t,n=(null===UserProfileReact||void 0===UserProfileReact?void 0:UserProfileReact.state.tab)===t,rt.a.createElement("div",{onMouseDown:null===UserProfileReact||void 0===UserProfileReact?void 0:UserProfileReact.switch_tab.bind(UserProfileReact,e),className:n?"user-profile-tab user-profile-tab-active":"user-profile-tab"},go[e].name);var e,n})}function wo(){PictureAlbum.prototype.set_display_picture=function(t){const e=po(t.url,fo);e&&(le(App.user,e),vo())},PictureAlbum.prototype.delete_picture=function(t){const e=po(t.url,fo),n=[...nt.get(tt.imgurPfpAlbum)];e&&n.includes(e)&&(n.splice(n.indexOf(e),1),nt.set(tt.imgurPfpAlbum,n),vo())},UserProfile.prototype.tabs=function(){const t=["feed","info"];return this.state.data.user.id===App.user.id&&t.push("pictures"),rt.a.createElement("div",null,...bo(...t))},PictureAlbum.prototype.add_to_album=function(){PictureUploader.onUploaded=function(t){const{url:e}=t;yo(e),vo()}},PictureAlbum.prototype.upload_picture=function(){ze.a.render(tn(),document.getElementById("ui-hatch-2"))},PictureAlbum.prototype.componentDidMount=function(){const t=nt.get(tt.imgurPfpAlbum).map(t=>({url:7===t.length?Se(t):Se(t.substring(1))}));this.setState({pictures:t,loaded:!0})}}function yo(t){let e=se(t);const n=t.match(_e());7!==(null==e?void 0:e.length)&&n&&(e="i"+n[1]);const o=nt.get(tt.imgurPfpAlbum);o&&e&&!o.includes(e)&&(nt.set(tt.imgurPfpAlbum,[...o,e]),null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(App.user.id))}n(9);function Ro(t){const e=t instanceof Array?t.join(""):t;return{message:e,uppercase:e.split("").filter(t=>t.toLowerCase()!==t),entropySplit:qt(e,/\s+/),entropy:qt(e),repeating:Jt(e),noLowerCase:e.toUpperCase()===e}}function ko(t){var e,n,o;const r=null===(e=te(t))||void 0===e?void 0:e.created_at;return{accountCreated:r?new Date(r):new Date,id:ee(t),displayName:null!==(o=null===(n=te(t))||void 0===n?void 0:n.display_name)&&void 0!==o?o:""}}var xo,Ao;(Ao=xo||(xo={})).legacy=function(t,{messages:e}){const n=Date.now(),{message:o,uppercase:r}=Ro(e);t.scoreLegacy+=(1e3/(Lt(t.lastMessageTime)||n))**.2,t.scoreLegacy/=Math.max(1/Math.E,Math.E-Math.log(10+o.length+r.length)/4)},Ao.strikeBased=function(t,e){const{max:n,log10:o}=Math,r=Date.now(),{accountCreated:i}=ko(e.user),{message:s,entropySplit:a,noLowerCase:c,repeating:l}=Ro(e.messages),u=r-t.lastMessageTime||1500;if(u<=1e3?t.scoreStrikes+=1:u>2e3&&(t.scoreStrikes=n(0,t.scoreStrikes-o(u))),Lt(i)<6e5){const e=s.length>200;(a<2||l>3)&&e&&(t.scoreStrikes+=1),t.scoreStrikes*=c?3:2}},Ao.experimental=function(t,e){const{max:n,abs:o}=Math,{accountCreated:r}=ko(e.user),i=Ro(e.messages),{entropy:s,uppercase:a}=i,c=i.message.trim(),{length:l}=c,u=l?l**-.2:1,d=l?l/n(a.length+l-3,l):1,m=.75*(Lt(r||new Date)/864e5)**.1,f=s*d*u*m,h=(f+function(t){const{message:e}=Ro(t),n=e.toLowerCase(),r=qt(n)-qt(n+c);return o(r)}(t.lastMessage)*f)/2,p=n(Lt(t.lastMessageTime||r||new Date),500);t.scoreExperimental/=p/2e3,t.scoreExperimental+=1-h,t.scoreExperimental=n(0,t.scoreExperimental)};const Co=[19364487,19422865,11427049,16008266,21550262,21541886,14267520],Eo={},Mo={};function No(t){var e;const{messages:n,user:o}=t;if(void 0===n)return;const r=ee(o),i=Date.now();Eo[r]=null!==(e=Eo[r])&&void 0!==e?e:{scoreLegacy:1,scoreStrikes:0,scoreExperimental:1,lastMessageTime:0,lastMessage:""};const s=Eo[r];xo.legacy(s,t),xo.strikeBased(s,t),xo.experimental(s,t),s.lastMessageTime=i,s.lastMessage=n.join(""),function(t,e){const{id:n,displayName:o}=ko(e),{room:r}=App,i=t.scoreStrikes,s=Co.includes(n),a=r.muted.includes(n),c=!s&&i>=3&&!a&&nt.get(tt.antiSpam),l=i<1&&a&&Mo[n];if(c){if(n===App.user.id)return gt("AutoMute: You would have gotten muted"),void console.log("User would be muted here");Mo[n]=!0,r.mute(n,o,"spam"),gt(`AutoMute: Muted user ${o}.`)}l&&(delete Mo[n],r.unmute(n),gt(`AutoMute: Unmuted user ${o}.`))}(s,o)}function $o(t){const e=ee(t);delete Eo[e]}function Po(t){if(null==(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.id)||"private"===(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.mode))return;const{user:e}=t;"number"!=typeof e&&(e.display_name=e.display_name.replace(/[\u061C\u200E-\u200F\u202A-\u202E\u2066-\u2069]/g,"")),function({user:t,user_disconnected:e}){if(!("state"in RoomChannelMembersClient)||"number"==typeof t)return;if(e)return void gt(`User ${t.display_name} left the chat.`);const n=ee(t),{members:o}=RoomChannelMembersClient.state;o.map(ee).includes(n)||gt(`User ${t.display_name} joined the chat.`),RoomChannelMembersClient.add_member(t)}(t),No(t)}var Uo=n(10),_o=n.n(Uo);const So={};var To;function Oo(t){t.onerror||(t.onerror=async()=>{switch(function(t){return(t=>t.classList.contains("room-component-message-picture"))(t)?To.NoFallbackAvailable:t.src.startsWith("https://robohash.org/")||t.src.startsWith("data:image")?To.AviconFallback:t.src.includes("/avicons_strict/")?To.NoFallbackAvailable:To.RobohashFallback}(t)){case To.RobohashFallback:t.src=`https://robohash.org/yay${t.src}.png?set=set4`;break;case To.AviconFallback:t.src="https://emeraldchat.com/avicons_strict/1.png"}})}function Io(t,e){return!0===So[t.src]?(e&&(t.src=e),!1):!1===So[t.src]&&(t.src="https://emeraldchat.com/avicons_strict/1.png",!0)}function jo(t){if(t.classList.contains("zoomIn"))return;if(!xe().test(t.src))return;const{src:e}=t;Io(t)||async function(t){const e=await fetch(t),n=await e.arrayBuffer(),o=new Uint8Array(n.slice(0,4)),r=Array.from(o).map(t=>t.toString(16)).join("");if(r.startsWith("424d"))return"image/bmp";switch(r){case"89504e47":return"image/png";case"47494638":return"image/gif";case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"25504446":return"application/pdf";default:return}}(e).then(n=>{So[e]="image/gif"!==n,Io(t,e)})}function Bo(){document.querySelectorAll('img[src*="/badges/tick.svg"]').forEach(t=>{var e;const n=t.parentElement;t.outerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.1 146.8">\n<path d="M140 59l-5-5c-2-2-3-3-2-6V39v-1c0-12-10-21-21-22h-11c-2 0-4 0-6-3l-7-7c-4-3-9-5-15-5-5 0-10 2-14 6-3 1-5 3-6 5-3 4-5 5-9 4h-9a25 25 0 00-21 33v1c0 2 0 3-2 5l-5 5-1 2a26 26 0 00-2 29c1 4 4 7 7 10l3 3-1 4c0 15 12 26 26 26h6c3-1 5 0 7 2 3 4 6 7 10 9a22 22 0 0023-1c4-1 8-4 10-8l6-3 6 1c15 0 26-11 26-25v-3c0-2 1-4 3-5l7-9c2-4 4-9 4-14 0-7-2-13-7-18zm-29-9l-37 55c-2 2-3 4-5 4-4 0-6-1-8-3L42 86c-3-3-4-7-1-10s7-3 10 1l13 12c2 2 3 2 4-1l31-46c3-4 6-6 11-3 4 3 3 7 1 11z" fill="#1da0f1"/>\n<path d="M110 39c-4-3-8-1-11 3L68 89c-1 2-2 2-4 0L51 77c-3-4-7-4-10-1s-2 7 1 10l20 20c1 2 3 3 7 3 2 0 3-2 5-4l37-55c2-4 3-8-1-11z" fill="#fefefe"/>\n</svg>',null===(e=null==n?void 0:n.querySelector("svg"))||void 0===e||e.classList.add("user-badge-tick")}),Array.from(document.images).forEach(t=>{var e;Oo(t),t.complete&&0===t.naturalHeight&&(null===(e=t.onerror)||void 0===e||e.call(t,"")),nt.get(tt.showAnimatedImages)||jo(t)})}function Lo(){var t,e;if(!nt.get(tt.fancyColors))return;const n=document.querySelector('label.ui-select[for="flair-select"]');if(!n||"flair-select"!==(null===(t=n.firstElementChild)||void 0===t?void 0:t.id))return;n.htmlFor="flair-select-old";const o=new Event("change",{bubbles:!0}),r=n.cloneNode();r.classList.add("disable-after"),n.firstElementChild.id="flair-select-old",n.style.display="none";const i=at("input",{id:"flair-select",className:"alt-flair-select",value:App.user.flair.color}),s=at("input",{id:"flair-select",type:"color",className:"picker-flair-select",value:App.user.flair.color,oninput:()=>{var t;i.value=s.value,null===(t=n.firstChild)||void 0===t||t.dispatchEvent(o)}});r.append(i,s),null===(e=n.parentElement)||void 0===e||e.insertBefore(r,n.nextSibling),i.oninput=()=>{var t;s.value=i.value,null===(t=n.firstChild)||void 0===t||t.dispatchEvent(o)}}!function(t){t[t.RobohashFallback=0]="RobohashFallback",t[t.AviconFallback=1]="AviconFallback",t[t.NoFallbackAvailable=2]="NoFallbackAvailable"}(To||(To={}));var Do=n(11),Fo=n.n(Do);function zo(t){let e;const n=t.apply(this);return this.props.data?(this.props.data.data&&(e=this.props.data.data.sender.gender),this.props.data.gender&&(e=this.props.data.gender),n.props.children?n.props.children[0].props["data-gender"]=e:n.props["data-gender"]=e,n):n}function Go(t){var e,n,o;const r=(null!==(n=null!==(e=t._karma)&&void 0!==e?e:t.karma)&&void 0!==n?n:0)<10,i=!(null===(o=null==t?void 0:t.display_picture)||void 0===o?void 0:o.includes("emeraldchat.com/uploads"))||r?`https://robohash.org/yay${t.id}.png?set=set4`:t.display_picture,s=ee(App.user)===ee(t);if(r&&!s&&nt.get(tt.imgProtect))return i;if(void 0===t.bio)return console.warn("user.bio is undefined"),i;const a=se(t.bio);if(!a)return i;return function(t){const e=t[0];return e in ho?ho[e].unpack(t.slice(1)):(console.error(`could not unpack image: ${t} (unknown format '${e}')`),null)}(a)||i}function Vo(t,e,n){const o=t.prototype;ut(o,e,(function(...t){n(this,...t).forEach(t=>{void 0!==t&&(function(t){return t&&"object"==typeof t&&"display_picture"in t&&void 0!==t.display_picture&&void 0!==t.bio}(t)?t.display_picture=Go(t):function(t,e,n){var o,r,i;const s=null!==(r=null===(o=null==t?void 0:t.constructor)||void 0===o?void 0:o.displayName)&&void 0!==r?r:null===(i=null==t?void 0:t.construct)||void 0===i?void 0:i.name,a=s?s+".prototype":"(???)",c=e+"()";console.warn(`[interceptDebug] ${a}.${c} got user = `,n)}(o,e,t))})}),!0)}function Ko(){const t=document.querySelector(".main-logo");t&&(function(){const t=document.querySelector(".navigation-notification-icons"),e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(document.fullscreenEnabled&&(null==t?void 0:t.children)&&!Array.from(null==t?void 0:t.children).some(t=>{var e;return null===(e=null==t?void 0:t.textContent)||void 0===e?void 0:e.includes("full")})&&!e){const e=at("span",{className:"material-icons navigation-notification-unit",textContent:"open_in_full",onmousedown:async()=>{document.fullscreenElement?(document.exitFullscreen(),e.textContent="open_in_full"):(await document.body.requestFullscreen(),e.textContent="close_fullscreen")}}),n=at("span");n.append(e),t.prepend(n)}}(),function(t){const e=Go(App.user);t instanceof HTMLImageElement&&t.src!==e&&(t.src=e)}(t),function(){if(document.head.querySelector(`link[rel="icon"][href="${u}"]`))return;document.head.querySelectorAll('link[rel="icon"]').forEach(t=>t.remove());const t=at("link",{rel:"icon",href:u});document.head.prepend(t)}(),function(t){var e;if(document.querySelector(".karma-tracker"))return;const n=at("div",{className:"karma-tracker"});null===(e=null==t?void 0:t.parentElement)||void 0===e||e.insertBefore(n,null==t?void 0:t.nextSibling)}(t),function(t){const e=`${App.user.display_name||"(...)"} - ${c} ${l}`;document.title!==e&&(document.title=e);const n=document.querySelector(".main-logo-text");if(!n){const n=at("div",{className:"main-logo-text",textContent:e});t.parentElement&&t.parentElement.insertBefore(n,t.nextSibling)}n&&n.textContent!==e&&(n.textContent=e)}(t))}var Ho=n(12),qo=n.n(Ho);var Jo=n(13),Wo=n.n(Jo);let Xo=null;function Yo(t){500===t.status&&(App.room&&App.room.leave(App.room.id),x.location.href="/")}function Qo(t){const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(t===Xo)return;null!==Xo&&function(t){const e=at("div",{className:"karma-delta "+(t>0?"positive":"negative"),textContent:Vt(t)});document.body.append(e),setTimeout(()=>e.classList.add("zoom"),250),setTimeout(()=>e.remove(),5e3)}(t-Xo),Xo=t;const n=document.querySelector(".karma-tracker");if(n)if(e){if(!t)return void(n.textContent="");t>0?n.textContent="+"+t:t<=0&&(n.textContent=""+t),n.style.color=t>0?"#3ec435":"#eb3b3b"}else n.textContent=t?"Karma: "+t:""}function Zo(){const{id:t}=App.user;t?$.ajax({type:"GET",url:"/profile_json?id="+t,dataType:"json",success:t=>Qo(t.user.karma),error:t=>Yo(t)}):setTimeout(Zo,500)}function tr(){const t=RoomChannelMembers.prototype.setState;RoomChannelMembers.prototype.setState=function(e){e&&"members"in e&&function(t,e){const n=Bt(t);Bt(e).forEach(t=>{!function(t,e){e.delta=t?e.karma-t.karma:0}(n.find(({id:e})=>e===t.id),t)})}(this.state.members,e.members),t.call(this,e)};const e=UserUnit.prototype.body;UserUnit.prototype.body=function(){const t=e.call(this),n=this.props.data;return n.delta<0&&(t.props.className+=" down"),n.delta>0&&(t.props.className+=" up"),t}}function er(t){var e,n,o;if(!(null===(o=null===(n=null===(e=App.room)||void 0===e?void 0:e.id)||void 0===n?void 0:n.startsWith)||void 0===o?void 0:o.call(n,"channel")))return!1;if(!(RoomChannelMembersClient instanceof rt.a.Component))return!1;const r=+App.room.id.slice(7),i=t.find(({channel:t})=>t.id===r);if(!i)return!1;const s=Bt(RoomChannelMembersClient.state.members);Bt(i.members).forEach(t=>{const e=s.findIndex(({id:e})=>e===t.id);e>-1?s[e]=t:s.push(t)});const a=function(t){const e=RoomChannelMembersClient.state.members_persistent||[],n=t.filter(t=>!e.find(e=>(null==e?void 0:e.id)===t.id)),o=[...e,...n];return o.length>100&&o.splice(0,o.length-100),o}(s);RoomChannelMembersClient.setState({members:s,members_persistent:a});const c=i.members.find(t=>(null==t?void 0:t.id)===App.user.id);return!!c&&(Qo(c.karma),!0)}function nr(t){const e=(n=t.text_channels,RoomChannelSelectClient.state.text_channels.map(t=>{const e=n.find(({channel:e})=>e.id===t.channel.id);if(!e)return t;const{members:o}=e;return Object.assign(Object.assign({},t),{members:o})}));var n;RoomChannelSelectClient.setState({text_channels:e});er(e)||Zo()}function or(){const{id:t}=App.user;t?(setTimeout(or,6e4),RoomChannelMembersClient instanceof rt.a.Component&&$.ajax({type:"GET",url:"channels_default",dataType:"json",success:nr,error:Yo})):setTimeout(or,500)}const rr=/^(?:spotify:|https:\/\/[a-z]+\.spotify\.com\/(track\/|user\/(.*)\/|playlist\/))([a-zA-Z0-9]+)(.*)$/,ir=/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,sr=t=>ir.test(t),ar=t=>rr.test(t),cr=t=>{const e=ir.exec(t);return e?e[6]:null},lr=t=>{const e=rr.exec(t);return e?e[1]+e[3]:null};function ur(t){return sr(t)&&cr(t)?(t=>`<div class="ritsu-youtube-embed embed"> <iframe class="embed-responsive-item" \n  loading="lazy"\n  src="https://www.youtube.com/embed/${cr(t)}"\n  frameborder="0" allowfullscreen></iframe></div>`)(t):ar(t)&&lr(t)?((t,e)=>`<div class="ritsu-spotify-embed spotify embed"><iframe \n  src="https://open.spotify.com/embed/${lr(t)}?utm_source=generator"\n  loading="lazy"\n  height="${e} !important" frameBorder="0" allowfullscreen="" \n  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">\n  </iframe></div>`)(t,(t=>t.includes("playlist")?380:80)(t)):null}class dr extends rt.a.Component{render(){const{href:t}=this.props,e=(t=>/^https?:\/\//.test(t)?t:"https://"+t)(t);try{const o=new URL(e),i=(r=o.host,Array.from(r.matchAll(/[^-._a-zA-Z0-9~]/g)).map(t=>t[0])),s=i.length>0,a=`⚠ Are you sure you want to open this link? ⚠\nNote that shady sites can guess your location and earmark your browser. Beware URLs on safe domains that look like redirects. The site you're about to visit is hosted by ${o.host}.`+((n=i).length>0?"\n⚠ Type this link yourself instead if you don't want to be fooled. ⚠\nThe following characters in the link look suspicious:\n"+n.map(ve):"");return o.protocol.toLowerCase().startsWith("javascript")?t:rt.a.createElement("a",{className:"ritsu-message-anchor",href:s?"#":o.href,target:"_blank",onClick:t=>{confirm(a)&&!s||t.nativeEvent.preventDefault()},rel:"noreferrer"},e)}catch(e){return e instanceof Error&&o.error(e.message),t}var n,r}}const mr=t=>e=>t().some(t=>t.test(e)),fr=mr(()=>[/\//g,/[^.]+?\.[^.]+?\.[^.]+?/g,/\.com|\.org|\.net|\.co\.uk|\.eu|\.us|\.gov|\.io/]),hr=mr(()=>[/emeraldchat/gi,/grabify/gi,/ip-puller/gi,/hackingvision/gi,/iplogger/gi,/bit\.ly/gi,/blasze/gi,/ps3CFW/gi,/powercut/gi,/whatstheirip/gi,/\.gift/gi,/(^|https?:\/\/)\w{3}\.\w{2}(\/|$)/gi]),pr=mr(()=>[/(^|https?:\/\/)(i\.)?ibb\.co(\/|$)/gi]),gr=t=>{const e=we(t),n=t||null;if(!fr(e))return n;if(e.match(/^[^\s@]+@[^\s@]+(\.|(%2E))\u200b?[^\s@]+$/gi))return e;const o=nt.get(tt.ignoreURLBlacklist);return pr(e)||!hr(e)||o?rt.a.createElement(dr,{href:e}):n};function vr(t,e){return zt(t,Yt(Re,`(${ye}|${ke}){2,256}`,ye+"[a-z]{2,}",`\\b(\\/(${ye}|${ke}|\\/)*)?`,"gi"),gr,e)}var br=n(14),wr=n.n(br);function yr(t){const e="channel"===this.state.mode?50:5e3,{messages:n}=this.state;t.forEach(t=>{0===t.messages.length&&t.messages.push(""),n.length>e&&n.shift();const o=n[n.length-1];if(o&&ee(o.user)===ee(t.user)&&!o.picture&&!t.picture&&o.messages.length<16){const e=o.messages,i=e[e.length-1];if(!i||t.messages[0]===i)return;(sr(r=i)||ar(r))&&n.push(t),o.messages.push(t.messages[0])}else n.push(t);var r}),1===t.length?this.state.messages=n:this.setState({messages:n})}function Rr(t){const{user:e,karma:n,colour:o,textShadow:r,timeago:i}=t;return rt.a.createElement("span",{className:"user-extra"},rt.a.createElement("b",null,"(",n,")")," / ",rt.a.createElement("span",{style:{color:o,textShadow:r,whiteSpace:"nowrap"}},i),e.master&&!e.proxy&&rt.a.createElement("b",{style:{color:"#f00"}}," CALLAN "),e.mod&&!e.proxy&&rt.a.createElement("b",{style:{color:"#f00"}}," MOD "))}function kr(){lt(wr.a),Message.prototype.content=function(){var t,e,n;const{picture:o,messages:r,user:i}=this.props.data,s=ee(this.props.data.user)===ee(App.user),a=nt.get(tt.imgProtect),c=(null===(t=te(i))||void 0===t?void 0:t.temp)||(null!==(n=null===(e=te(i))||void 0===e?void 0:e.karma)&&void 0!==n?n:0)<10;return o&&!(!s&&c&&a)?rt.a.createElement(MessagePicture,{picture:o}):o?[rt.a.createElement("div",null,"(Image) ",vr(o.url,t=>t))]:r.map(t=>rt.a.createElement("div",{key:JSON.stringify(t)},this.process(t)))},Message.prototype.render=function(){var t,e,n,o,r,i,s,a,c,l,u;this.props.data.user||console.warn("this.props.data.user may be falsy despite declaration");const d=null!==(t=function(t){if(!("state"in RoomChannelMembersClient))return;const{members:e,members_persistent:n}=RoomChannelMembersClient.state;return(e||n).find(e=>(null==e?void 0:e.id)===t)}(ee(this.props.data.user))||te(this.props.data.user))&&void 0!==t?t:null,m=ee(this.props.data.user)===ee(App.user);let f=!1;App.room.muted.includes(ee(d))&&(f=!0);try{const t=nt.get(tt.muteRegexes)[0];if(t&&(null==d?void 0:d.display_name)){const{source:e,flags:n}=t,o=new RegExp(e,n),r=["","(?:)"].includes(e);o.test(d.display_name)&&!r&&(f=!0)}}catch(t){}const h={string:(null===(e=null==d?void 0:d.display_name)||void 0===e?void 0:e.trim())||"(no name)",flair:null!==(n=null==d?void 0:d.flair)&&void 0!==n?n:{color:""}},p=Vt(null!==(r=null!==(o=null==d?void 0:d._karma)&&void 0!==o?o:null==d?void 0:d.karma)&&void 0!==r?r:0),g=nt.get(tt.imgProtect),v=(null===(i=te(d))||void 0===i?void 0:i.temp)||(null!==(a=null===(s=te(d))||void 0===s?void 0:s.karma)&&void 0!==a?a:0)<10,b=d?function(t){const e=Math.log(+new Date-+new Date(t.created_at)+1);return Math.min(e/Math.log(5e11),1)}(d):0,w=(null==d?void 0:d.created_at)&&new Date(null==d?void 0:d.created_at),y=w&&!Number.isNaN(w.getTime())?$.timeago(w):null,R=`hsl(${256*b}, 50%, 50%)`,k=["room-component-message-text"],{picture:x}=this.props.data;x&&k.push("ritsu-would-blur-heavy"),f&&k.push("ritsu-message-hidden");const A=(null===(c=null==d?void 0:d.display_picture)||void 0===c?void 0:c.startsWith("https://robohash.org/"))||(null===(l=null==d?void 0:d.display_picture)||void 0===l?void 0:l.startsWith("https://emeraldchat.com/avicons_strict/"))||m,C=["room-component-message-avatar"];A||C.push("ritsu-would-blur");const E=!A&&(f||v&&g),M=d?rt.a.createElement(Rr,{user:d,karma:p,timeago:y,color:R,textShadow:"0.005em 0.005em #FFF5"}):null;return rt.a.createElement("div",{className:"room-component-message-container","data-id":null==d?void 0:d.id},rt.a.createElement("div",{className:"room-component-message-left"},E?rt.a.createElement("div",{className:"material-icons room-component-message-avatar ritsu-avatar-hidden",title:"User avatar hidden due to image settings"},"visibility_off"):rt.a.createElement("img",{className:C.join(" "),alt:"User display avatar",src:null==d?void 0:d.display_picture,onMouseDown:t=>d&&UserViewGenerator.generate({event:t,user:d})})),rt.a.createElement("div",{className:"room-component-message-right"},rt.a.createElement("div",{className:"room-component-flair",onMouseDown:t=>d&&UserViewGenerator.generate({event:t,user:d}),role:"button",tabIndex:-1},rt.a.createElement(Flair,{data:h})),rt.a.createElement(Badge,{badge:null!==(u=null==d?void 0:d.badge)&&void 0!==u?u:null}),nt.get(tt.showInfo)&&M,rt.a.createElement("div",{className:k.join(" ")},f?rt.a.createElement("i",null,"Blocked message"):this.content())))},Room.prototype.received=function(t){var e,n,o,r;ee(t.user)!==App.user.id&&t.messages&&(App.room.play_sound("/sfx/simple_alert.wav"),this.append(t),PushNotifications.idle()&&PushNotifications.send(null!==(n=null===(e=te(t.user))||void 0===e?void 0:e.display_name)&&void 0!==n?n:"",{icon:null!==(r=null===(o=te(t.user))||void 0===o?void 0:o.display_picture)&&void 0!==r?r:"",body:t.messages[0]}))}}function xr(){var t,e;const n=document.querySelectorAll(".room-component-message-container"),o=null===(t=null===RoomClient||void 0===RoomClient?void 0:RoomClient.state)||void 0===t?void 0:t.messages;if(null==o?void 0:o.length)for(let t=0;t<o.length;t+=1){const r=null===(e=n[t])||void 0===e?void 0:e.querySelector(".room-component-message-text");if(!r||r.classList.contains("ritsu-message-hidden"))continue;const{messages:i}=o[t],s=r.childNodes;for(;s&&s.length>i.length;)s[0].remove();if(!s||!s[0].classList)return;nt.get(tt.bigEmoji)&&1===i.length&&/^\p{Extended_Pictographic}{1,5}$/u.test(i[0])?s[0].classList.add("jumbo-message"):s[0].classList.remove("jumbo-message")}}const Ar=(()=>{let t=0;return()=>"key-"+ ++t})();function Cr(){Room.prototype.room_messages=function(t="room-component-messages"){let e=null,n="",o=0;return this.state.messages.forEach(t=>{o+=t.messages.length}),this.state.messages_count>o&&this.state.messages.length>0&&(e=rt.a.createElement("div",{role:"button",tabIndex:0,onMouseDown:()=>this.load_messages(o),className:"room-component-load-button"},"Load More (",o," of ",this.state.messages_count,")")),"private"===this.state.mode&&this.state.messages.length<1&&(n=rt.a.createElement("div",{className:"room-notification"},"No messages here yet. Start a conversation!")),RoomChannelSelectClient.state&&"channel"===this.state.mode&&this.state.messages.length<1&&(n=rt.a.createElement("div",{className:"room-notification"},"No messages here yet!")),rt.a.createElement("div",{id:"messages",className:t},rt.a.createElement(MuteButton,null),this.state.print,n,e,this.state.messages.map(t=>(t.user=function(t){var e;const n=null===(e=null===RoomChannelMembersClient||void 0===RoomChannelMembersClient?void 0:RoomChannelMembersClient.state)||void 0===e?void 0:e.members_persistent;return n?(n.forEach(e=>{(null==e?void 0:e.id)===t.user.id&&(t.user=e)}),t.user):t.user}(t),t.key||(t.key=Ar()),rt.a.createElement(Message,{data:t,key:t.key}))),this.state.print_append)},Room.prototype.append=function(t){yr.call(this,[t])}}function Er(){document.querySelectorAll(".room-component-message-text").forEach(t=>{t.childNodes.forEach(t=>{t.classList.contains("text-only")&&(t.querySelector(".embed")||t.querySelector(".room-component-message-picture-container")||t.querySelector(".room-component-message-picture"))&&t.classList.remove("text-only"),t.classList.contains("text-only")||t.classList.contains("room-component-message-picture-container")||t.querySelector(".room-component-message-picture-container")||t.querySelector(".embed")||t.querySelector(".room-component-message-picture")||t.classList.add("text-only")})})}var Mr=n(15),Nr=n.n(Mr),$r=n(5),Pr={insert:"head",singleton:!1},Ur=(Nr()($r.a,Pr),$r.a.locals||{});function _r(){return rt.a.createElement("div",{className:Ur.ldsDualRing})}function Sr(){const t={match:"text",match_video:"video",match_voice:"voice",channel:"",private:""};function e(t){const{channel:e}=t;this.setState({current_channel:e}),"voice"===e.channel_type&&this.voice_connect(t),null===RoomClient||void 0===RoomClient||RoomClient.clear_messages(),$.ajax({type:"GET",url:"channel_json?id="+e.id,dataType:"json",success(t){const{messages:e}=t;RoomChannelMembersClient.setState({members:t.members}),RoomClient&&yr.call(RoomClient,e),null===RoomClient||void 0===RoomClient||RoomClient.scroll()}}),App.room.join("channel"+e.id),RoomClient.state.last_message=null,null===RoomClient||void 0===RoomClient||RoomClient.scroll()}Room.prototype.componentDidMount=function(){this.clear_print();const{mode:e}=this.state,n=t[e];n?this.setState({print:rt.a.createElement(MatchMenu,{data:{queue:n}})}):"channel"===e?this.setState({right_panel:!0,left_panel:!0,print:""}):"private"===e&&(this.setState({right_panel:!0,left_panel:!0}),$.ajax({type:"GET",url:"/default_private_messages?id="+this.props.data.id,dataType:"json",success:function(t){App.room.join(this.props.data.id),yr.call(this,t.messages),this.setState({messages_count:t.messages_count,id:this.props.data.id}),this.scroll()}.bind(this)}))},Room.prototype.trim_messages=function(){const t="channel"===this.state.mode?100:5e3,{messages:e}=this.state;e.length>t&&e.shift(),this.setState({messages:e})},Room.prototype.start_typing=function(t){var e;if(t.id===App.user.id)return;let n;n=null===(e=RoomChannelMembersClient.state.members.find(e=>(null==e?void 0:e.id)===t.id))||void 0===e?void 0:e.display_name,n||(n=t.display_name),this.setState({typing:n}),x.typing_timer=setTimeout(()=>{this.stop_typing()},1e4)},RoomChannelSelect.prototype.join=function(t){App.webrtc.client&&this.voice_disconnect(),this.expand(!1),this.setState({messages:[]}),this.updated=e.bind(this),this.updated(t),this.updated=function(){}}}function Tr(){x.MenuReactMicroStatic||(x.MenuReactMicroStatic={close:()=>null===MenuReactMicro||void 0===MenuReactMicro?void 0:MenuReactMicro.close()}),x.DashboardClient||(x.DashboardClient={setState:()=>{}}),$(x).off("resize").on("resize",()=>{const t=document.getElementById("messages");t&&(t.scrollTop=t.scrollHeight)}),Dashboard.prototype.ads=function(){return rt.a.createElement("div",{})},function(){function t(t){if(!t.updater.isMounted(t))return;const e=ze.a.findDOMNode(t);e&&ze.a.unmountComponentAtNode(e.parentNode)}function e(e){$(e[0]).removeClass("animated fadeIn"),$(e[0]).removeClass("animated fadeOut"),$(e[1]).addClass("animated zoomOut"),setTimeout(t.bind(null,this),70)}function n(){e.call(this,["#menu-micro-bg","#menu-micro"])}function o(e){t(this),e.nativeEvent.stopImmediatePropagation()}Menu.prototype.close=function(){e.call(this,[".ui-bg",".ui-menu"])},UserProfile.prototype.close=function(){e.call(this,[".ui-bg",".user-profile-menu"]),setTimeout(()=>{UserProfileReact=null})},FriendsMenu.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/friends_json",dataType:"json",success:function(t){const{friends:e}=t;t.friends=e.filter(t=>null!==t);const n=this.state.skippedMissing||0,o=e.filter(t=>null===t);this.setState({friends:t.friends,count:t.count,skippedMissing:n+o.length})}.bind(this)})},FriendsMenu.prototype.load_friends=function(){const t=this.state.skippedMissing||0,e=this.state.friends.length+t;$.ajax({type:"GET",url:"/load_friends_json?offset="+e,dataType:"json",success:function(e){if(0===e.length)return;const n=e.filter(t=>null===t),o=e.filter(t=>!n.includes(t)),r={skippedMissing:t+n.length,search:[],friends:[...this.state.friends,...o],count:this.state.count};this.setState(r)}.bind(this)})},MenuMicro.prototype.close=n,MenuMicroStatic.prototype.close=n,UserView.prototype.close=function(){document.removeEventListener("mousedown",this.exit_click,!1),t(this)},UserView.prototype.view_profile=function(){const{id:e}=this.state.user;UserProfileReact?UserProfileReact.switch(e):ze.a.render(rt.a.createElement(UserProfile,{key:e,id:e}),document.getElementById("ui-hatch")),t(this)},Popup.prototype.close=o,Picture.prototype.close=o,UserView.prototype.exit_click=function(t){t.target instanceof HTMLElement&&(t.target.matches(".user-profile-micro, .user-profile-micro *")||this.close())},UserProfile.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/profile_json?id="+this.props.id,dataType:"json",success:t=>this.setState({data:t}),error:()=>this.close()})},UserProfile.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/profile_json?id="+this.props.id,dataType:"json",success:t=>this.setState({data:t}),error:()=>this.close()})};const r=t=>/posted on your profile.*/g.test(t),i=t=>/liked your comment.*/g.test(t);NotificationUnit.prototype.action=function(t){var e,n,o,s,a;const{target:c}=t;if(!(c instanceof Node))return;const l=c instanceof Element?c:c.parentElement;if(!l)return;if(l.matches(".notification-button, .notification-button *"))return;const u=this.props.data;let d=null!==(e=u.data.sender)&&void 0!==e?e:u.data.user;const{content:m}=u.data;if((r(m)||i(m))&&(d=u.data.user),!("unit"in u.data)||"friend_request"===u.tier)return void(d?UserViewGenerator.generate({event:t,user:d}):console.error("Could not get notification user for UserView."));"unit"in u.data&&(App.params=u.data.unit);let f=null!==(a=null!==(o=null===(n=u.data.unit)||void 0===n?void 0:n.post.author_id)&&void 0!==o?o:null===(s=u.data.unit)||void 0===s?void 0:s.comment.author_id)&&void 0!==a?a:u.data.sender.id;(r(m)||i(m))&&(f=u.data.user.id),UserProfileReact&&UserProfileReact.load(f);const h=rt.a.createElement(UserProfile,{id:f});ze.a.render(h,document.getElementById("ui-hatch"))}}(),App.karma.data[0].range[1]=-1/0,App.temp.check=()=>{},Flair.prototype.render=function(){const{data:{flair:t,string:e},onClick:n}=this.props;return rt.a.createElement("span",{className:"user-flair",style:null!=t?t:{color:""},onClick:n},e)},UserProfile.prototype.render=function(){const t=this.state.data?[this.top(),this.bottom()]:[rt.a.createElement(_r)];return rt.a.createElement("div",{className:"ui-menu-container"},rt.a.createElement("div",{onMouseDown:this.close.bind(this),className:"animated fadeIn ui-bg"}),rt.a.createElement("div",{className:"animated zoomIn user-profile-menu"},...t))},CommentSettings.prototype.authorized=function(){var t;const e=this.props.parent,{micropost_data:n,comment_data:o}=e.state,{wall:r,current_user:i}=n;return i.mod||i.master||null!=r&&(null===(t=null==o?void 0:o.user)||void 0===t?void 0:t.id)===i.id},Sr()}const Or=new pe(tt.blockedHashes),Ir=new pe(tt.savedPictures);const jr=function(t){const e={};return async n=>{const o="number"==typeof n?n.toString():n;return Object.prototype.hasOwnProperty.call(e,o)||(e[o]=await t(o)),e[o]}}(async t=>{const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")});async function Br(){var t;document.querySelectorAll(".room-component-message-picture-container").forEach(async t=>{if(nt.get(tt.imgControl)&&!t.querySelector(".picture-control")){const e=at("div",{className:"picture-control"});e.append(at("div",{className:"picture-button block material-icons",textContent:"delete_forever",title:"Block this image",onmousedown:t=>{var e,n;if(!(t.target instanceof HTMLElement))return;const o=null===(n=null===(e=t.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.firstChild;!async function(t){if(!t)return;const e=await jr(t);Or.add(e),Br()}(null==o?void 0:o.src)}})),e.append(at("div",{className:"picture-button save material-icons",textContent:"bookmark_border",title:"Bookmark this image",onmousedown:t=>{var e,n;if(!(t.target instanceof HTMLElement))return;const o=null===(n=null===(e=t.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.firstChild;!function(t){t&&Ir.add(t)}(null==o?void 0:o.src)}})),t.append(e)}if(!(t.firstChild instanceof HTMLImageElement))return;const{src:e}=t.firstChild,n=await jr(e);Or.hasItem(n)&&(t.firstChild.src="")});const e=document.querySelector("form#picture_upload");if(!e)return;const n=e.parentElement,o=n.querySelector(".ui-menu-text");"B"===(null===(t=null==o?void 0:o.firstElementChild)||void 0===t?void 0:t.tagName)?o.style.display="none":o&&(o.style.display="");if(n.querySelector(".image-grid"))return;const r=n.querySelector(".ui-menu-buttons"),i=at("div",{className:"image-grid"});Ir.values().forEach(t=>{const e=at("div",{style:`background-image: url(${encodeURI(t)}), url(${encodeURI("https://emeraldchat.com/avicons_strict/1.png")})`,onmousedown:()=>{!function(t){const e=(new Date).toISOString(),n={author_id:App.user.id,created_at:e,description:null,id:955e4+~~(1e6*Math.random()),image:{thumb:{url:t},url:t},image_processing:!1,image_tmp:null,micropost_id:null,picture_album_id:null,temporary:!1,title:null,updated_at:e,url:t};PictureUploader.onUploaded(n)}(t),MenuReactMicro.close()}});e.append(at("div",{className:"picture-button material-icons",textContent:"bookmark_remove",title:"Unbookmark this image",onmousedown:n=>{n.stopPropagation(),confirm("Are you sure you want to unbookmark this image?")&&(Ir.remove(t),e.remove())}})),i.append(e)}),n.insertBefore(i,r)}function Lr(){return`${a} ${l}`}const Dr={};function Fr(t,e){Dr[t]||(Dr[t]=[]),Dr[t].push(e)}function zr(t,e){Dr[t]||(Dr[t]=[]);const n=Dr[t].indexOf(e);n>-1&&Dr[t].splice(n,1)}function Gr(t,e){Dr[t]||(Dr[t]=[]);let n=!1;const o=Object.assign(Object.assign({},e),{type:t,preventDefault(){n=!0}});return Dr[t].forEach(t=>t(o)),n}function Vr(){const t={version:Lr,addEventListener:Fr,removeEventListener:zr,dispatchEvent:Gr};ut(App.room,"join",t=>{Gr("room.join",{room:t}),ut(App.room.client,"received",t=>{var e;Gr("room.received",t),t.user&&t.user_disconnected&&Gr("user.left",t),t.user&&t.user_connected&&Gr("user.joined",t),t.messages&&t.messages.length&&Gr("user.message",t),(e=t).typing?null===RoomClient||void 0===RoomClient||RoomClient.start_typing(e.user):null===RoomClient||void 0===RoomClient||RoomClient.stop_typing()})}),ut(App.room,"leave",t=>{Gr("room.leave",{room:t})}),x.RxE=t}function Kr(){var t;const e=document.evaluate("//li[text()='Emerald Gold']",document).iterateNext();nt.get(tt.adBlocker)&&e instanceof HTMLElement?e.remove():e&&(null===(t=null==e?void 0:e.parentElement)||void 0===t?void 0:t.firstChild)===e&&e.parentElement.append(e)}function Hr(t){const{id:e,value:n,onChange:o,children:r}=t;return rt.a.createElement("div",null,rt.a.createElement("input",{type:"checkbox",id:e,checked:n,onChange:o}),rt.a.createElement("label",{htmlFor:e},e in et?et[e].label:null!=r?r:null))}function qr(t){const{id:e,value:n,onChange:o,inline:r}=t,i=et[e];if(!(i instanceof L))throw new Error("RadioSetting can only be used with MultichoicePreference");return rt.a.createElement("div",{className:"ritsu-radio-setting-root"},rt.a.createElement("label",{htmlFor:e,className:"m1 "+Ur.settingsSection},i.label),rt.a.createElement("div",{id:e,style:{display:"flex",flexDirection:r?"row":"column"}},i.options.map(({value:t,label:r})=>rt.a.createElement("div",{className:"ritsu-radio-setting-option"},rt.a.createElement("input",{type:"radio",id:`${e}-option-${t}`,name:e,value:t,checked:n===t,onChange:()=>o(t)}),rt.a.createElement("label",{htmlFor:`${e}-option-${t}`},r)))))}function Jr(t){const{id:e,value:n,onChange:o,placeholder:r,children:i}=t;return rt.a.createElement("div",null,rt.a.createElement("input",{id:e,value:n,placeholder:r,onChange:o}),rt.a.createElement("label",{htmlFor:e},e in et?et[e].label:null!=i?i:null))}function Wr(t){const e=new Set(t.map(t=>t[0])),n=new Set(nt.get(tt.permaMuteList).map(t=>t[0])),{added:o,removed:r}=function(t,e){const n=new Set,o=new Set;return Array.from(t.values()).forEach(t=>{e.has(t)||n.add(t)}),Array.from(e.values()).forEach(e=>{t.has(e)||o.add(e)}),{added:n,removed:o}}(n,e);o.forEach(t=>App.room.mute(t)),r.forEach(t=>App.room.unmute(t))}class Xr extends rt.a.Component{constructor(t){super(t),this.state={items:Array.from(t.value)}}handleItemRemoval(t){const{onChange:e,removeItem:n}=this.props,o=n(t,this.items());this.setState({items:o}),e(o)}items(){const{items:t}=this.state;return Array.from(t)}itemJSX(t){const{renderItem:e}=this.props;return rt.a.createElement("div",null,rt.a.createElement("span",Object.assign({className:"ui-button-text",style:{margin:"0 0.5em 0 0",padding:"0 0.5em",borderRadius:"0.25em",backgroundColor:"#e00000"}},Xt(()=>this.handleItemRemoval(t),{allowSpace:!0}),{role:"button",tabIndex:0}),"×"),rt.a.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},e(t)))}render(){const{id:t,children:e}=this.props,{items:n}=this.state;if(!(et[t]instanceof B))throw new Error("ListSetting can only be used with ListPreference");return rt.a.createElement("div",null,rt.a.createElement("div",{id:t,style:{display:"block"}},0===n.length?e:n.map(this.itemJSX.bind(this))))}}function Yr(t,e){const{[t]:n}=e,o="applySettings"in e?e.applySettings:e.applyHacks;return rt.a.createElement(Hr,{id:t,value:n,onChange:()=>o({[t]:!n})})}function Qr(t,e){return rt.a.createElement("div",{className:"m1 "+t},e)}function Zr(t){const e=rt.a.createElement(UserProfile,{id:t});ze.a.render(e,document.getElementById("ui-hatch"))}const ti={g:"Global",i:"Case insensitive",m:"Multiline",u:"Unicode"};function ei(t){var e,n;const{id:o,value:r,onChange:i,flagsAllowed:s,children:a}=t;let c=null!==(e=null==r?void 0:r.source)&&void 0!==e?e:"",l=null!==(n=null==r?void 0:r.flags)&&void 0!==n?n:"";const u=(t,e)=>{if(null!=t&&(c=t),null!=e&&(l=e.join("")),""!==c)try{i(new RegExp(c,l))}catch(t){i({source:c,flags:l})}else i({source:c,flags:l})};return rt.a.createElement("div",null,rt.a.createElement(Jr,{id:o+"-text",value:c,placeholder:"Regular expression",onChange:({currentTarget:t})=>u(t.value)},o in et?et[o].label:a),s.split("").map(t=>Object.prototype.hasOwnProperty.call(ti,t)?rt.a.createElement(Hr,{id:`${o}-flag-${t}`,value:l.includes(t),onChange:({currentTarget:e})=>{const n=(o=t,l.split("").filter(t=>t!==o));var o;const r=[...n,t];u(null,e.checked?r:n)}},ti[t]):null))}function ni(t){var e;const{muteRegexes:n,applySettings:o}=t;return rt.a.createElement("div",{className:Ur.settings},Qr(Ur.settingsSection,Y.generalTitle),Yr("adBlocker",t),Yr("trackKarma",t),Yr("fancyColors",t),function(t,e){const{applySettings:n,[t]:o}=e;return rt.a.createElement(qr,{id:t,value:o,onChange:e=>n({[t]:e}),inline:!1})}("blockReqs",t),Qr(Ur.settingsSection,Y.imagesTitle),Yr("imgBlur",t),Yr("imgProtect",t),Yr("hidePfp",t),Yr("showAnimatedImages",t),Yr("imgControl",t),Yr("hideImageFallback",t),Qr(Ur.settingsSection,Y.messageTitle),Yr("antiSpam",t),Yr("showGender",t),Yr("showInfo",t),Yr("highlightMentions",t),Yr("bigEmoji",t),Yr("toggleEmbeds",t),Yr("largerText",t),Qr(Ur.settingsSection,Y.advancedTitle),Yr("ignoreURLBlacklist",t),function(t,e,n){const{applySettings:o,[t]:r}=e;return rt.a.createElement(Jr,{id:t,value:r,onChange:e=>o({[t]:e.target.value}),placeholder:n})}("imgurAPIKey",t,Y.preferences.imgurAPIKey.placeholder),rt.a.createElement(ei,{id:"muteRegexes",value:null!==(e=n[0])&&void 0!==e?e:{source:"",flags:""},onChange:({source:t,flags:e})=>o({muteRegexes:[{source:t,flags:e}]}),flagsAllowed:"i"}),function(t){const{applySettings:e,permaMuteList:n}=t;return rt.a.createElement(Xr,{id:"permaMuteList",value:n,removeItem:([t],e)=>e.filter(e=>e[0]!==t),renderItem:([t,e])=>[rt.a.createElement("span",{className:"ritsu-permamutelist-user-name"},e),rt.a.createElement("span",{className:"material-icons permamute-list",onClick:()=>Zr(t),onKeyDown:()=>Zr(t),role:"button",tabIndex:0},"account_circle")],onChange:t=>{Wr(t),e({permaMuteList:t}),null===NotificationsReact||void 0===NotificationsReact||NotificationsReact.update()}},"No mutes active")}(t))}var oi=n(16),ri=n.n(oi),ii=n(6),si=n.n(ii),ai=n(17),ci=n.n(ai),li=n(18),ui=n.n(li);const di=["default","ritsu","light"];function mi(){const t=nt.get(tt.theme);let e=document.head.querySelector(".custom-theme");e||(document.head.append(at("style",{className:"custom-theme",type:"text/css"})),e=document.head.querySelector(".custom-theme"));const n=[ri.a];switch(t){case"default":default:break;case"ritsu":n.push(si.a,ci.a);break;case"light":n.push(si.a,ui.a)}e.textContent=n.join("\n")}function fi(t){const{theme:e,applyTheme:n}=t;return rt.a.createElement("div",null,rt.a.createElement("div",{className:"m1 "+Ur.settingsSection},Y.themeTitle),di.map(t=>rt.a.createElement("div",null,rt.a.createElement("input",{type:"radio",id:t,name:"theme",value:t,checked:e===t,onChange:()=>n(t)}),rt.a.createElement("label",{htmlFor:t},t[0].toUpperCase()+t.slice(1)))))}class hi extends rt.a.Component{constructor(){super({}),this.applySettings=t=>{const{settings:e}=this.state,n=Object.assign(Object.assign({},e),t);Object.keys(t).forEach(e=>nt.set(tt[e],t[e])),bi(),this.setState({settings:n,needsReload:!0})},this.applyTheme=t=>{nt.set(tt.theme,t),document.body.classList.add("themeChange"),mi(),this.setState({theme:t}),setTimeout(()=>document.body.classList.remove("themeChange"),1e3)},this.v=t=>{},this.state=Object.assign(Object.assign({},vi()),{needsReload:!1})}render(){const{theme:t,settings:e,R:n,needsReload:o}=this.state;return rt.a.createElement("div",null,rt.a.createElement(fi,{theme:t,applyTheme:this.applyTheme}),rt.a.createElement(ni,Object.assign({},e,{applySettings:this.applySettings})),!1,o&&rt.a.createElement("div",{className:Ur.reloadWarning},"You may need to reload the app for your changes to take effect."))}}function pi(){return rt.a.createElement(Menu,null,rt.a.createElement("div",{key:"custom_menu",className:Ur.ritsuMenuContainer},"Ritsu Settings",rt.a.createElement("br",null),rt.a.createElement("br",null),rt.a.createElement(hi,null),rt.a.createElement("div",{className:"ui-menu-buttons"},rt.a.createElement("div",{role:"button",tabIndex:0,className:"ui-button-text",onMouseDown:()=>MenuReact.close()},"Close"))))}function gi(t){return Kt(function(t,e){const n=Object.getOwnPropertyNames(t).filter(n=>t[n]instanceof e).map(e=>[e,t[e]]);return Object.fromEntries(n)}(t,j),(t,e)=>nt.get(e))}function vi(){return Object.assign(Object.assign({theme:nt.get(tt.theme)},!1),{settings:Object.assign(Object.assign({},gi(tt)),{muteRegexes:nt.get(tt.muteRegexes),imgurAPIKey:nt.get(tt.imgurAPIKey),blockReqs:nt.get(tt.blockReqs),permaMuteList:nt.get(tt.permaMuteList)})})}function bi(){const t=vi().settings;Object.keys(t).forEach(e=>{"boolean"==typeof t[e]&&document.documentElement.classList.toggle(e,t[e])}),mi()}function wi(){ze.a.render(rt.a.createElement(pi,null),document.getElementById("ui-hatch"))}function yi(){const t=document.querySelector(".navigation-dropdown-ritsu"),e=document.querySelector(".navigation-dropdown-content");!t&&e&&e.prepend(at("li",{className:"navigation-dropdown-ritsu",textContent:"Ritsu Menu",onmousedown:wi}))}var Ri=n(19),ki=n.n(Ri);const xi=rt.a.createElement("button",{className:"material-icons navigation-notification-unit lookup-button",onClick:function(){if("undefined"==typeof UserViewReact&&(UserViewGenerator.generate({event:{preventDefault:()=>{},clientX:100,clientY:100},user:{karma:100,id:2}}),UserViewReact.close(),"undefined"==typeof UserViewReact))return;const t=prompt("Enter a user id",""+UserViewReact.state.user.id);if(null===t)return;const e=parseInt(t,10);Number.isNaN(e)||(UserViewReact.state.user.id=e,UserViewReact.view_profile())},type:"button"},"face"),Ai=rt.a.createElement("div",{className:"navigation-dropdown-content"},rt.a.createElement("div",null,Y.preferences.userSort.label),["name.asc","name.desc","age.asc","age.desc"].map(t=>rt.a.createElement("li",{className:nt.get(tt.userSort)===t?"selected":"",onClick:()=>function(t){nt.set(tt.userSort,t),RoomChannelMembersClient instanceof RoomChannelMembers&&RoomChannelMembersClient.setState(RoomChannelMembersClient.state)}(t)},Y.preferences.userSort[t]))),Ci=rt.a.createElement("div",{className:"navigation-dropdown sort-button"},rt.a.createElement("span",{className:"material-icons navigation-notification-unit"},"arrow_drop_down"),Ai);let Ei;function Mi(t,e){var n;"setState"in RoomChannelMembersClient&&(null===RoomClient||void 0===RoomClient||RoomClient.setState({messages:[],current_channel:t}),RoomChannelMembersClient.setState({members:[]}),App.room.join(t),document.querySelectorAll(".channel-unit").forEach(t=>t.classList.remove("channel-unit-active")),null===(n=document.querySelector(e))||void 0===n||n.classList.add("channel-unit-active"),null===RoomClient||void 0===RoomClient||RoomClient.print(rt.a.createElement("div",null,Y.privateRoomsWarning)),Ei=t)}function Ni(){document.querySelector(".wfaf.channel-unit-active")||Mi("",".wfaf")}function $i(){const t=prompt(Y.privateRoomsPrompt);null!=t&&Mi(t,".private-rooms")}function Pi(t){const{type:e}=t||{},{action:n}=t||{},{text:o}=t||{};return rt.a.createElement("div",{className:"channel-unit "+e,onClick:()=>n(),onKeyPress:()=>n(),role:"button",tabIndex:0},o)}function Ui(){RoomChannelSelect.prototype.body=function(){const{text_channels:t}=this.state;return rt.a.createElement("div",{className:"room-component-module"},rt.a.createElement("div",{className:"room-user-label"},"text channels"),t.map(t=>this.channel_button(t)),rt.a.createElement("div",{className:"room-user-label"},Y.hiddenChannels),rt.a.createElement(Pi,{type:"wfaf",action:Ni,text:Y.WFAF}),rt.a.createElement(Pi,{type:"private-rooms",action:$i,text:Y.privateRooms}))},function(){const t=ActionCable.Subscriptions.prototype.reject;ActionCable.Subscriptions.prototype.reject=function(e){e===App.room.client.identifier&&App.room.id===Ei&&pt("ERROR: You could not join room "+(Ei||"WFAF")),t.call(this,e)}}()}function _i(){function t(t){null===RoomClient||void 0===RoomClient||RoomClient.trim_messages();const e=null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.messages;e&&(t.forEach(t=>{0===e.length&&e.unshift(t);const n=e[0],o=ee(n.user)===ee(t.user),r=n.picture||t.picture,i=n.messages.length>=16;if(!o||r||i)return void e.unshift(t);const s=t.messages[0];n.messages[0]===s||n.messages.unshift(t.messages[0])}),null===RoomClient||void 0===RoomClient||RoomClient.setState({messages:e}))}Room.prototype.load_messages=function(e){const n=(o=e)+20<=RoomClient.state.messages_count?-o-20:-RoomClient.state.messages_count;var o;$.ajax({type:"GET",url:`/room_load_more?loaded=${n}&id=${this.state.id}`,dataType:"json",success:e=>t.call(this,e.reverse())})},Room.prototype.switch=function(t){this.clear_print();const{id:e}=t;App.room.join(e),this.state.last_message=null,this.setState({id:e,messages:[],messages_count:0,typing:null,mode:t.mode||"default"}),"private"===t.mode&&$.ajax({type:"GET",url:"/default_private_messages?id="+e,dataType:"json",success:t=>{yr.call(this,t.messages),this.setState({messages_count:t.messages_count}),this.scroll()}})}}var Si=n(20),Ti=n.n(Si);const Oi=t=>"Enter"===t.key&&!t.shiftKey;function Ii(t){if(!t.clipboardData)return;const{items:e}=t.clipboardData;Array.from(e).forEach(t=>{!async function(t){var e;if("file"!==t.kind)return;const n=t.getAsFile();if(!n||!confirm("Are you sure you want to upload this image in chat?"))return;const o=await Xe(n);RoomClient&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,o))}(t)})}var ji=n(21),Bi=n.n(ji);const Li=mo;async function Di(t,e,n){const o=await async function(t){for(let e=0;e<t.length;e+=1)try{return await t[e]()}catch(n){if(!(n instanceof Qt&&e!==t.length-1))throw n;console.log(`Item ${e} threw: `,n.message)}throw new Error("funcs cannot be empty")}([128,96,64,48].map(e=>()=>async function(t,e,n){if(!(e in ho))throw new Error(`Format '${e}' not implemented`);return ho[e].compress(t,n).then(t=>e+t)}(t,n,(t=>({interpolator:$n.none,width:t,height:t}))(e))));console.log(`compressed: ${o.length} chars`),await le(e,o)}async function Fi(t,e,n){if(t)if(t.type.startsWith("image"))try{await Di(t,e,n)}catch(t){t instanceof Error&&alert(t.message)}else alert("File is not an image or its format is not supported.");else alert("No file uploaded.")}const zi=(t,e)=>n=>{var o;const{currentTarget:r}=n,i=null===(o=r.files)||void 0===o?void 0:o[0];try{Fi(i,t,e)}catch(t){alert("Image loading failed: "+t)}},Gi=(t,e)=>()=>{const n=prompt("Paste URL:","");if(null===n)return;const o=po(n,e);null!==o?le(t,o):alert("Invalid URL")};function Vi(){const{user:t,current_user:e}=this.state.data,n=(t=>e=>{var n;e.preventDefault(),e.stopPropagation();const o=null===(n=e.dataTransfer.files)||void 0===n?void 0:n[0];try{Fi(o,t,Li)}catch(t){alert("Image loading failed: "+t)}})(t),o=e.karma<10,{display_picture:r}=t,i=!r.includes("robohash.org")&&!r.includes("emeraldchat.com/avicons");if(t.id!==e.id)return rt.a.createElement("img",Object.assign({className:"user-profile-avatar",alt:"User avatar",src:r},Xt((t=>()=>{ze.a.render(rt.a.createElement(Picture,{data:{src:t.display_picture}}),document.getElementById("ui-hatch-2"))})(t))));return rt.a.createElement("span",{onDrop:n},o&&i&&rt.a.createElement("div",{className:"material-icons ritsu-avatar-karma-warning",title:"Due to low karma, some users may not see your avatar in chat."},"warning"),rt.a.createElement("img",{alt:"User avatar",className:"user-profile-avatar",src:r,onDrop:n}),rt.a.createElement("input",{id:"ritsu-profile-picture-upload",type:"file",onChange:zi(t,fo),onDrop:n}),rt.a.createElement("label",{className:"user-profile-picture-hover",htmlFor:"ritsu-profile-picture-upload",onDrop:n},null,rt.a.createElement("span",{className:"material-icons",style:{fontSize:"36px"},title:"Upload a profile picture"},"cloud_upload")),rt.a.createElement("input",{id:"ritsu-profile-picture-use-existing",style:{fontSize:"12px"},className:"btn",title:"Upload using imgur",onDrop:n,type:"button",value:"Add from Imgur",onClick:Gi(t,fo)}))}function Ki(t){const e=nt.get(tt.blockReqs);t.friend_requests=t.friend_requests.filter(t=>{const n=new Date(t.data.sender.created_at),o=e!==Z.None&&Lt(n)<864e5,r=App?App.room.muted.includes(t.sender_id):t.seen;return!o&&!r||(e!==Z.Reject||$.ajax({type:"GET",url:`/friends_decline?friend_id=${t.sender_id}&notification_id=${t.id}`,dataType:"json"}),!1)})}function Hi(){return $.ajax({type:"GET",url:"/notifications_json",dataType:"json",success:function(t){Ki(t),NotificationsReact.setState({data:t})}}),"updated"}const qi=t=>t?rt.a.createElement(Flair,{data:{string:t,flair:App.user.flair}}):null;function Ji(){const t=Message.prototype.process;Message.prototype.process=function(e){const n=t.bind(this),o=e.includes("youtu.be")||e.includes("youtube.com"),r=App.user.display_name.replace(/[^\w\s]/g,"").trim();if(!r||o||!nt.get(tt.highlightMentions))return n(e);return Gt(e,r,qi,t=>Gt(t,App.user.display_name,qi,n))}}const Wi=t=>t.split(""),Xi=t=>mt(t,2),Yi={none:Wi("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"),italic:Xi("𝘢𝘣𝘤𝘥𝘦𝘧𝘨𝘩𝘪𝘫𝘬𝘭𝘮𝘯𝘰𝘱𝘲𝘳𝘴𝘵𝘶𝘷𝘸𝘹𝘺𝘻𝘈𝘉𝘊𝘋𝘌𝘍𝘎𝘏𝘐𝘑𝘒𝘓𝘔𝘕𝘖𝘗𝘘𝘙𝘚𝘛𝘜𝘝𝘞𝘟𝘠𝘡"),bold:Xi("𝗮𝗯𝗰𝗱𝗲𝗳𝗴𝗵𝗶𝗷𝗸𝗹𝗺𝗻𝗼𝗽𝗾𝗿𝘀𝘁𝘂𝘃𝘄𝘅𝘆𝘇𝗔𝗕𝗖𝗗𝗘𝗙𝗚𝗛𝗜𝗝𝗞𝗟𝗠𝗡𝗢𝗣𝗤𝗥𝗦𝗧𝗨𝗩𝗪𝗫𝗬𝗭𝟬𝟭𝟮𝟯𝟰𝟱𝟲𝟳𝟴𝟵"),boldItalic:Xi("𝙖𝙗𝙘𝙙𝙚𝙛𝙜𝙝𝙞𝙟𝙠𝙡𝙢𝙣𝙤𝙥𝙦𝙧𝙨𝙩𝙪𝙫𝙬𝙭𝙮𝙯𝘼𝘽𝘾𝘿𝙀𝙁𝙂𝙃𝙄𝙅𝙆𝙇𝙈𝙉𝙊𝙋𝙌𝙍𝙎𝙏𝙐𝙑𝙒𝙓𝙔𝙕"),underline:Xi("a͟b͟c͟d͟e͟f͟g͟h͟i͟j͟k͟l͟m͟n͟o͟p͟q͟r͟s͟t͟u͟v͟w͟x͟y͟z͟A͟B͟C͟D͟E͟F͟G͟H͟I͟J͟K͟L͟M͟N͟O͟P͟Q͟R͟S͟T͟U͟V͟W͟X͟Y͟Z͟0͟1͟2͟3͟4͟5͟6͟7͟8͟9͟"),squared:Xi("🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉"),squaredFull:Xi("🅰🅱🅲🅳🅴🅵🅶🅷🅸🅹🅺🅻🅼🅽🅾🅿🆀🆁🆂🆃🆄🆅🆆🆇🆈🆉🅰🅱🅲🅳🅴🅵🅶🅷🅸🅹🅺🅻🅼🅽🅾🅿🆀🆁🆂🆃🆄🆅🆆🆇🆈🆉"),circled:Wi("ⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏ⓪①②③④⑤⑥⑦⑧⑨"),superscript:Wi("ᵃᵇᶜᵈᵉᶠᵍʰᶦʲᵏˡᵐⁿᵒᵖᵠʳˢᵗᵘᵛʷˣʸᶻᴬᴮᶜᴰᴱᶠᴳᴴᴵᴶᴷᴸᴹᴺᴼᴾᵠᴿˢᵀᵁⱽᵂˣʸᶻ⁰¹²³⁴⁵⁶⁷⁸⁹"),medieval:Xi("𝖆𝖇𝖈𝖉𝖊𝖋𝖌𝖍𝖎𝖏𝖐𝖑𝖒𝖓𝖔𝖕𝖖𝖗𝖘𝖙𝖚𝖛𝖜𝖝𝖞𝖟𝕬𝕭𝕮𝕯𝕰𝕱𝕲𝕳𝕴𝕵𝕶𝕷𝕸𝕹𝕺𝕻𝕼𝕽𝕾𝕿𝖀𝖁𝖂𝖃𝖄𝖅"),cursive:Xi("𝒶𝒷𝒸𝒹𝑒𝒻𝑔𝒽𝒾𝒿𝓀𝓁𝓂𝓃𝑜𝓅𝓆𝓇𝓈𝓉𝓊𝓋𝓌𝓍𝓎𝓏𝒜𝐵𝒞𝒟𝐸𝐹𝒢𝐻𝐼𝒥𝒦𝐿𝑀𝒩𝒪𝒫𝒬𝑅𝒮𝒯𝒰𝒱𝒲𝒳𝒴𝒵"),cursiveBold:Xi("𝓪𝓫𝓬𝓭𝓮𝓯𝓰𝓱𝓲𝓳𝓴𝓵𝓶𝓷𝓸𝓹𝓺𝓻𝓼𝓽𝓾𝓿𝔀𝔁𝔂𝔃𝓐𝓑𝓒𝓓𝓔𝓕𝓖𝓗𝓘𝓙𝓚𝓛𝓜𝓝𝓞𝓟𝓠𝓡𝓢𝓣𝓤𝓥𝓦𝓧𝓨𝓩"),monospace:Wi("ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ０１２３４５６７８９"),smallcaps:Wi("ᴀʙᴄᴅᴇꜰɢʜɪᴊᴋʟᴍɴᴏᴘQʀꜱᴛᴜᴠᴡxʏᴢᴀʙᴄᴅᴇꜰɢʜɪᴊᴋʟᴍɴᴏᴘQʀꜱᴛᴜᴠᴡxʏᴢ"),hooked:Wi("αႦƈԃҽϝɠԋιʝƙʅɱɳσρϙɾʂƚυʋɯxყȥ"),boldSerif:Xi("𝐚𝐛𝐜𝐝𝐞𝐟𝐠𝐡𝐢𝐣𝐤𝐥𝐦𝐧𝐨𝐩𝐪𝐫𝐬𝐭𝐮𝐯𝐰𝐱𝐲𝐳𝐀𝐁𝐂𝐃𝐄𝐅𝐆𝐇𝐈𝐉𝐊𝐋𝐌𝐍𝐎𝐏𝐐𝐑𝐒𝐓𝐔𝐕𝐖𝐗𝐘𝐙𝟎𝟏𝟐𝟑𝟒𝟓𝟔𝟕𝟖𝟗")};function Qi(t,e){return e.split("").map(e=>{var n;const o=Yi.none.indexOf(e);return null!==(n=Yi[t][o])&&void 0!==n?n:e}).join("")}const Zi=t=>t;function ts(t){const e=t.toLocaleLowerCase();return rt.a.createElement("span",Object.assign({},{className:"material-icons",title:e}),t.slice(2,-1))}function es({length:t}){return t>1?[rt.a.createElement("br",null),rt.a.createElement("br",null)]:rt.a.createElement("br",null)}function ns(t){return t.startsWith("[[")&&t.endsWith("]]")?Qi("squaredFull",t.slice(2,-2)):t.startsWith("((")&&t.endsWith("))")?Qi("circled",t.slice(2,-2)):t.startsWith("{{")&&t.endsWith("}}")?Qi("medieval",t.slice(2,-2)):t.endsWith("))")||t.endsWith("]]")||t.endsWith("}}")?t:t.startsWith("***")?Qi("boldItalic",t.slice(3,-3)):t.startsWith("**")?Qi("bold",t.slice(2,-2)):t.startsWith("*")?Qi("italic",t.slice(1,-1)):t.startsWith("__")?Qi("underline",t.slice(2,-2)):t.startsWith("_")?Qi("italic",t.slice(1,-1)):t.startsWith("`")?Qi("monospace",t.slice(1,-1)):t.startsWith("^^")?Qi("superscript",t.slice(2,-2)):t.startsWith(",,")?Qi("hooked",t.slice(2,-2)):t}function os(t,e=Zi){return function(t,e=Zi){return zt(t.replace(/^[\s\n]+|[\s\n]+$/g,""),/\n+/g,es,e)}(t,t=>function(t,e=Zi){return zt(t,/m:[-_a-z]+:/gi,ts,e)}(t,t=>vr(t,e)))}const rs={shrug:"¯\\_(ツ)_/¯",tableflip:"(╯°□°）╯︵ ┻━┻",tableflip2:"(ノಠ益ಠ)ノ彡┻━┻",unflip:"┬──┬ ノ( ゜-゜ノ)"},is={all:{rxelink:()=>RoomClient.send("Link to RxE extension for Emerald: "+Ge)},on:t=>({run:e=>(is.all[t]=e,is)}),prefix:".",process(t){if(!t.startsWith(is.prefix))return!1;const e=t.slice(is.prefix.length).split(" "),n=is.findCommand(e[0]);return null==n||n(...e.slice(1)),!!n},findCommand(t){const e=Object.getOwnPropertyNames(is.all).find(e=>e===t);return e?is.all[e]:void 0},checkMail:t=>/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/gi.test(t),processMail:t=>t.replace(/\./gi,".​")};function ss(){var t;t=rs,Object.entries(t).forEach(([t,e])=>is.on(t).run(()=>RoomClient.send(e))),Room.prototype.send=function(t){const e=this.process?this.process(t):t;null!==e&&(this.append({messages:[e],user:App.user}),App.room.client.speak({message:e}),this.scroll())},Room.prototype.process=function(t){return is.process(t)?null:is.checkMail(t)?is.processMail(t):be(function(t,e=Zi){return zt(t,/(?<=\s|^|\.,;!\?)(\*{1,3}|_{1,2}|~~|`|\^\^|,,|\[{2}|\({2}|\{{2})\S(?:.*?\S)?(?:\1|\]{2}|\){2}|\}{2})(?=\s|$|\.,;!\?)/g,ns,e).join("")}(t))}}function as({raw:t,onRemove:e}){const n=e&&(()=>{confirm("Are you sure you want to remove your profile picture?")&&e()});return rt.a.createElement("div",{title:t,className:"bio-image"},"Profile picture (",function(t){switch(t){case mo:return"format0";case fo:return"imgur";default:return"unknown"}}(t[0]),", ",t.length," chars)",!!n&&[" ",rt.a.createElement("b",Object.assign({},Xt(n)),"×")])}function cs(t,e,n){const o=t.split(/ +/g);if(o.length>36&&e){const t=o.slice(0,36).join(" ");return rt.a.createElement("span",null,os(t)," ...",rt.a.createElement("span",Object.assign({className:"user-micropost-text-button"},Xt(n))," More"))}return os(t,Micropost.prototype.youtube_process)}var ls=n(22),us=n.n(ls);function ds(){lt(us.a);const t=Message.prototype.process;Message.prototype.process=function(e){const n=t.bind(this);return e.includes("youtu.be")||e.includes("youtube.com")?n(e):function(t,e=Zi){if(xe().test(t))return zt(t,xe(),t=>qe({url:"https://"+t}),()=>"");const n=We(t);return null!==n?qe(n):e(t)}(we(e),t=>os(t,n))},UserProfile.prototype.bio=function(){const{compact_bio:t,data:{user:e}}=this.state,n=t&&e.bio.length>202,o=se(e.bio),r=ae(e.bio),i=o&&rt.a.createElement(as,{raw:o,onRemove:e.id===App.user.id?()=>ce(e,r):null}),s=r.slice(0,202)+"... ",a=n?s:r;return rt.a.createElement("span",null,os(a),n&&rt.a.createElement("span",{role:"button",tabIndex:0,onMouseDown:()=>this.bio_expand(),className:"bio-expand"},"Show More"),!n&&i)},Micropost.prototype.content=function(){const{data:t,compact:e}=this.state;if(!t)return null;const{content:n}=t.micropost;return rt.a.createElement("div",{style:{width:"100%"}},cs(n,e,()=>this.more()))},Comment.prototype.content=function(){const{comment_data:t,compact:e}=this.state;if(!t)return null;const{content:n}=t.comment;return rt.a.createElement("div",{style:{width:"100%"}},cs(n,e,()=>this.more()))}}const ms=[[Room,"Room"],[UserProfile,"UserProfile"],[FriendUnit,"FriendUnit"],[Micropost,"Micropost"],[MessageNotificationUnit,"MessageNotificationUnit"],[Message,"Message"],[RoomUserUnit,"RoomUserUnit"],[UserUnit,"UserUnit"],[UserView,"UserView"],[Dashboard,"Dashboard"]];var fs=n(23),hs=n.n(fs);function ps(t){const e=nt.get(tt.toggleEmbeds),n=document.querySelectorAll("."+t);e&&n&&n.forEach(t=>{const e=Array.from(t.children);e&&e.forEach(t=>{if(t.querySelectorAll(".embed").length)return;const e=we(t.innerText);if(!sr(e)&&!ar(e))return;const n=document.createElement("div");n.classList.add("embed"),n.innerHTML="<br>"+ur(e),t.appendChild(n)})})}function gs(){lt(hs.a),ps("user-comment-right"),ps("user-micropost-right"),ps("room-component-message-text")}const vs=["safe","normal","unsafe"];function bs({preset:t,applyPreset:e}){return rt.a.createElement("div",null,rt.a.createElement("div",{className:"m1 "+Ur.settingsSection},Y.introduction.presetsTitle),vs.map(n=>rt.a.createElement("div",null,rt.a.createElement("input",{type:"radio",id:"ritsu-preset-"+n,name:"preset",value:n,checked:n===t,onChange:()=>e(n)}),rt.a.createElement("label",{htmlFor:"ritsu-preset-"+n},Y.introduction.presets[n].title,rt.a.createElement("br",null)),rt.a.createElement("div",{className:"notification-menu-container-text"},Y.introduction.presets[n].content),rt.a.createElement("br",null))))}class ws extends rt.a.Component{constructor(){super({}),this.applyTheme=t=>{nt.set(tt.theme,t),document.body.classList.add("themeChange"),mi(),this.setState({theme:t}),setTimeout(()=>document.body.classList.remove("themeChange"),1e3)},this.applyPreset=t=>{"safe"===t?(nt.set(tt.blockReqs,Z.Reject),nt.set(tt.imgBlur,!0),nt.set(tt.imgProtect,!0),nt.set(tt.showAnimatedImages,!1),nt.set(tt.toggleEmbeds,!1)):"normal"===t?(nt.set(tt.blockReqs,Z.None),nt.set(tt.imgBlur,!1),nt.set(tt.imgProtect,!0),nt.set(tt.showAnimatedImages,!0),nt.set(tt.toggleEmbeds,!0)):"unsafe"===t&&(nt.set(tt.blockReqs,Z.None),nt.set(tt.imgBlur,!1),nt.set(tt.imgProtect,!1),nt.set(tt.showAnimatedImages,!0),nt.set(tt.toggleEmbeds,!0)),this.setState({preset:t})};const{theme:t}=vi();this.state={theme:t,preset:"normal"}}render(){const{theme:t,preset:e}=this.state;return rt.a.createElement(Menu,null,rt.a.createElement("div",{key:"custom_menu",className:Ur.ritsuMenuContainer},Y.introduction.title,rt.a.createElement("br",null),rt.a.createElement("br",null),Y.introduction.content,rt.a.createElement(fi,{theme:t,applyTheme:this.applyTheme}),rt.a.createElement(bs,{preset:e,applyPreset:this.applyPreset}),rt.a.createElement("div",{className:"ui-menu-buttons"},rt.a.createElement("div",{role:"button",tabIndex:0,className:"ui-button",onMouseDown:()=>{nt.set(tt.introductionCompletedVersion,1),MenuReact.close()}},"Save"))))}}function ys(){nt.get(et.introductionCompletedVersion)<1&&ze.a.render(rt.a.createElement(ws,null),document.getElementById("ui-hatch"))}!async function(){const t=`(${[]})`;o.log(`${a} Version ${l} ${t}`),async function(){Notifications.prototype.update=Hi,NotificationsReact&&(NotificationsReact.update=Hi,NotificationsReact.state&&NotificationsReact.state.data?Ki(NotificationsReact.state.data):console.warn("failed to filter friend requests early"))}(),await(async t=>{for(;!t();)await vt()})(()=>!!x.App),ms.forEach(([t,e])=>{t.displayName=e}),Tr(),function(){if("undefined"==typeof GM_getValue)return;const t=GM_getValue("theme",!1);t&&(nt.set(tt.theme,t),o.log("Migrated THEME"),GM_deleteValue("theme"));const e=GM_getValue("hacks",!1);e&&(nt.set(tt.adBlocker,!!e.disableNags),nt.set(tt.fancyColors,!!e.fancyColors),o.log("Migrated HACKS"),GM_deleteValue("hacks"));const n=GM_getValue("settings",!1);n&&(nt.set(tt.imgControl,!!n.imgControl),nt.set(tt.imgProtect,!!n.imgProtect),nt.set(tt.showInfo,!!n.showInfo),o.log("Migrated SETTINGS"),GM_deleteValue("settings"));const r=GM_getValue("blockedPictures",!1);if(r instanceof Array){const t=[...nt.get(tt.blockedHashes)];r.forEach(e=>{t.includes(e)||t.push(e)}),nt.set(tt.blockedHashes,t),o.log("Migrated BLOCKED PICTURES"),GM_deleteValue("blockedPictures")}const i=GM_getValue("savedPictures",!1);if(i instanceof Array){const t=[...nt.get(tt.savedPictures)];i.forEach(e=>{t.includes(e)||t.push(e)}),nt.set(tt.savedPictures,t),o.log("Migrated SAVED PICTURES"),GM_deleteValue("savedPictures")}}(),Vr(),lt(oe.a),document.body.addEventListener("mouseup",({target:t})=>{t instanceof HTMLElement&&t.classList.contains("mute-button")&&Cookies.set("muted",MuteButtonClient.state.muted?"t":"")}),MuteButton.prototype.componentDidMount=function(){const t=Cookies.get("muted");this.setState({muted:"t"===t||void 0===t})},bi(),kr(),Or.load(),Ir.load(),lt(_o.a),lt(qo.a),wo(),tr(),or(),lt(Wo.a),function(){const t=RoomChannelSelect.prototype.join;RoomChannelSelect.prototype.join=function(e){e.members&&(e.members=Bt(e.members)),t.call(this,e)};const e=RoomPrivate.prototype.setState;function n(){var t,e;null===(t=document.querySelector(".wfaf"))||void 0===t||t.classList.remove("channel-unit-active"),null===(e=document.querySelector(".private-rooms"))||void 0===e||e.classList.remove("channel-unit-active"),ut(App.room.client,"received",Po,!0)}RoomPrivate.prototype.setState=function(t){return t&&"online"in t&&(t.online=Bt(t.online)),t&&"offline"in t&&(t.offline=Bt(t.offline)),e.call(this,t)},ut(App.room,"join",n),App.room.client&&n()}(),function(){const t=nt.get(tt.showGender);document.documentElement.classList.toggle("showGender",t),lt(Fo.a);const e=MessageNotificationUnit.prototype.image;MessageNotificationUnit.prototype.image=function(){return zo.call(this,e)};const n=NotificationUnit.prototype.image;NotificationUnit.prototype.image=function(){return zo.call(this,n)};const o=SearchUnit.prototype.body;SearchUnit.prototype.body=function(){return zo.call(this,o)};const r=UserUnit.prototype.body;UserUnit.prototype.body=function(){return zo.call(this,r)};const i=FriendUnit.prototype.body;FriendUnit.prototype.body=function(){return zo.call(this,i)};const s=RoomUserUnit.prototype.body;RoomUserUnit.prototype.body=function(){return zo.call(this,s)};const a=Message.prototype.render;Message.prototype.render=function(){var t,e;const n=a.apply(this);return n&&"object"==typeof n&&"props"in n&&(n.props.children[0].props.children.props["data-gender"]=null!==(e=null===(t=te(this.props.data.user))||void 0===t?void 0:t.gender)&&void 0!==e?e:""),n}}(),Cr(),_i(),function(){RoomChannelMembers.prototype.body=function(){const{members:t}=this.state;if(!t)return null;if(t.length<1)return rt.a.createElement("div",{className:"room-component-module"},rt.a.createElement("div",{className:"room-user-label"},xi));const e=Bt(t).map(t=>rt.a.createElement(UserUnit,{key:t.id,data:t}));return rt.a.createElement("div",{className:"room-component-module"},rt.a.createElement("div",{className:"room-user-label"},xi,"online — "+t.length,Ci),e)};const t=RoomChannelMembers.prototype.setState;RoomChannelMembers.prototype.setState=function(e){var n;if(!e||!("members"in e))return;this.state.members||console.warn("this.state.members is falsy despite declaration");const o=Bt(null!==(n=this.state.members)&&void 0!==n?n:[]).map(t=>t.id),r=Bt(e.members),[i,s]=nt.get(tt.userSort).split("."),a="asc"===s?"asc":"desc";"age"===i?Ct(r,"id",yt(wt.numeric),a,!0):Ct(r,"display_name",wt.string,a,!0),r.forEach(t=>{o.some(kt(t.id))||x.RxE.dispatchEvent("room.userlist",t)}),e.members=r,t.call(this,e)},Room.prototype.disconnected=function(t){"channel"===this.state.mode&&RoomChannelMembersClient.remove_member(t.user)},lt(ki.a)}(),function(){function t(){NotificationsReact.update(),null===UserViewReact||void 0===UserViewReact||UserViewReact.forceUpdate(),null===RoomClient||void 0===RoomClient||RoomClient.forceUpdate()}App.room.muted.push(...nt.get(tt.permaMuteList).map(t=>t[0])),UserView.prototype.bottom=function(){const{id:t}=this.state.user,e=App.room.muted.includes(t),n=nt.get(tt.permaMuteList).map(t=>t[0]).includes(t);return rt.a.createElement("div",{className:"user-profile-micro-bottom"},rt.a.createElement("div",{onMouseDown:this.view_profile.bind(this),className:"user-profile-micro-button"},"View Profile"),rt.a.createElement("div",{onMouseDown:this.message.bind(this),className:"user-profile-micro-button"},"Message"),this.mod_button(),rt.a.createElement("div",{onMouseDown:e?this.unmute.bind(this):this.mute.bind(this),className:"user-profile-micro-button",disabled:n},e?"Unmute":"Mute"),rt.a.createElement("div",{onMouseDown:n?this.permaunmute.bind(this):this.permamute.bind(this),className:"user-profile-micro-button"},n?"Perma Unmute":"Perma Mute"),rt.a.createElement("div",{onMouseDown:this.close.bind(this),className:"user-profile-micro-button"},"Close"))},UserView.prototype.permamute=function(){const{id:e,display_name:n}=this.state.user;ge.addItem({key:e,item:n},tt.permaMuteList),App.room.mute(e,n,"Permamuted by user"),t()},UserView.prototype.permaunmute=function(){const{id:e}=this.state.user;ge.removeItem({key:e},tt.permaMuteList),App.room.unmute(e),t(),$o(e)},UserView.prototype.mute=function(){App.room.mute(this.state.user.id),this.setState({muted:!0}),t()},UserView.prototype.unmute=function(){const{id:e}=this.state.user;App.room.unmute(e),this.setState({muted:!1}),t(),$o(e)}}(),function(){on(),Room.prototype.upload_picture=function(){ze.a.render(tn(),document.getElementById("ui-hatch-2")),PictureUploader.onUploaded=function(t){var e;if(!RoomClient)return;const n=Be(t.url,!0);n&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,n))}},Room.prototype.sendRitsuPicture=function(t){this.append(Je(t)),App.room.client.speak({message:He(t)}),this.scroll()},PictureUpload.prototype.uploadImage=async function(){var t,e;if(!Ee())return;const n=null===(t=document.querySelector(".picture-upload-button").files)||void 0===t?void 0:t[0];if(n)try{const t=await Xe(n);this.close(),UserProfileReact?yo(t.url):RoomClient&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,t))}catch(t){this.setState({failureReason:t instanceof Error?t.message:""+t})}};const t=Room.prototype.received;Room.prototype.received=function(e){var n;const r=t.bind(this),i=null===(n=e.messages)||void 0===n?void 0:n[0];if(!i)return;const s=We(i);if(s)try{return void r(Je(s,e.user))}catch(t){t instanceof Error&&o.error(t.message)}else r(e)}}(),function(){function t(t){const{data:e}=this.state;void 0!==e&&(e.comments.unshift(t.comment.id),this.setState({data:e,compact:this.state.compact,reply:!0}))}function e(t){const e=this.state.data||{microposts:[]};this.setState({data:{microposts:[t.micropost.id,...e.microposts]}})}function n(){return this.state.reply?rt.a.createElement("div",{className:"animated zoomIn user-comment-input-background"},rt.a.createElement("textarea",{className:"user-comment-input",onKeyDown:this.comment_input.bind(this),id:"comment-input",placeholder:"Comment..."})):null}lt(Ti.a),Room.prototype.input=function(t){const e=$(t.target),n=""+e.val(),o="ArrowUp"===t.key&&this.state.last_message;Oi(t)?(this.send(n),this.setState({last_message:n}),e.val(""),e.css("height","34px")):o&&e.val(this.state.last_message),0!==n.length&&n.includes("\n")||e.css("height","34px");const r=e.get(0);r.style.height=r.scrollHeight+"px",document.onpaste=Ii,null===RoomClient||void 0===RoomClient||RoomClient.scroll(),(Oi(t)||o)&&t.preventDefault(),Oi(t)||App.room.client.typing()},Micropost.prototype.comment_input=function(e){var n;if(!Oi(e))return;const o=$(e.target),r=encodeURIComponent(""+o.val());this.setState({data:this.state.data,reply:!1,compact:this.state.compact}),o.val(""),e.preventDefault(),o.trigger("blur");const i=null===(n=this.state.data)||void 0===n?void 0:n.micropost.id;void 0!==i&&$.ajax({type:"GET",url:`/comments_create?id=${i}&content=${r}`,dataType:"json",success:t.bind(this)})},Microposts.prototype.micropost_input=function(t){if(t.target instanceof HTMLInputElement)return;const n=$(t.target),o=encodeURIComponent(""+n.val());if(!Oi(t))return;n.val(""),n.trigger("blur"),t.preventDefault();const r=this.props.data.wall_id;$.ajax({type:"GET",url:`/microposts_create?id=${r}&content=${o}`,dataType:"json",success:e.bind(this)})},Microposts.prototype.render=function(){const t=this.state.data?this.state.data.microposts:[],e=rt.a.createElement("div",{className:"user-microposts"},t.map(t=>rt.a.createElement(Micropost,{key:t,data:{id:t}}))),n=rt.a.createElement("div",{className:"user-micropost-input-background"},rt.a.createElement("textarea",{className:"user-micropost-input",onKeyDown:this.micropost_input.bind(this),id:"micropost-input",placeholder:"Say Something..."}));return rt.a.createElement("span",{key:this.props.data.wall_id},n,e)},Micropost.prototype.write_comment=n,Comment.prototype.write_comment=n}(),function(){lt(Bi.a),UserProfile.prototype.profile_picture=Vi;const{Comment:t}=x,e=MessageNotificationUnit;Vo(Room,"received",(t,{user:e})=>[te(e)]),Vo(Room,"append",(t,{user:e})=>[te(e)]),Vo(RoomChannelMembers,"setState",(t,e)=>e&&"members"in e?Bt(e.members):[]),Vo(UserProfile,"profile_picture",({state:t})=>[t.data.user]),Vo(FriendUnit,"body",t=>[t.props.data]),Vo(t,"render",t=>{var e;return[null===(e=t.state.comment_data)||void 0===e?void 0:e.user]}),Vo(Micropost,"render",t=>{var e;return[null===(e=t.state.data)||void 0===e?void 0:e.author]}),Vo(e,"image",t=>[t.props.data.data.sender]),Vo(Message,"render",t=>[te(t.props.data.user)]),Vo(NotificationUnit,"render",t=>[te(t.props.data.data.sender)]),Vo(RoomUserUnit,"body",t=>[t.props.data]),Vo(UserUnit,"body",t=>[t.props.data]),Vo(UserView,"top",t=>[t.state.user]),ut(Dashboard.prototype,"render",(function(){App.user.bio&&(this.state.user.display_picture=Go(App.user))}),!0)}(),Ji(),ds(),ss(),ys(),function(t){function e(){t.forEach(t=>t())}let n;new MutationObserver(()=>{cancelAnimationFrame(n),n=requestAnimationFrame(e)}).observe(document.body,{subtree:!0,childList:!0}),e()}([Er,gs,Kr,yi,Ko,Br,Lo,xr,ie,Bo,Ui])}()}]);