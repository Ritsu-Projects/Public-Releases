// ==UserScript==
// @name         Ritsu x Emerald
// @version      0.9.0
// @description  Custom Emerald Chat themes and fixes.
// @author       Fxkleti, Atsos/Ritsu, Aqua, Strawberry.
// @icon         https://static.emeraldchat.com/uploads/picture/image/9529291/Ritsu_Icon.png
// @match        *://emeraldchat.com/app
// @match        *://www.emeraldchat.com/app
// @namespace    Emerald Bot - Ritsu Project
// @run-at       document-end
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        unsafeWindow
// ==/UserScript==
!function(o){var e={};function t(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return o[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=o,t.c=e,t.d=function(o,e,n){t.o(o,e)||Object.defineProperty(o,e,{enumerable:!0,get:n})},t.r=function(o){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},t.t=function(o,e){if(1&e&&(o=t(o)),8&e)return o;if(4&e&&"object"==typeof o&&o&&o.__esModule)return o;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:o}),2&e&&"string"!=typeof o)for(var r in o)t.d(n,r,function(e){return o[e]}.bind(null,r));return n},t.n=function(o){var e=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(e,"a",e),e},t.o=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)},t.p="",t(t.s=33)}([function(o,e){o.exports=React},function(o,e,t){"use strict";o.exports=function(o){var e=[];return e.toString=function(){return this.map((function(e){var t=function(o,e){var t=o[1]||"",n=o[3];if(!n)return t;if(e&&"function"==typeof btoa){var r=(a=n,c=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),"/*# ".concat(s," */")),i=n.sources.map((function(o){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(o," */")}));return[t].concat(i).concat([r]).join("\n")}var a,c,s;return[t].join("\n")}(e,o);return e[2]?"@media ".concat(e[2]," {").concat(t,"}"):t})).join("")},e.i=function(o,t,n){"string"==typeof o&&(o=[[null,o,""]]);var r={};if(n)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(r[a]=!0)}for(var c=0;c<o.length;c++){var s=[].concat(o[c]);n&&r[s[0]]||(t&&(s[2]?s[2]="".concat(t," and ").concat(s[2]):s[2]=t),e.push(s))}},e}},function(o,e){o.exports=ReactDOM},function(o,e,t){"use strict";var n=t(1),r=t.n(n)()(!0);r.push([o.i,'._3B6q_5OTXi-a3CXdwPEQy-{margin:2em;text-align:center;color:#e33}._3tf_pFd0gVgIPLUPiJgMkk{height:calc(100% - 46px);overflow:auto}._3Sq5HmxyS1XyN6bIcGdQH2{padding-top:1em}._3eP0_BWRRPqybKC0gcIAwL{width:80px;height:80px}._3eP0_BWRRPqybKC0gcIAwL:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid #8ac;border-color:#8ac transparent #8ac transparent;animation:_3eP0_BWRRPqybKC0gcIAwL 1.2s linear infinite}@keyframes _3eP0_BWRRPqybKC0gcIAwL{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',"",{version:3,sources:["webpack://src/components/style.module.scss"],names:[],mappings:"AAAA,yBACE,UAAA,CACA,iBAAA,CACA,UAAA,CAGF,yBACE,wBAAA,CACA,aAAA,CAGF,yBACE,eAAA,CAIF,yBACE,UAAA,CACA,WAAA,CAEF,+BACE,WAAA,CACA,aAAA,CACA,UAAA,CACA,WAAA,CACA,UAAA,CACA,iBAAA,CACA,qBAAA,CACA,8CAAA,CACA,sDAAA,CAEF,mCACE,GACE,sBAAA,CAEF,KACE,wBAAA,CAAA",sourcesContent:['.reload-warning {\n  margin: 2em;\n  text-align: center;\n  color: #e33;\n}\n\n.ritsu-menu-container {\n  height: calc(100% - 46px);\n  overflow: auto;\n}\n\n.settings-section {\n  padding-top: 1em;\n}\n\n// spinner thingy\n.lds-dual-ring {\n  width: 80px;\n  height: 80px;\n}\n.lds-dual-ring:after {\n  content: " ";\n  display: block;\n  width: 64px;\n  height: 64px;\n  margin: 8px;\n  border-radius: 50%;\n  border: 6px solid #8ac;\n  border-color: #8ac transparent #8ac transparent;\n  animation: lds-dual-ring 1.2s linear infinite;\n}\n@keyframes lds-dual-ring {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n'],sourceRoot:""}]),r.locals={reloadWarning:"_3B6q_5OTXi-a3CXdwPEQy-",ritsuMenuContainer:"_3tf_pFd0gVgIPLUPiJgMkk",settingsSection:"_3Sq5HmxyS1XyN6bIcGdQH2",ldsDualRing:"_3eP0_BWRRPqybKC0gcIAwL"},e.a=r},function(o,e,t){var n=t(30);o.exports="string"==typeof n?n:n.toString()},,function(o,e,t){var n=t(22);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},i=function(){var o={};return function(e){if(void 0===o[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(o){t=null}o[e]=t}return o[e]}}(),a=[];function c(o){for(var e=-1,t=0;t<a.length;t++)if(a[t].identifier===o){e=t;break}return e}function s(o,e){for(var t={},n=[],r=0;r<o.length;r++){var i=o[r],s=e.base?i[0]+e.base:i[0],l=t[s]||0,u="".concat(s," ").concat(l);t[s]=l+1;var d=c(u),m={css:i[1],media:i[2],sourceMap:i[3]};-1!==d?(a[d].references++,a[d].updater(m)):a.push({identifier:u,updater:p(m,e),references:1}),n.push(u)}return n}function l(o){var e=document.createElement("style"),n=o.attributes||{};if(void 0===n.nonce){var r=t.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(o){e.setAttribute(o,n[o])})),"function"==typeof o.insert)o.insert(e);else{var a=i(o.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,d=(u=[],function(o,e){return u[o]=e,u.filter(Boolean).join("\n")});function m(o,e,t,n){var r=t?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(o.styleSheet)o.styleSheet.cssText=d(e,r);else{var i=document.createTextNode(r),a=o.childNodes;a[e]&&o.removeChild(a[e]),a.length?o.insertBefore(i,a[e]):o.appendChild(i)}}function f(o,e,t){var n=t.css,r=t.media,i=t.sourceMap;if(r?o.setAttribute("media",r):o.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),o.styleSheet)o.styleSheet.cssText=n;else{for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(document.createTextNode(n))}}var g=null,h=0;function p(o,e){var t,n,r;if(e.singleton){var i=h++;t=g||(g=l(e)),n=m.bind(null,t,i,!1),r=m.bind(null,t,i,!0)}else t=l(e),n=f.bind(null,t,e),r=function(){!function(o){if(null===o.parentNode)return!1;o.parentNode.removeChild(o)}(t)};return n(o),function(e){if(e){if(e.css===o.css&&e.media===o.media&&e.sourceMap===o.sourceMap)return;n(o=e)}else r()}}o.exports=function(o,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var t=s(o=o||[],e);return function(o){if(o=o||[],"[object Array]"===Object.prototype.toString.call(o)){for(var n=0;n<t.length;n++){var r=c(t[n]);a[r].references--}for(var i=s(o,e),l=0;l<t.length;l++){var u=c(t[l]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}t=i}}}},function(o,e,t){var n=t(23);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(24);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(25);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(26);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(27);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(28);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(29);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(31);o.exports="string"==typeof n?n:n.toString()},function(o,e,t){var n=t(32);o.exports="string"==typeof n?n:n.toString()},,,,,,function(o,e,t){var n=t(1)(!1);n.push([o.i,"html.adBlocker .emerald-jumbotron-message{display:none}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,".top-message{position:absolute;top:2px;font-size:1.5em;font-weight:bold;padding:6px;margin:auto;border:solid 4px #800;border-radius:8px;background-color:#f88;color:#300;cursor:pointer}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,"html.imgBlur div>img[src*=uploads]{filter:blur(7px);transition:filter 1s ease}html.imgBlur div:hover>img[src*=uploads]{filter:blur(0px)}.room-component-message-text.room-component-message-text,.notification-unit-body.notification-unit-body{overflow:visible}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,"html.showGender .room-component-message-avatar,html.showGender .navigation-notification-unit-image{border:2px solid lime;width:36px;height:36px;margin:-2px 10px -2px -2px}html.showGender .room-component-message-avatar[data-gender=m],html.showGender .navigation-notification-unit-image[data-gender=m]{border-color:blue}html.showGender .room-component-message-avatar[data-gender=f],html.showGender .navigation-notification-unit-image[data-gender=f]{border-color:#f6f}html.showGender .room-component-message-avatar{width:42px;height:42px}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,"html.hidePfp .room-component-message-left,html.hidePfp .navigation-notification-unit-image{display:none}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,".karma-tracker,.karma-delta{display:none}html.trackKarma .karma-tracker{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:1.5em;color:var(--menu-fg-color)}html.trackKarma .karma-delta{display:block;position:absolute;top:50%;left:50%;opacity:1;transform:translateX(-50%) translateY(-50%) scale(0.1);transition:all 2s ease-out;pointer-events:none}html.trackKarma .karma-delta.positive{color:green}html.trackKarma .karma-delta.negative{color:red}html.trackKarma .karma-delta.zoom{opacity:0;transform:translateX(-50%) translateY(-50%) scale(20)}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,".user-extra{padding-left:5em}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,'.actionicon-mega:last-child{display:none}.room-component-message-picture-container{position:relative}.picture-control{display:none;position:absolute;top:0;font-size:2em;font-weight:900}.room-component-message-picture:hover+.picture-control,.picture-control:hover{display:block;cursor:pointer}.picture-button{padding:.5em;border:1px solid var(--app-fg-color);border-radius:2px;background:var(--app-bg-color);color:var(--app-fg-color)}.picture-button.block:hover{color:red}.picture-button.save:hover{color:green}.image-grid div{display:inline-block;width:6em;height:6em;margin:5px;background-size:contain;background-repeat:no-repeat;background-position:center;cursor:pointer}.lookup-button{float:right;padding:2px;margin-top:-4px}.disable-after::after{content:"";display:none}.picker-flair-select{height:3em !important;vertical-align:bottom}.navigation-dropdown-ritsu{color:#f965fec4}.main-logo-text{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:.5em}@media screen and (max-width: 640px){.main-logo-text{display:none}}body.themeChange *{transition:background-color .3s,color .3s,border-color .3s}body{overflow:hidden}span.user-flair:before{content:"⁦"}span.user-flair:after{content:"⁩"}body.tmp-message span.room-component-print:last-of-type{margin:-1em 0}.user-profile-micro.user-profile-micro{width:auto}',""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,":root{--ritsu-hair-color: #f965fec4;--ritsu-hair-dark-color: #b821bd}html>body{background:var(--header-alt-bg-color)}body>div>nav{background:var(--header-bg-color)}.room-component-left.room-component-left{background:var(--roomlist-bg-color)}.room-component-center.room-component-center{background:var(--chat-bg-color)}.room-component-right.room-component-right{background:var(--userlist-bg-color)}.room-component-messages{background:var(--chat-bg-color)}.room-notification.room-notification{background:var(--chat-bg-color)}.room-component-print.room-component-print{color:var(--message-fg-color)}.room-component-input{background:var(--input-bg-color)}.room-component-input-textarea.room-component-input-textarea{color:var(--input-fg-color)}.ui-button-match{background:var(--input-bg-color)}#container{background:var(--app-bg-color)}.room-component-container.room-component-container{color:var(--app-fg-color)}.dashboard-button.animated.zoomIn{background:var(--dashboard-button-bg-color)}.navigation-notification-icons.navigation-notification-icons{background:transparent}.ui-search-box{background:var(--search-bg-color);color:var(--search-fg-color)}.side-panel.side-panel{background:var(--panel-bg-color)}.actionicon-mega.actionicon-mega{color:var(--panel-fg-color)}.actionicon-mega.actionicon-mega:hover{background:var(--item-hover-bg-color)}.ui-bg.ui-bg{background:var(--dialog-overlay-bg-color)}.ui-menu.ui-menu,.notification-unit.notification-unit{background:var(--dialog-bg-color);color:var(--dialog-fg-color)}.ui-interests-bg.ui-interests-bg{background:var(--interests-bg-color) !important}.navigation-notification-unit.navigation-notification-unit:hover{background:var(--header-hover-bg-color);color:var(--header-hover-fg-color)}.navigation-notification-unit{color:var(--header-fg-color)}.navigation-dropdown-content.navigation-dropdown-content{background:var(--menu-bg-color);color:var(--menu-fg-color)}.dashboard-icon.dashboard-icon{color:var(--dashboard-icon-fg-color)}.dashboard-button.dashboard-button:hover{color:var(--dashboard-hover-fg-color);background:var(--dashboard-hover-bg-color)}.actionicon-icon.actionicon-icon{color:var(--dashboard-icon-fg-color)}.main-hamburger.main-hamburger{color:var(--header-fg-color)}.main-hamburger.main-hamburger:hover,.main-logo.main-logo:hover{background:var(--header-hover-bg-color) !important;color:var(--header-hover-fg-color)}.user-profile-menu.user-profile-menu{background:var(--dialog-bg-color)}.user-micropost-input-background.user-micropost-input-background{background:var(--dialog-input-bg-color)}.user-micropost-input.user-micropost-input{color:var(--dialog-input-fg-color)}.ui-button-micro.ui-button-micro{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.user-profile-tab.user-profile-tab,.ui-tab.ui-tab{color:var(--tab-fg-color)}.user-profile-tab-active.user-profile-tab-active,.ui-tab-active.ui-tab-active{color:var(--tab-active-fg-color)}.ui-button-mega.ui-button-mega:hover{background:var(--dialog-button-hover-bg-color);color:var(--dialog-button-hover-fg-color)}.ui-button-mega.ui-button-mega{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.ui-input.ui-input{background:var(--dialog-input-bg-color) !important}.dashboard-card-image.dashboard-card-image{border-color:var(--dashboard-icon-fg-color)}.user-comment-input-background.user-comment-input-background{background:var(--dialog-input-bg-color)}.user-comment-input.user-comment-input{color:var(--dialog-input-fg-color)}.room-component-left .room-user-label{color:var(--roomlist-title-fg-color)}.room-component-right .room-user-label{color:var(--userlist-title-fg-color)}.picture-upload-button.picture-upload-button+label{background:var(--upload-button-bg-color);color:var(--upload-button-fg-color)}.main-logo-text{color:var(--menu-fg-color)}.navigation-dropdown-ritsu{color:var(--ritsu-menu-fg-color)}.navigation-dropdown-ritsu:hover{color:var(--ritsu-menu-hover-fb-color)}.notification-menu-container-text{color:var(--dialog-fg-color)}.notification-menu-container-text span{text-shadow:#000 0 0 3px}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,":root{--header-bg-color: #100f10;--header-alt-bg-color: #232529;--header-hover-bg-color: #3d4046;--app-bg-color: black;--dialog-bg-color: #111;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.93);--dialog-button-bg-color: #17191b;--dialog-button-hover-bg-color: #151515;--dialog-input-bg-color: #17191b;--dashboard-button-bg-color: #100f10;--dashboard-hover-bg-color: #33323270;--roomlist-bg-color: black;--chat-bg-color: black;--userlist-bg-color: black;--input-bg-color: #211f21;--search-bg-color: #0b0b0b;--panel-bg-color: #0c0c0c;--item-hover-bg-color: #35383e;--interests-bg-color: #2c2f35;--menu-bg-color: #0a0a0a;--upload-button-bg-color: #41444a;--header-fg-color: white;--header-hover-fg-color: var(--ritsu-hair-color);--app-fg-color: #bebfc5;--dialog-fg-color: #f1f1f2;--dialog-button-fg-color: #d5dcec;--dialog-button-hover-fg-color: var(--ritsu-hair-color);--dialog-input-fg-color: #d7dfec;--dashboard-icon-fg-color: var(--ritsu-hair-color);--dashboard-hover-fg-color: var(--ritsu-hair-color);--roomlist-title-fg-color: #99a3b4;--userlist-title-fg-color: #99a3b4;--tab-fg-color: #c2c8d6;--tab-active-fg-color: var(--ritsu-hair-color);--message-fg-color: #afbacd;--input-fg-color: #caccd0;--search-fg-color: #f0f0f1;--panel-fg-color: white;--menu-fg-color: white;--upload-button-fg-color: #b4bccc;--ritsu-menu-fg-color: var(--ritsu-hair-color);--ritsu-menu-hover-fb-color: var(--ritsu-hair-color)}",""]),o.exports=n},function(o,e,t){var n=t(1)(!1);n.push([o.i,":root{--header-bg-color: #bbb;--header-alt-bg-color: #ccc;--header-hover-bg-color: #aaa;--app-bg-color: #ddd;--dialog-bg-color: #ddd;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.5);--dialog-button-bg-color: #cfdeec;--dialog-button-hover-bg-color: #f0f0f0;--dialog-input-bg-color: #cfdeec;--dashboard-button-bg-color: #f0e4f0;--dashboard-hover-bg-color: #cfcdcd70;--roomlist-bg-color: #ccc;--chat-bg-color: #ddd;--userlist-bg-color: #ccc;--input-bg-color: #fff;--search-bg-color: #f7f7f7;--panel-bg-color: #ccc;--item-hover-bg-color: #a3adc0;--interests-bg-color: #aab6ce;--menu-bg-color: #aaa;--upload-button-bg-color: #ccc;--header-fg-color: #333;--header-hover-fg-color: var(--ritsu-hair-dark-color);--app-fg-color: #333;--dialog-fg-color: #333;--dialog-button-fg-color: #000;--dialog-button-hover-fg-color: var(--ritsu-hair-dark-color);--dialog-input-fg-color: #000;--dashboard-icon-fg-color: var(--ritsu-hair-dark-color);--dashboard-hover-fg-color: var(--ritsu-hair-dark-color);--roomlist-title-fg-color: #555;--userlist-title-fg-color: #555;--tab-fg-color: #444;--tab-active-fg-color: var(--ritsu-hair-dark-color);--message-fg-color: #666;--input-fg-color: #222;--search-fg-color: #222;--panel-fg-color: #333;--menu-fg-color: #333;--upload-button-fg-color: #444;--ritsu-menu-fg-color: var(--ritsu-hair-dark-color);--ritsu-menu-hover-fb-color: var(--ritsu-hair-color)}.user-flair.user-flair,.user-extra-gender{text-shadow:1px 1px 1px #000}.actionicon-mega.actionicon-mega:hover{background:#aaa}.ui-button-text.ui-button-text:hover{color:#666}.user-profile-menu.user-profile-menu{background:#ddd;color:#333}.user-micropost-unit.user-micropost-unit{color:#333}.ritsu-menu-container li{color:#666}.ritsu-menu-container li.selected{color:#222}.ritsu-menu-container li:hover{background:#fff}",""]),o.exports=n},function(o,e,t){"use strict";t.r(e);var n={};t.r(n),t.d(n,"setPrefix",(function(){return d})),t.d(n,"setLogger",(function(){return m})),t.d(n,"log",(function(){return f})),t.d(n,"info",(function(){return g})),t.d(n,"warning",(function(){return h})),t.d(n,"error",(function(){return p}));var r={};t.r(r),t.d(r,"subscriptable",(function(){return v})),t.d(r,"loggingResponseHandler",(function(){return b})),t.d(r,"noopResponseHandler",(function(){return y}));var i="ritsu-emerald",a="Ritsu x Emerald",c="0.9.0",s="https://static.emeraldchat.com/uploads/picture/image/9529291/Ritsu_Icon.png";let l="",u=console;function d(o){l=o}function m(o){u=o}function f(o){u.log(l,o)}function g(o){u.info(l,o)}function h(o){u.warn(l,o)}function p(o){u.error(l,o)}function v(o){const e=new Set;return{subscribe:o=>{e.add(o)},unsubscribe:o=>{e.delete(o)},handler:(t,n)=>("set"===t.action&&e.forEach(o=>o(t.preference)),o(t,n))}}function b(o,e){const t=o.response;switch(t.status){case 0:return t;case 1:return"get"===o.action&&(h(`The saved value for preference '${o.preference.key}' (${JSON.stringify(t.saved)}) was invalid. Replacing it with ${JSON.stringify(t.value)}.`),e.set(o.preference,t.value)),"set"===o.action&&h(`Could not set value ${JSON.stringify(t.value)} for preference '${o.preference.key}' because it was invalid.`),t;case 2:return"get"===o.action&&(h(`The saved value for preference '${o.preference.key}' had the wrong type. Replacing it with ${JSON.stringify(t.value)}.`),e.set(o.preference,t.value)),t;case 3:return"get"===o.action&&(h(`The saved value for preference '${o.preference.key}' could not be parsed. Replacing it with ${JSON.stringify(t.value)}.`),e.set(o.preference,t.value)),t;case 4:switch(o.action){case"get":p(`Could not read preference '${o.preference.key}' because localStorage could not be accessed. Using value ${JSON.stringify(o.preference.default)}.`);break;case"set":p(`Could not save value ${JSON.stringify(o.response.value)} for preference '${o.preference.key}' because localStorage could not be accessed.`);break;default:w(o.action)}return t;default:return w(t.status)}}function y(o,e){return o.response}function w(o){throw new Error("assertUnreachable: "+o)}var k="undefined"!=typeof unsafeWindow?unsafeWindow:window;function A(o,e){return void 0===e?o:e}function R(o,e){switch(!0){case Number.isNaN(e):return"NaN";case e===1/0:return"Infinity";case e===-1/0:return"-Infinity";default:return e}}function C(o){return JSON.stringify(o,R)}const x=[function(o){return"boolean"==typeof o},function(o){return"number"==typeof o},O,function(o){return"symbol"==typeof o},M,function(o){return void 0===o}];function O(o){return"string"==typeof o}function M(o){return null===o}function E(o){return x.some(e=>e(o))}function _(o,e,t){return n=`${o.name}(${e.name})`,r=t,Object.defineProperty(r,"name",{value:n,writable:!1});var n,r}function P(o){return E(o)?o=>!1:_(P,o,e=>e instanceof o)}class S{constructor(o){if(""===o.key)throw new TypeError(`Empty preference key in this ${this.getClassName()}:\n${C(o)}`);this.key=o.key,this.default=o.default,this.label=o.label,this.description=A("",o.description),this.constraints=A([],o.constraints),this.dependencies=A([],o.dependencies),this.extras=A({},o.extras);const e=this.validate(o.default);O(e)&&this.invalidValue(o.default,e)}validate(o){const e=this.constraints;for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.requirement(o))return n.message(o)}return{value:o}}toValid(o){return O(this.validate(o))?this.default:o}toString(){return`${this.getClassName()} '${this.key}'`}invalidValue(o,e){throw new Error(`${C(o)} is not a valid value for ${this}. Reason: ${e}`)}}class N extends S{constructor(o){const e=A(0,o.minLength),t=A(1/0,o.maxLength),n=[];if(o.multiline||n.push({requirement:o=>!o.includes("\n"),message:o=>"Line breaks are not allowed."}),e>0&&n.push({requirement:o=>o.length>=e,message:o=>`Minimum length is ${e} characters.`}),t<1/0&&n.push({requirement:o=>o.length<=t,message:o=>`Maximum length ${t} exceeded.`}),function(o,e){e.constraints=o.concat(A([],e.constraints))}(n,o),super(o),e<0)throw new Error(`Parameter 'minLength' cannot be negative, but it was ${e} in ${this}.`);this.multiline=o.multiline,this.maxLength=t,this.minLength=e}getClassName(){return"StringPreference"}toValid(o){const e=o.substring(0,this.maxLength);return super.toValid(this.multiline?e:e.replace(N.REGEX_LINE_BREAKS," "))}fromString(o){return this.validate(o)}}N.REGEX_LINE_BREAKS=/\n+/g;class T extends S{getClassName(){return"BooleanPreference"}}class U extends S{getClassName(){return"ListPreference"}}var B;!function(o){o.OK="OK",o.ABSENT="ABSENT",o.TYPE_ERROR="TYPE_ERROR",o.JSON_ERROR="JSON_ERROR",o.STORAGE_ERROR="STORAGE_ERROR",o.NUMBER_ERROR="NUMBER_ERROR"}(B||(B={}));const G=()=>localStorage;function j(o,e,t){try{const n=function(o,e,t){if(null===o)throw new DOMException;const n=o.getItem(e);if(M(n))return null;const r=JSON.parse(n);if(function o(e){for(const o of x)if(o(e))return e=>o(e);if(P(Array)(e)){const t=e;return e=>P(Array)(e)&&(!(t.length>0)||e.every(o(t[0])))}if(e.constructor===Object)return t=>![void 0,null].includes(t)&&Object.keys(e).every(n=>o(e[n])(t[n]));if(e.constructor instanceof Function)return P(e.constructor);throw new TypeError(o.name+" cannot use this object as reference because it has no constructor: "+JSON.stringify(e))}(t)(r))return r;throw new TypeError("Saved value had wrong type.")}(o(),e,t);return M(n)?{status:"ABSENT",value:t}:{status:"OK",value:n}}catch(o){return{status:P(SyntaxError)(o)?"JSON_ERROR":P(TypeError)(o)?"TYPE_ERROR":"STORAGE_ERROR",value:t}}}function I(o,e,t){try{return function(o,e,t){const n=JSON.stringify(t,(o,e)=>{if("number"==typeof e&&!Number.isFinite(e))throw new RangeError(e.toString());return e});if(null===o)throw new DOMException;o.setItem(e,n)}(o(),e,t),{status:"OK",value:t}}catch(o){return{status:P(RangeError)(o)?"NUMBER_ERROR":P(SyntaxError)(o)||P(TypeError)(o)?"JSON_ERROR":"STORAGE_ERROR",value:t}}}function K(o,e){try{return o().removeItem(e),{status:"OK",value:!0}}catch(o){return{status:"STORAGE_ERROR",value:!1}}}var L;!function(o){o[o.OK=0]="OK",o[o.INVALID_VALUE=1]="INVALID_VALUE",o[o.TYPE_ERROR=2]="TYPE_ERROR",o[o.JSON_ERROR=3]="JSON_ERROR",o[o.STORAGE_ERROR=4]="STORAGE_ERROR"}(L||(L={}));const V=(o,e)=>o.response;function F(o){return`Unknown preference:\n\n${C(o)}.`}function D(o){switch(o){case"OK":case"ABSENT":return 0;case"NUMBER_ERROR":return 1;case"TYPE_ERROR":return 2;case"JSON_ERROR":return 3;case"STORAGE_ERROR":return 4}}var H=Object.assign(Object.assign(Object.assign({title:`${a} ${c}`,themeTitle:"Choose your theme"},!1),{generalTitle:"General Settings",imagesTitle:"Image Settings",messageTitle:"Message Settings",preferences:Object.assign(Object.assign({theme:{label:"Theme",description:"Reskin the chat"}},!1),{adBlocker:{label:"Remove ads and nags"},fancyColors:{label:"Use any color for your flair"},imgControl:{label:"Overlay controls to block and favorite images"},imgProtect:{label:"Hide images from low karma accounts"},imgBlur:{label:"Blur all user images until hovered"},hidePfp:{label:"Hide profile pictures in chat"},showInfo:{label:"Show user info (karma,gender,since) on messages"},antiSpam:{label:"Auto-mute users flooding the chat"},showGender:{label:"Gender-color the outline around avatars"},trackKarma:{label:"Display Karma in header and track changes"}}),hiddenChannels:"hidden channels",WFAF:"WFAF ⌛",privateRooms:"Private Rooms 🔒",privateRoomsPrompt:"Enter a private room key:\nOnly people with the key can enter this room.",privateRoomsWarning:"Chat history and user list is not available in unlisted rooms."}),!1);const J=matchMedia("(prefers-color-scheme: dark)").matches,W=Object.assign(Object.assign({theme:new N({key:"theme",label:H.preferences.theme.label,description:H.preferences.theme.description,default:J?"ritsu":"light",multiline:!1})},!1),{adBlocker:new T({key:"adBlocker",label:H.preferences.adBlocker.label,default:!0}),fancyColors:new T({key:"fancyColors",label:H.preferences.fancyColors.label,default:!0}),imgControl:new T({key:"imgControl",label:H.preferences.imgControl.label,default:!0}),imgProtect:new T({key:"imgProtect",label:H.preferences.imgProtect.label,default:!1}),imgBlur:new T({key:"imgBlur",label:H.preferences.imgBlur.label,default:!1}),hidePfp:new T({key:"hidePfP",label:H.preferences.hidePfp.label,default:!1}),showInfo:new T({key:"showInfo",label:H.preferences.showInfo.label,default:!0}),antiSpam:new T({key:"antiSpam",label:H.preferences.antiSpam.label,default:!0}),showGender:new T({key:"showGender",label:H.preferences.showGender.label,default:!0}),trackKarma:new T({key:"trackKarma",label:H.preferences.trackKarma.label,default:!0}),blockedHashes:new U({key:"blockedHashes",label:"blockedHashes",default:[]}),savedPictures:new U({key:"savedPictures",label:"savedPictures",default:[]})}),z=new class{constructor(o,e,t=V){this.localStoragePrefix=e,this.responseHandler=t,this.cache=new Map;const n=[],r=function o(e){return Object.values(e).reduce((e,t)=>e.concat(P(S)(t)?t:o(t.u)),[])}(o);r.forEach(o=>{const e=o.key;if(n.includes(e))throw new Error(`Duplicate preference key ${C(e)}.`);this.cache.set(o,o.default),n.push(e)}),r.forEach(o=>{o.dependencies.forEach(e=>{if(void 0===this.cache.get(e.preference))throw new Error(`Dependency error in ${o}: ${F(e.preference)}`)})})}get(o){return this.getWith(this.responseHandler,o)}set(o,e){this.setWith(this.responseHandler,o,e)}getWith(o,e){return o({action:"get",preference:e,response:this.getRaw(e)},this).value}setWith(o,e,t){o({action:"set",preference:e,response:this.setRaw(e,t)},this)}reset(o){var e;this.getFromCacheOrThrowIfUnknown(o),e=this.localStoragePrefix+o.key,K(G,e)}resetAll(){for(const o of this.cache.keys())this.reset(o)}shouldBeAvailable(o){return o.dependencies.every(o=>o.condition(this.getRaw(o.preference).value))}getRaw(o){const e=this.getFromCacheOrThrowIfUnknown(o),t=(n=this.localStoragePrefix+o.key,r=o.default,j(G,n,r));var n,r;if("OK"===t.status){const e=t.value;return O(o.validate(e))?{status:1,value:o.toValid(e),saved:e}:{status:0,value:e}}return{status:D(t.status),value:e}}setRaw(o,e){if(this.getFromCacheOrThrowIfUnknown(o),O(o.validate(e)))return{status:1,value:e};this.cache.set(o,e);const t=function(o,e){return I(G,o,e)}(this.localStoragePrefix+o.key,e);return{status:D(t.status),value:t.value}}getFromCacheOrThrowIfUnknown(o){const e=this.cache.get(o);if(void 0===e)throw new Error(F(o));return e}}(W,i+"-preference-",r.loggingResponseHandler);var q=t(0),X=t.n(q),Y=function(o,e,t,n){return new(t||(t=Promise))((function(r,i){function a(o){try{s(n.next(o))}catch(o){i(o)}}function c(o){try{s(n.throw(o))}catch(o){i(o)}}function s(o){var e;o.done?r(o.value):(e=o.value,e instanceof t?e:new t((function(o){o(e)}))).then(a,c)}s((n=n.apply(o,e||[])).next())}))};const Q=(o,e={})=>Object.assign(document.createElement(o),e),Z=[];function oo(o){Z.push(o),Promise.resolve().then(()=>{if(!Z.length)return;const o=Z.join("\n");Z.length=0,document.head.append(Q("style",{type:"text/css",textContent:o}))})}function eo(o,e,t,n=!1){const r=o[e];"function"==typeof r&&"function"==typeof t&&(o[e]=function(...o){const e=n&&t.apply(this,o);n&&!1===e||r.apply(this,o),n||t.apply(this,o)})}let to;function no(o){clearTimeout(to),Promise.resolve().then(()=>null===RoomClient||void 0===RoomClient?void 0:RoomClient.print_append(X.a.createElement("div",null,o)))}function ro(o){no(o),document.body.classList.add("tmp-message"),to=+setTimeout(()=>{null===RoomClient||void 0===RoomClient||RoomClient.print_append(),document.body.classList.remove("tmp-message")},5e3)}const io=(o=0)=>new Promise(e=>setTimeout(e,o));var ao=t(6),co=t.n(ao);function so(){z.get(W.adBlocker)&&document.querySelectorAll('iframe:not([src*="captcha"]):not([src*="youtube"]):not([src*="about:blank"])').forEach(o=>{o.remove()})}var lo=t(7),uo=t.n(lo),mo=t(3),fo={insert:"head",singleton:!1},go=(uo()(mo.a,fo),mo.a.locals||{});function ho(){return X.a.createElement("div",{className:go.ldsDualRing})}t(8);var po=t(9),vo=t.n(po);function bo(){document.querySelectorAll('img[src*="/badges/tick.svg"]').forEach(o=>{var e;const t=o.parentElement;o.outerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.1 146.8">\n<path d="M140 59l-5-5c-2-2-3-3-2-6V39v-1c0-12-10-21-21-22h-11c-2 0-4 0-6-3l-7-7c-4-3-9-5-15-5-5 0-10 2-14 6-3 1-5 3-6 5-3 4-5 5-9 4h-9a25 25 0 00-21 33v1c0 2 0 3-2 5l-5 5-1 2a26 26 0 00-2 29c1 4 4 7 7 10l3 3-1 4c0 15 12 26 26 26h6c3-1 5 0 7 2 3 4 6 7 10 9a22 22 0 0023-1c4-1 8-4 10-8l6-3 6 1c15 0 26-11 26-25v-3c0-2 1-4 3-5l7-9c2-4 4-9 4-14 0-7-2-13-7-18zm-29-9l-37 55c-2 2-3 4-5 4-4 0-6-1-8-3L42 86c-3-3-4-7-1-10s7-3 10 1l13 12c2 2 3 2 4-1l31-46c3-4 6-6 11-3 4 3 3 7 1 11z" fill="#1da0f1"/>\n<path d="M110 39c-4-3-8-1-11 3L68 89c-1 2-2 2-4 0L51 77c-3-4-7-4-10-1s-2 7 1 10l20 20c1 2 3 3 7 3 2 0 3-2 5-4l37-55c2-4 3-8-1-11z" fill="#fefefe"/>\n</svg>',null===(e=null==t?void 0:t.querySelector("svg"))||void 0===e||e.classList.add("user-badge-tick")});document.querySelectorAll('img[src*="/avicons_strict/"]').forEach(o=>{o.src="https://static.emeraldchat.com/uploads/picture/image/9675465/avicons_strict.png"})}function yo(){var o,e;if(!z.get(W.fancyColors))return;const t=document.querySelector('label.ui-select[for="flair-select"]');if(t&&(t.htmlFor="flair-select-old","flair-select"===(null===(o=t.firstElementChild)||void 0===o?void 0:o.id))){const o=new Event("change",{bubbles:!0}),n=t.cloneNode();n.classList.add("disable-after"),t.firstElementChild.id="flair-select-old",t.style.display="none";const r=Q("input",{id:"flair-select",className:"alt-flair-select",value:App.user.flair.color}),i=Q("input",{id:"flair-select",type:"color",className:"picker-flair-select",value:App.user.flair.color,oninput:()=>{var e;r.value=i.value,null===(e=t.firstChild)||void 0===e||e.dispatchEvent(o)}});n.append(r,i),null===(e=t.parentElement)||void 0===e||e.insertBefore(n,t.nextSibling),r.oninput=()=>{var e;i.value=r.value,null===(e=t.firstChild)||void 0===e||e.dispatchEvent(o)}}}var wo=t(10),ko=t.n(wo);var Ao=function(o,e,t,n){return new(t||(t=Promise))((function(r,i){function a(o){try{s(n.next(o))}catch(o){i(o)}}function c(o){try{s(n.throw(o))}catch(o){i(o)}}function s(o){var e;o.done?r(o.value):(e=o.value,e instanceof t?e:new t((function(o){o(e)}))).then(a,c)}s((n=n.apply(o,e||[])).next())}))};function Ro(){var o,e,t,n;const r=document.querySelector(".main-logo");if(r instanceof HTMLImageElement&&r.src!==s&&(r.src=s),!document.head.querySelector(`link[rel="icon"][href="${s}"]`)){document.head.querySelectorAll('link[rel="icon"]').forEach(o=>o.remove());const o=Q("link",{rel:"icon",href:s});document.head.prepend(o)}const i=`${a} ${c}`;document.title!==i&&(document.title=i);if(!document.querySelector(".karma-tracker")){const e=Q("div",{className:"karma-tracker"});null===(o=null==r?void 0:r.parentElement)||void 0===o||o.insertBefore(e,null==r?void 0:r.nextSibling)}if(!document.querySelector(".main-logo-text")){const o=Q("div",{className:"main-logo-text",textContent:i});null===(e=null==r?void 0:r.parentElement)||void 0===e||e.insertBefore(o,null==r?void 0:r.nextSibling)}const l=document.querySelector(".navigation-notification-icons");if(document.fullscreenEnabled&&-1===(null===(n=null===(t=null==l?void 0:l.firstChild)||void 0===t?void 0:t.textContent)||void 0===n?void 0:n.indexOf("full"))){const o=Q("span",{className:"material-icons navigation-notification-unit",textContent:"open_in_full",onmousedown:()=>Ao(this,void 0,void 0,(function*(){document.fullscreenElement?(document.exitFullscreen(),o.textContent="open_in_full"):(yield document.body.requestFullscreen(),o.textContent="close_fullscreen")}))}),e=Q("span");e.append(o),l.prepend(e)}}var Co=t(11),xo=t.n(Co);var Oo=t(12),Mo=t.n(Oo);let Eo=null;function _o(){const{id:o}=App.user;o?$.ajax({type:"GET",url:"/profile_json?id="+o,dataType:"json",success:o=>{!function(o){if(o===Eo)return;if(null!==Eo){const e=o-Eo,t=Q("div",{className:"karma-delta "+(e>0?"positive":"negative"),textContent:e>0?"+"+e:e});document.body.append(t),setTimeout(()=>t.classList.add("zoom"),250),setTimeout(()=>t.remove(),5e3)}Eo=o;const e=o?"Karma: "+o:"",t=document.querySelector(".karma-tracker");t&&(t.textContent=e)}(o.user.karma),setTimeout(_o,6e4)},error:()=>{setTimeout(_o,6e4)}}):setTimeout(_o,500)}function Po(){const o=document.querySelector(".room-component-right .room-user-label");if(o){if(!o.querySelector(".lookup-button")){const e=Q("div",{className:"material-icons navigation-notification-unit lookup-button",textContent:"face",onclick:()=>{if("undefined"==typeof UserViewReact&&(UserViewGenerator.generate({event:{preventDefault:()=>{},clientX:100,clientY:100},user:{karma:100,id:2}}),"undefined"==typeof UserViewReact))return;const o=prompt("Enter a user id",""+UserViewReact.state.user.id);o&&(UserViewReact.state.user.id=+o,UserViewReact.view_profile())}});o.append(e)}}}var So=t(13),No=t.n(So);function $o(){var o,e;const t=document.querySelectorAll(".room-component-message-container"),n=null===(o=null===RoomClient||void 0===RoomClient?void 0:RoomClient.state)||void 0===o?void 0:o.messages;if(null==n?void 0:n.length)for(let o=0;o<n.length;o+=1){const r=t[o],{messages:i}=n[o],a=null===(e=null==r?void 0:r.querySelector(".room-component-message-text"))||void 0===e?void 0:e.childNodes;for(;a&&a.length>i.length;)a[0].remove();a&&(1===i.length&&/^\p{Extended_Pictographic}{1,5}$/u.test(i[0])?a[0].setAttribute("style","font-size: 5em"):a[0].removeAttribute("style"))}}const To=(()=>{let o=0;return()=>"key-"+ ++o})();Room.prototype.received=function(o){o.user.id!==App.user.id&&o.messages?(App.room.play_sound("/sfx/simple_alert.wav"),this.append(o,!0),PushNotifications.idle()&&PushNotifications.send(o.user.display_name,{icon:o.user.display_picture,body:o.messages[0]})):o.typing&&o.user.id!==App.user.id&&(this.setState({typing:o.user.display_name}),setTimeout(()=>this.stop_typing(),1e4))};var Uo=t(2),Bo=t.n(Uo);var Go=function(o,e,t,n){return new(t||(t=Promise))((function(r,i){function a(o){try{s(n.next(o))}catch(o){i(o)}}function c(o){try{s(n.throw(o))}catch(o){i(o)}}function s(o){var e;o.done?r(o.value):(e=o.value,e instanceof t?e:new t((function(o){o(e)}))).then(a,c)}s((n=n.apply(o,e||[])).next())}))};const jo={},Io={},Ko=[];function Lo(o){return Go(this,void 0,void 0,(function*(){if(!jo[o]){const e=(new TextEncoder).encode(o),t=yield crypto.subtle.digest("SHA-1",e),n=Array.from(new Uint8Array(t)).map(o=>o.toString(16).padStart(2,"0")).join("");jo[o]=n}return jo[o]}))}function Vo(){var o;document.querySelectorAll(".room-component-message-picture-container").forEach(o=>Go(this,void 0,void 0,(function*(){if(z.get(W.imgControl)&&!o.querySelector(".picture-control")){const e=Q("div",{className:"picture-control"});e.append(Q("div",{className:"picture-button block material-icons",textContent:"delete_forever",onmousedown:o=>{var e,t;if(o.target instanceof HTMLElement){const n=null===(t=null===(e=o.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===t?void 0:t.firstChild;!function(o){Go(this,void 0,void 0,(function*(){if(!o)return;const e=yield Lo(o);Io[e]=!0,z.set(W.blockedHashes,Object.keys(Io)),Vo()}))}(null==n?void 0:n.src)}}})),e.append(Q("div",{className:"picture-button save material-icons",textContent:"bookmark_border",onmousedown:o=>{var e,t,n;if(o.target instanceof HTMLElement){const r=null===(t=null===(e=o.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===t?void 0:t.firstChild;(n=null==r?void 0:r.src)&&(Ko.push(n),z.set(W.savedPictures,Ko))}}})),o.append(e)}if(o.firstChild instanceof HTMLImageElement){const{src:e}=o.firstChild,t=yield Lo(e);Io[t]&&(o.firstChild.src="")}})));const e=document.querySelector("form#picture_upload");if(!e)return;const t=e.parentElement,n=t.querySelector(".ui-menu-text");"B"===(null===(o=null==n?void 0:n.firstElementChild)||void 0===o?void 0:o.tagName)?n.style.display="none":n&&(n.style.display="");if(t.querySelector(".image-grid"))return;const r=t.querySelector(".ui-menu-buttons"),i=Q("div",{className:"image-grid"});Ko.forEach(o=>{i.append(Q("div",{style:`background-image: url(${encodeURI(o)})`,onmousedown:()=>{!function(o){const e=(new Date).toISOString(),t={author_id:App.user.id,created_at:e,description:null,id:955e4+~~(1e6*Math.random()),image:{thumb:{url:o},url:o},image_processing:!1,image_tmp:null,micropost_id:null,picture_album_id:null,temporary:!1,title:null,updated_at:e,url:o};PictureUploader.onUploaded(t)}(o),MenuReactMicro.close()}}))}),t.insertBefore(i,r)}function Fo(){var o;const e=document.evaluate("//li[text()='Emerald Gold']",document).iterateNext();z.get(W.adBlocker)?e instanceof HTMLElement&&e.remove():e&&(null===(o=null==e?void 0:e.parentElement)||void 0===o?void 0:o.firstChild)===e&&e.parentElement.append(e)}function Do(o){const{id:e,value:t,onChange:n}=o;return X.a.createElement("div",null,X.a.createElement("input",{type:"checkbox",id:e,checked:t,onChange:n}),X.a.createElement("label",{htmlFor:e},W[e].label))}function Ho(o){const{adBlocker:e,trackKarma:t,fancyColors:n,imgControl:r,imgProtect:i,imgBlur:a,hidePfp:c,showInfo:s,showGender:l,antiSpam:u,applySettings:d}=o;return X.a.createElement("div",null,X.a.createElement("div",{className:"m1 "+go.settingsSection},H.generalTitle),X.a.createElement(Do,{id:"adBlocker",value:e,onChange:()=>d({adBlocker:!e})}),X.a.createElement(Do,{id:"trackKarma",value:t,onChange:()=>d({trackKarma:!t})}),X.a.createElement(Do,{id:"fancyColors",value:n,onChange:()=>d({fancyColors:!n})}),X.a.createElement("div",{className:"m1 "+go.settingsSection},H.imagesTitle),X.a.createElement(Do,{id:"hidePfp",value:c,onChange:()=>d({hidePfp:!c})}),X.a.createElement(Do,{id:"imgControl",value:r,onChange:()=>d({imgControl:!r})}),X.a.createElement(Do,{id:"imgProtect",value:i,onChange:()=>d({imgProtect:!i})}),X.a.createElement(Do,{id:"imgBlur",value:a,onChange:()=>d({imgBlur:!a})}),X.a.createElement("div",{className:"m1 "+go.settingsSection},H.messageTitle),X.a.createElement(Do,{id:"antiSpam",value:u,onChange:()=>d({antiSpam:!u})}),X.a.createElement(Do,{id:"showGender",value:l,onChange:()=>d({showGender:!l})}),X.a.createElement(Do,{id:"showInfo",value:s,onChange:()=>d({showInfo:!s})}))}var Jo=t(14),Wo=t.n(Jo),zo=t(4),qo=t.n(zo),Xo=t(15),Yo=t.n(Xo),Qo=t(16),Zo=t.n(Qo);const oe=["default","ritsu","light"];function ee(){const o=z.get(W.theme);let e=document.head.querySelector(".custom-theme");e||(document.head.append(Q("style",{className:"custom-theme",type:"text/css"})),e=document.head.querySelector(".custom-theme"));const t=[Wo.a];switch(o){case"default":default:break;case"ritsu":t.push(qo.a,Yo.a);break;case"light":t.push(qo.a,Zo.a)}e.textContent=t.join("\n")}function te(o){const{theme:e,applyTheme:t}=o;return X.a.createElement("div",null,X.a.createElement("div",{className:"m1 "+go.settingsSection},H.themeTitle),oe.map(o=>X.a.createElement("div",null,X.a.createElement("input",{type:"radio",id:o,name:"theme",value:o,checked:e===o,onChange:()=>t(o)}),X.a.createElement("label",{htmlFor:o},o[0].toUpperCase()+o.slice(1)))))}class ne extends X.a.Component{constructor(){super({}),this.applySettings=o=>{const{settings:e}=this.state,t=Object.assign(Object.assign({},e),o);Object.keys(o).forEach(e=>z.set(W[e],o[e])),ae(),this.setState({settings:t,needsReload:!0})},this.applyTheme=o=>{z.set(W.theme,o),document.body.classList.add("themeChange"),ee(),this.setState({theme:o}),setTimeout(()=>document.body.classList.remove("themeChange"),1e3)},this.g=o=>{0},this.state=Object.assign(Object.assign({},ie()),{needsReload:!1})}render(){const{theme:o,settings:e,h:t,needsReload:n}=this.state;return X.a.createElement("div",null,X.a.createElement(Ho,Object.assign({},e,{applySettings:this.applySettings})),X.a.createElement(te,{theme:o,applyTheme:this.applyTheme}),!1,n&&X.a.createElement("div",{className:go.reloadWarning},"You may need to reload the app for your changes to take effect."))}}function re(){return X.a.createElement(Menu,null,X.a.createElement("div",{key:"custom_menu",className:go.ritsuMenuContainer},"Ritsu Settings",X.a.createElement("br",null),X.a.createElement("br",null),X.a.createElement(ne,null),X.a.createElement("div",{className:"ui-menu-buttons"},X.a.createElement("div",{role:"button",tabIndex:0,className:"ui-button-text",onMouseDown:()=>MenuReact.close()},"Close"))))}function ie(){return Object.assign(Object.assign({theme:z.get(W.theme)},!1),{settings:{adBlocker:z.get(W.adBlocker),trackKarma:z.get(W.trackKarma),fancyColors:z.get(W.fancyColors),imgControl:z.get(W.imgControl),imgProtect:z.get(W.imgProtect),imgBlur:z.get(W.imgBlur),hidePfp:z.get(W.hidePfp),showInfo:z.get(W.showInfo),showGender:z.get(W.showGender),antiSpam:z.get(W.antiSpam)}})}function ae(){const o=ie();let e;e=o.settings,Object.keys(e).forEach(o=>{"boolean"==typeof e[o]&&document.documentElement.classList.toggle(o,e[o])}),ee()}function ce(){Bo.a.render(X.a.createElement(re,null),document.getElementById("ui-hatch"))}function se(){var o;document.querySelector(".navigation-dropdown-ritsu")||null===(o=document.querySelector(".navigation-dropdown-content"))||void 0===o||o.prepend(Q("li",{className:"navigation-dropdown-ritsu",textContent:"Ritsu Menu",onmousedown:ce}))}let le;function ue(o,e){var t;"setState"in RoomChannelMembersClient&&(null===RoomClient||void 0===RoomClient||RoomClient.setState({messages:[],current_channel:o}),RoomChannelMembersClient.setState({members:[]}),App.room.join(o),document.querySelectorAll(".channel-unit").forEach(o=>o.classList.remove("channel-unit-active")),null===(t=document.querySelector(e))||void 0===t||t.classList.add("channel-unit-active"),null===RoomClient||void 0===RoomClient||RoomClient.print(X.a.createElement("div",null,H.privateRoomsWarning)),le=o)}function de(){const o=document.querySelectorAll(".channel-unit");if(!o.length)return;const e=o[o.length-1];if(e.textContent===H.privateRooms)return;const t=Q("div",{className:"room-user-label",textContent:H.hiddenChannels}),n=Q("div",{className:"wfaf channel-unit",textContent:H.WFAF,onclick:()=>{document.querySelector(".wfaf.channel-unit-active")||ue("",".wfaf")}}),r=Q("div",{className:"private-rooms channel-unit",textContent:H.privateRooms,onclick:()=>function(){const o=prompt(H.privateRoomsPrompt);null!=o&&ue(o,".private-rooms")}()}),i=e.parentElement;i.insertBefore(r,e.nextSibling),i.insertBefore(n,r),i.insertBefore(t,n);const a=ActionCable.Subscriptions.prototype.reject;ActionCable.Subscriptions.prototype.reject=function(o){o===App.room.client.identifier&&App.room.id===le&&no("ERROR: You could not join room "+(le||"WFAF")),a.call(this,o)}}var me=function(o,e,t,n){return new(t||(t=Promise))((function(r,i){function a(o){try{s(n.next(o))}catch(o){i(o)}}function c(o){try{s(n.throw(o))}catch(o){i(o)}}function s(o){var e;o.done?r(o.value):(e=o.value,e instanceof t?e:new t((function(o){o(e)}))).then(a,c)}s((n=n.apply(o,e||[])).next())}))};!function(){me(this,void 0,void 0,(function*(){const o=`(${[]})`;var e;n.log(`${a} Version ${c} ${o}`),yield(e=()=>!!k.App,Y(void 0,void 0,void 0,(function*(){for(;!e();)yield io()}))),function(){if("undefined"==typeof GM_getValue)return;const o=GM_getValue("theme",!1);o&&(z.set(W.theme,o),n.log("Migrated THEME"),GM_deleteValue("theme"));const e=GM_getValue("hacks",!1);e&&(z.set(W.adBlocker,!!e.disableNags),z.set(W.fancyColors,!!e.fancyColors),n.log("Migrated HACKS"),GM_deleteValue("hacks"));const t=GM_getValue("settings",!1);t&&(z.set(W.imgControl,!!t.imgControl),z.set(W.imgProtect,!!t.imgProtect),z.set(W.showInfo,!!t.showInfo),n.log("Migrated SETTINGS"),GM_deleteValue("settings"));const r=GM_getValue("blockedPictures",!1);if(r instanceof Array){const o=[...z.get(W.blockedHashes)];r.forEach(e=>{o.includes(e)||o.push(e)}),z.set(W.blockedHashes,o),n.log("Migrated BLOCKED PICTURES"),GM_deleteValue("blockedPictures")}const i=GM_getValue("savedPictures",!1);if(i instanceof Array){const o=[...z.get(W.savedPictures)];i.forEach(e=>{o.includes(e)||o.push(e)}),z.set(W.savedPictures,o),n.log("Migrated SAVED PICTURES"),GM_deleteValue("savedPictures")}}(),function(){function o(o){if(o.updater.isMounted(o)){const e=Bo.a.findDOMNode(o);e&&Bo.a.unmountComponentAtNode(e.parentNode)}}function e(){$("#menu-micro-bg").removeClass("animated fadeIn"),$("#menu-micro-bg").addClass("animated fadeOut"),$("#menu-micro").addClass("animated zoomOut"),setTimeout(o.bind(null,this),250)}function t(){o(this)}k.MenuReactMicroStatic||(k.MenuReactMicroStatic={close:()=>null===MenuReactMicro||void 0===MenuReactMicro?void 0:MenuReactMicro.close()}),k.DashboardClient||(k.DashboardClient={setState:()=>{}}),Menu.prototype.close=function(){$(".ui-bg").removeClass("animated fadeIn"),$(".ui-bg").addClass("animated fadeOut"),$(".ui-menu").addClass("animated zoomOut"),setTimeout(o.bind(null,this),250)},UserProfile.prototype.close=function(){$(".ui-bg").removeClass("animated fadeIn"),$(".ui-bg").addClass("animated fadeOut"),$(".user-profile-menu").addClass("animated zoomOut"),setTimeout(o.bind(null,this),250),setTimeout(()=>{UserProfileReact=null})},MenuMicro.prototype.close=e,MenuMicroStatic.prototype.close=e,UserView.prototype.close=function(){document.removeEventListener("mousedown",this.exit_click,!1),o(this)},UserView.prototype.view_profile=function(){const{id:e}=this.state.user;UserProfileReact?UserProfileReact.switch(e):Bo.a.render(X.a.createElement(UserProfile,{key:e,id:e}),document.getElementById("ui-hatch")),o(this)},Popup.prototype.close=t,Picture.prototype.close=t,UserProfile.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/profile_json?id="+this.props.id,dataType:"json",success:o=>{this.setState({data:o})},error:()=>{this.close()}})},App.temp.check=()=>{},Room.prototype.trim_messages=function(){const o="channel"===this.state.mode?100:5e3,{messages:e}=this.state;e.length>o&&e.shift(),this.setState({messages:e})}}(),oo(co.a),document.body.addEventListener("mouseup",({target:o})=>{o instanceof HTMLElement&&o.classList.contains("mute-button")&&Cookies.set("muted",MuteButtonClient.state.muted?"t":"")}),MuteButton.prototype.componentDidMount=function(){const o=Cookies.get("muted");this.setState({muted:"t"===o||void 0===o})},ae(),function(){oo(No.a);const o=Message.prototype.render;Message.prototype.render=function(){var e;const{user:t}=this.props.data,n=o.apply(this);n.props["data-id"]=t.id;const r=n.props.children[1];if(z.get(W.imgProtect)){const{picture:o}=this.props.data;if(o&&(t.temp||t.karma<10)){delete r.props.children[1].props.children}}if(z.get(W.showInfo)){r.props.children[0].props.children.push(X.a.createElement("span",{className:"user-extra"},X.a.createElement("b",null,"Karma: "),null!==(e=t._karma)&&void 0!==e?e:t.karma,X.a.createElement("b",null," Since "),new Date(t.created_at).toLocaleDateString(),t.master&&!t.proxy&&X.a.createElement("b",{style:{color:"#f00"}}," CALLAN "),t.mod&&!t.proxy&&X.a.createElement("b",{style:{color:"#f00"}}," MOD ")))}return n}}(),z.get(W.blockedHashes).forEach(o=>{Io[o]=!0}),Ko.push(...z.get(W.savedPictures)),oo(vo.a),oo(xo.a),function(){const o=PictureAlbum.prototype.render;PictureAlbum.prototype.render=function(){return this.state.loaded?o.call(this):X.a.createElement(ho,null)},PictureAlbum.prototype.load_pictures=function(){$.ajax({type:"GET",url:`/pictures_load_more?id=${this.state.album.id}&loaded=${this.state.pictures.length}&load_count=7`,dataType:"json",success:function(o){const e=this.state.pictures.concat(o.pictures);this.setState({pictures:e})}.bind(this)})},PictureAlbum.prototype.load_more_button=function(){return this.state.pictures_count>this.state.pictures.length?X.a.createElement(ho,null):null};const e=PictureAlbum.prototype.setState;PictureAlbum.prototype.setState=function(o){var t,n;o&&"pictures"in o&&(null===(t=this.state.pictures)||void 0===t?void 0:t.length)!==(null===(n=null==o?void 0:o.pictures)||void 0===n?void 0:n.length)&&setTimeout(()=>this.load_pictures()),e.call(this,o)}}(),function(){Room.prototype.room_input=function(){return X.a.createElement("div",{className:"room-component-input"},X.a.createElement("textarea",{className:"room-component-input-textarea",onMouseDown:this.scroll,onKeyDown:this.input.bind(this),id:"room-input",placeholder:"Say Something..."}),X.a.createElement("span",{onMouseDown:this.upload_picture.bind(this),className:"room-component-input-icon material-icons"},"photo_camera"))},Room.prototype.send_picture=function(o){this.append({messages:[],user:App.user,picture:o});const e=o.url.match(/^https:\/\/static.emeraldchat.com\/uploads\/picture\/(.*)$/),t=e?`Image: [${btoa(e[1])}]`:void 0;App.room.client.speak({message:t,picture:o}),this.scroll()};const o=Room.prototype.received;Room.prototype.received=function(e){var t;if(null===(t=e.messages)||void 0===t?void 0:t[0]){const t=e.messages[0].match(/^Image: \[([a-zA-Z0-9/=-]+)\]$/);if(t)return void o.call(this,{messages:[],user:e.user,picture:{url:"https://static.emeraldchat.com/uploads/picture/"+atob(t[1])}})}o.call(this,e)}}(),_o(),oo(Mo.a),function(){const o={},e={},t=RoomChannelSelect.prototype.join;RoomChannelSelect.prototype.join=function(o){o.members&&(o.members=o.members.filter(o=>!!o)),t.call(this,o)};const n=RoomChannelMembers.prototype.setState;function r(t){if(null==(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.id)||"private"===(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.mode))return;if(t.user.display_name=`⁦${t.user.display_name}⁩`,"state"in RoomChannelMembersClient&&t.user&&(t.user_disconnected?ro(`User ${t.user.display_name} left the chat.`):(RoomChannelMembersClient.state.members.some(o=>o.id===t.user.id)||ro(`User ${t.user.display_name} joined the chat.`),RoomChannelMembersClient.add_member(t.user))),void 0===t.messages)return;const{id:n,display_name:r}=t.user;if(App.user.id===n)return;const i=t.messages.join(""),a=Date.now(),c=i.split("").filter(o=>o.toLowerCase()!==o);o[n]||(o[n]={score:1,score2:0,d:0,p:""});const s=o[n];s.score+=Math.pow(1e3/(a-s.d||a),.2),s.score/=Math.max(1/Math.E,Math.E-Math.log(10+i.length+c.length)/4);const l=a-s.d||1500;l<=1e3?s.score2+=1:l>2e3&&(s.score2=Math.max(0,s.score2-Math.log10(l))),s.d=a,s.p=i,console.log(`%cspam s1=${s.score.toFixed(2)} s2=${s.score2.toFixed(2)} ${r}: ${i}`,function(o){return o.score>=1||o.score2>=3?"color:red":o.score>.8||o.score2>=1?"color:orange":""}(s)),s.score2>=3&&!App.room.muted.includes(n)&&z.get(W.antiSpam)&&(e[n]=!0,App.room.mute(n,r,"spam"),ro(`AutoMute: Muted user ${r}.`)),s.score2<1&&App.room.muted.includes(n)&&e[n]&&(delete e[n],App.room.unmute(n),ro(`AutoMute: Unmuted user ${r}.`))}function i(){var o,e;null===(o=document.querySelector(".wfaf"))||void 0===o||o.classList.remove("channel-unit-active"),null===(e=document.querySelector(".private-rooms"))||void 0===e||e.classList.remove("channel-unit-active"),eo(App.room.client,"received",r,!0)}RoomChannelMembers.prototype.setState=function(o){o&&"members"in o&&(o.members=o.members.filter(o=>!!o).sort((o,e)=>o.display_name.localeCompare(e.display_name))),n.call(this,o)},eo(App.room,"join",i),App.room.client&&i()}(),function(){const o=z.get(W.showGender);document.documentElement.classList.toggle("showGender",o),oo(ko.a);const e=MessageNotificationUnit.prototype.image;MessageNotificationUnit.prototype.image=function(){const o=e.apply(this);return o.props["data-gender"]=this.props.data.data.sender.gender,o};const t=NotificationUnit.prototype.image;NotificationUnit.prototype.image=function(){const o=t.apply(this);return o.props["data-gender"]=this.props.data.data.sender.gender,o};const n=FriendUnit.prototype.body;FriendUnit.prototype.body=function(){const o=n.apply(this);return o.props.children[0].props["data-gender"]=this.props.data.gender,o};const r=RoomUserUnit.prototype.body;RoomUserUnit.prototype.body=function(){const o=r.apply(this);return"img"===o.props.children[0].type&&(o.props.children[0].props["data-gender"]=this.props.data.gender),o};const i=SearchUnit.prototype.body;SearchUnit.prototype.body=function(){const o=i.apply(this);return o.props.children[0].props["data-gender"]=this.props.data.gender,o};const a=UserUnit.prototype.body;UserUnit.prototype.body=function(){const o=a.apply(this);return o.props.children[0].props["data-gender"]=this.props.data.gender,o};const c=Message.prototype.render;Message.prototype.render=function(){const o=c.apply(this);return o.props.children[0].props.children.props["data-gender"]=this.props.data.user.gender,o}}(),Room.prototype.room_messages=function(o="room-component-messages"){let e=null,t="",n=0;for(let o=0;o<this.state.messages.length;o+=1)n+=this.state.messages[o].messages.length;return this.state.messages_count>n&&this.state.messages.length>0&&(e=X.a.createElement("div",{role:"button",tabIndex:0,onMouseDown:()=>this.load_messages(n),className:"room-component-load-button"},"Load More (",n," of ",this.state.messages_count,")")),"private"===this.state.mode&&this.state.messages.length<1&&(t=X.a.createElement("div",{className:"room-notification"},"No messages here yet. Start a conversation!")),RoomChannelSelectClient.state&&"channel"===this.state.mode&&this.state.messages.length<1&&(t=X.a.createElement("div",{className:"room-notification"},"No messages here yet!")),X.a.createElement("div",{id:"messages",className:o},X.a.createElement(MuteButton,null),this.state.print,t,e,this.state.messages.map(o=>(o.key||(o.key=To()),X.a.createElement(Message,{data:o,key:o.key}))),this.state.print_append)},Room.prototype.append=function(o,e){0===o.messages.length&&o.messages.push("");const t="channel"===this.state.mode?50:5e3,{messages:n}=this.state;if(n.length>t&&n.shift(),n[n.length-1]&&n[n.length-1].user.id===o.user.id&&!n[n.length-1].picture&&!o.picture&&n[n.length-1].messages.length<16){const e=n[n.length-1].messages,t=e[e.length-1];if(o.messages[0]===t)return;n[n.length-1].messages.push(o.messages[0])}else n.push(o);let{typing:r}=this.state;e&&(o.typing?o.user.id!==App.user.id&&(r=o.user.display_name,setTimeout(()=>this.stop_typing(),1e4)):(r=null,App.room.typing=null)),this.setState({messages:n,typing:r})},function(o){function e(){o.forEach(o=>o())}let t;new MutationObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(e)}).observe(document.body,{subtree:!0,childList:!0}),e()}([Fo,se,Ro,Vo,yo,Po,$o,so,bo,de])}))}()}]);