// ==UserScript==
// @name         Ritsu x Emerald
// @version      0.11.0
// @description  Custom Emerald Chat themes and fixes.
// @author       Atsos/Ritsu, Aqua, Strawberry.
// @icon         https://i.imgur.com/KLtVhho.png
// @match        *://emeraldchat.com/app
// @match        *://www.emeraldchat.com/app
// @namespace    Emerald Bot - Ritsu Project
// @run-at       document-end
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        unsafeWindow
// ==/UserScript==
!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=46)}([function(t,e){t.exports=React},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var r=(s=o,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),i=o.sources.map((function(t){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(t," */")}));return[n].concat(i).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(o)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);o&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},function(t,e){t.exports=ReactDOM},,,function(t,e,n){"use strict";var o=n(1),r=n.n(o)()(!0);r.push([t.i,'._3B6q_5OTXi-a3CXdwPEQy-{margin:2em;text-align:center;color:#e33}._3tf_pFd0gVgIPLUPiJgMkk{height:calc(100% - 46px);overflow:auto}._3Sq5HmxyS1XyN6bIcGdQH2{padding-top:1em}._3eP0_BWRRPqybKC0gcIAwL{width:80px;height:80px}._3eP0_BWRRPqybKC0gcIAwL:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid #8ac;border-color:#8ac transparent #8ac transparent;animation:_3eP0_BWRRPqybKC0gcIAwL 1.2s linear infinite}@keyframes _3eP0_BWRRPqybKC0gcIAwL{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}._3lNXtBAgkogbcB5t6_cJmF{margin-left:.5em;cursor:pointer}',"",{version:3,sources:["webpack://src/components/style.module.scss"],names:[],mappings:"AAAA,yBACE,UAAA,CACA,iBAAA,CACA,UAAA,CAGF,yBACE,wBAAA,CACA,aAAA,CAGF,yBACE,eAAA,CAIF,yBACE,UAAA,CACA,WAAA,CAEF,+BACE,WAAA,CACA,aAAA,CACA,UAAA,CACA,WAAA,CACA,UAAA,CACA,iBAAA,CACA,qBAAA,CACA,8CAAA,CACA,sDAAA,CAEF,mCACE,GACE,sBAAA,CAEF,KACE,wBAAA,CAAA,CAIJ,yBACE,gBAAA,CACA,cAAA",sourcesContent:['.reload-warning {\n  margin: 2em;\n  text-align: center;\n  color: #e33;\n}\n\n.ritsu-menu-container {\n  height: calc(100% - 46px);\n  overflow: auto;\n}\n\n.settings-section {\n  padding-top: 1em;\n}\n\n// spinner thingy\n.lds-dual-ring {\n  width: 80px;\n  height: 80px;\n}\n.lds-dual-ring:after {\n  content: " ";\n  display: block;\n  width: 64px;\n  height: 64px;\n  margin: 8px;\n  border-radius: 50%;\n  border: 6px solid #8ac;\n  border-color: #8ac transparent #8ac transparent;\n  animation: lds-dual-ring 1.2s linear infinite;\n}\n@keyframes lds-dual-ring {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n.permamute-list {\n  margin-left: 0.5em;\n  cursor: pointer;\n}\n'],sourceRoot:""}]),r.locals={reloadWarning:"_3B6q_5OTXi-a3CXdwPEQy-",ritsuMenuContainer:"_3tf_pFd0gVgIPLUPiJgMkk",settingsSection:"_3Sq5HmxyS1XyN6bIcGdQH2",ldsDualRing:"_3eP0_BWRRPqybKC0gcIAwL",permamuteList:"_3lNXtBAgkogbcB5t6_cJmF"},e.a=r},function(t,e,n){var o=n(38);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(29);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(30);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(31);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(32);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(33);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(34);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(35);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(36);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){"use strict";var o,r=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},i=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function a(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},o=[],r=0;r<t.length;r++){var i=t[r],c=e.base?i[0]+e.base:i[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var d=a(u),f={css:i[1],media:i[2],sourceMap:i[3]};-1!==d?(s[d].references++,s[d].updater(f)):s.push({identifier:u,updater:g(f,e),references:1}),o.push(u)}return o}function l(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var r=n.nc;r&&(o.nonce=r)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var s=i(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var u,d=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function f(t,e,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var i=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function m(t,e,n){var o=n.css,r=n.media,i=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var h=null,p=0;function g(t,e){var n,o,r;if(e.singleton){var i=p++;n=h||(h=l(e)),o=f.bind(null,n,i,!1),r=f.bind(null,n,i,!0)}else n=l(e),o=m.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var r=a(n[o]);s[r].references--}for(var i=c(t,e),l=0;l<n.length;l++){var u=a(n[l]);0===s[u].references&&(s[u].updater(),s.splice(u,1))}n=i}}}},function(t,e,n){var o=n(37);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(39);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(40);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(41);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(42);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(43);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(44);t.exports="string"==typeof o?o:o.toString()},function(t,e,n){var o=n(45);t.exports="string"==typeof o?o:o.toString()},,,,,,function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.adBlocker .emerald-jumbotron-message{display:none}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.picture-upload-info{font-size:14px;font-weight:400;color:"#adb6c7"}.picture-upload-info div{margin-bottom:1em}.picture-upload-error{color:red;font-weight:bold}.picture-upload-error-reason{font-weight:initial}.upload-thing{vertical-align:middle;margin-right:5px}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".top-message{position:absolute;top:2px;font-size:1.5em;font-weight:bold;padding:6px;margin:auto;border:solid 4px #800;border-radius:8px;background-color:#f88;color:#300;cursor:pointer}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.imgBlur div.ritsu-would-blur>img{filter:blur(7px);transition:filter 1s ease}html.imgBlur div:hover.ritsu-would-blur>img{filter:blur(0px)}.room-component-message-text.room-component-message-text,.notification-unit-body.notification-unit-body{overflow:visible}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.showGender .room-component-message-avatar,html.showGender .navigation-notification-unit-image{border-color:#fff;border:2px inset;width:36px;height:36px;margin:-2px 10px -2px -2px}html.showGender .room-component-message-avatar[data-gender=m],html.showGender .navigation-notification-unit-image[data-gender=m]{border-color:#0070ff}html.showGender .room-component-message-avatar[data-gender=f],html.showGender .navigation-notification-unit-image[data-gender=f]{border-color:#ff80ea}html.showGender .room-component-message-avatar{width:42px;height:42px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"html.hidePfp .room-component-message-left,html.hidePfp .navigation-notification-unit-image{display:none}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".karma-tracker,.karma-delta{display:none}html.trackKarma .karma-tracker{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:1.5em;color:var(--menu-fg-color)}html.trackKarma .karma-delta{display:block;position:absolute;top:50%;left:50%;opacity:1;transform:translateX(-50%) translateY(-50%) scale(0.1);transition:all 2s ease-out;pointer-events:none}html.trackKarma .karma-delta.positive{color:green}html.trackKarma .karma-delta.negative{color:red}html.trackKarma .karma-delta.zoom{opacity:0;transform:translateX(-50%) translateY(-50%) scale(20)}html.trackKarma .notification-unit-body.down{background:#ff808080}html.trackKarma .notification-unit-body.up{background:#80ff8080}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".room-component-message-right{flex-direction:row;justify-content:flex-start;align-items:baseline}.user-badge-container{align-self:center}.user-badge-tick{display:flex;position:static}.room-component-flair{max-width:100%}.jumbo-message:not(.ritsu-message-hidden>*){font-size:5em}.user-extra{padding:0 .5em}html.imgBlur .ritsu-would-blur{filter:blur(4px);transition:filter .3s}html.imgBlur .ritsu-would-blur-heavy{filter:blur(8px);transition:filter .3s}html.imgBlur .ritsu-would-blur:hover,html.imgBlur .ritsu-would-blur-heavy:hover{filter:blur(0px)}.text-only{max-height:8em;overflow:auto !important}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.actionicon-mega:last-child{display:none}.main-logo.main-logo{height:38px}.room-component-message-picture-container{position:relative}.picture-control{display:none;position:absolute;top:0;font-size:2em;font-weight:900}.room-component-message-picture:hover+.picture-control,.picture-control:hover{display:block;cursor:pointer}.picture-button{padding:.5em;border:1px solid var(--app-fg-color);border-radius:2px;background:var(--app-bg-color);color:var(--app-fg-color)}.picture-button.block:hover{color:red}.picture-button.save:hover{color:green}.image-grid div{display:inline-block;width:6em;height:6em;margin:5px;background-size:contain;background-repeat:no-repeat;background-position:center;cursor:pointer}.image-grid div>div{width:unset;height:unset;zoom:.6}.disable-after::after{content:"";display:none}.picker-flair-select{height:3em !important;vertical-align:bottom}.navigation-dropdown-ritsu{color:#f965fec4}.main-logo-text{display:inline-block;line-height:14px;height:32px;vertical-align:middle;font-size:1.3em;padding-left:.5em}@media screen and (max-width: 640px){.main-logo-text{display:none}}body.themeChange *{transition:background-color .3s,color .3s,border-color .3s}@media screen and (min-width: 640px){body{overflow:hidden}}body.tmp-message span.room-component-print:last-of-type{margin:-1em 0}.user-profile-micro.user-profile-micro{width:auto}.navigation-notification-badge{position:absolute}.channel-expand-icon{padding:8px}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--ritsu-hair-color: #f965fec4;--ritsu-hair-dark-color: #b821bd}html>body{background:var(--app-bg-color)}body>div>nav{background:var(--header-bg-color)}.room-component-left.room-component-left{background:var(--roomlist-bg-color)}.room-component-center.room-component-center{background:var(--chat-bg-color)}.room-component-right.room-component-right{background:var(--userlist-bg-color)}.room-component-messages{background:var(--chat-bg-color)}.room-notification.room-notification{background:var(--chat-bg-color)}.room-component-print.room-component-print{color:var(--message-fg-color)}.room-component-input{background:var(--input-bg-color)}.room-component-input-textarea.room-component-input-textarea{color:var(--input-fg-color)}.ui-button-match{background:var(--input-bg-color)}#container{background:var(--app-bg-color)}.room-component-container.room-component-container{color:var(--app-fg-color)}.dashboard-button.animated.zoomIn{background:var(--dashboard-button-bg-color)}.navigation-notification-icons.navigation-notification-icons{background:transparent}.ui-search-box{background:var(--search-bg-color);color:var(--search-fg-color)}.side-panel.side-panel{background:var(--panel-bg-color)}.actionicon-mega.actionicon-mega{color:var(--panel-fg-color)}.actionicon-mega.actionicon-mega:hover{background:var(--item-hover-bg-color)}.ui-bg.ui-bg{background:var(--dialog-overlay-bg-color)}.ui-menu.ui-menu,.notification-unit.notification-unit{background:var(--dialog-bg-color);color:var(--dialog-fg-color)}.ui-interests-bg.ui-interests-bg{background:var(--interests-bg-color) !important}.navigation-notification-unit.navigation-notification-unit:hover{background:var(--header-hover-bg-color);color:var(--header-hover-fg-color)}.navigation-notification-unit{color:var(--header-fg-color)}:last-child>.navigation-notification-unit{color:var(--header-hover-fg-color)}.navigation-dropdown-content.navigation-dropdown-content{background:var(--menu-bg-color);color:var(--menu-fg-color)}.dashboard-icon.dashboard-icon{color:var(--dashboard-icon-fg-color)}.dashboard-button.dashboard-button:hover{color:var(--dashboard-hover-fg-color);background:var(--dashboard-hover-bg-color)}.actionicon-icon.actionicon-icon{color:var(--dashboard-icon-fg-color)}.main-hamburger.main-hamburger{color:var(--header-fg-color)}.main-hamburger.main-hamburger:hover,.main-logo.main-logo:hover{background:var(--header-hover-bg-color) !important;color:var(--header-hover-fg-color)}.user-profile-menu.user-profile-menu{background:var(--dialog-bg-color)}.user-micropost-input-background.user-micropost-input-background{background:var(--dialog-input-bg-color)}.user-micropost-input.user-micropost-input{color:var(--dialog-input-fg-color)}.ui-button-micro.ui-button-micro{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.user-profile-tab.user-profile-tab,.ui-tab.ui-tab{color:var(--tab-fg-color)}.user-profile-tab-active.user-profile-tab-active,.ui-tab-active.ui-tab-active{color:var(--tab-active-fg-color)}.ui-button-mega.ui-button-mega:hover{background:var(--dialog-button-hover-bg-color);color:var(--dialog-button-hover-fg-color)}.ui-button-mega.ui-button-mega{background:var(--dialog-button-bg-color);color:var(--dialog-button-fg-color)}.ui-input.ui-input{background:var(--dialog-input-bg-color) !important}.dashboard-card-image.dashboard-card-image{border-color:var(--dashboard-icon-fg-color)}.user-comment-input-background.user-comment-input-background{background:var(--dialog-input-bg-color)}.user-comment-input.user-comment-input{color:var(--dialog-input-fg-color)}.room-component-left .room-user-label{color:var(--roomlist-title-fg-color)}.room-component-right .room-user-label{color:var(--userlist-title-fg-color)}.picture-upload-button.picture-upload-button+label{background:var(--upload-button-bg-color);color:var(--upload-button-fg-color)}.main-logo-text{color:var(--menu-fg-color)}.navigation-dropdown-ritsu{color:var(--ritsu-menu-fg-color)}.navigation-dropdown-ritsu:hover{color:var(--ritsu-menu-hover-fg-color)}.notification-menu-container-text{color:var(--dialog-fg-color)}.notification-menu-container-text span{text-shadow:#000 0 0 3px}.user-flair.user-flair,.user-extra-gender{text-shadow:-0.05em -0.05em #fff5}.user-profile-picture-wrapper .btn{margin-top:.2rem;margin-bottom:.5rem;color:var(--upload-button-fg-color);border:solid;border-color:#26292f;border-width:2px;background-color:var(--dashboard-icon-bg-color)}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--header-bg-color: #100f10;--header-alt-bg-color: #232529;--header-hover-bg-color: #3d4046;--app-bg-color: black;--dialog-bg-color: #111;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.93);--dialog-button-bg-color: #17191b;--dialog-button-hover-bg-color: #151515;--dialog-input-bg-color: #17191b;--dashboard-button-bg-color: #100f10;--dashboard-hover-bg-color: #33323270;--roomlist-bg-color: black;--chat-bg-color: black;--userlist-bg-color: black;--input-bg-color: #211f21;--search-bg-color: #0b0b0b;--panel-bg-color: #0c0c0c;--item-hover-bg-color: #35383e;--interests-bg-color: #2c2f35;--menu-bg-color: #0a0a0a;--upload-button-bg-color: #41444a;--header-fg-color: white;--header-hover-fg-color: var(--ritsu-hair-color);--app-fg-color: #bebfc5;--dialog-fg-color: #f1f1f2;--dialog-button-fg-color: #d5dcec;--dialog-button-hover-fg-color: var(--ritsu-hair-color);--dialog-input-fg-color: #d7dfec;--dashboard-icon-fg-color: var(--ritsu-hair-color);--dashboard-hover-fg-color: var(--ritsu-hair-color);--roomlist-title-fg-color: #99a3b4;--userlist-title-fg-color: #99a3b4;--tab-fg-color: #c2c8d6;--tab-active-fg-color: var(--ritsu-hair-color);--message-fg-color: #afbacd;--input-fg-color: #caccd0;--search-fg-color: #f0f0f1;--panel-fg-color: white;--menu-fg-color: white;--upload-button-fg-color: #b4bccc;--ritsu-menu-fg-color: var(--ritsu-hair-color);--ritsu-menu-hover-fg-color: var(--ritsu-hair-color)}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,":root{--header-bg-color: #bbb;--header-alt-bg-color: #ccc;--header-hover-bg-color: #aaa;--app-bg-color: #ddd;--dialog-bg-color: #ddd;--dialog-overlay-bg-color: rgba(0, 0, 0, 0.5);--dialog-button-bg-color: #cfdeec;--dialog-button-hover-bg-color: #f0f0f0;--dialog-input-bg-color: #cfdeec;--dashboard-button-bg-color: #f0e4f0;--dashboard-hover-bg-color: #cfcdcd70;--roomlist-bg-color: #ccc;--chat-bg-color: #ddd;--userlist-bg-color: #ccc;--input-bg-color: #fff;--search-bg-color: #f7f7f7;--panel-bg-color: #ccc;--item-hover-bg-color: #a3adc0;--interests-bg-color: #aab6ce;--menu-bg-color: #aaa;--upload-button-bg-color: #ccc;--header-fg-color: #333;--header-hover-fg-color: var(--ritsu-hair-dark-color);--app-fg-color: #333;--dialog-fg-color: #333;--dialog-button-fg-color: #000;--dialog-button-hover-fg-color: var(--ritsu-hair-dark-color);--dialog-input-fg-color: #000;--dashboard-icon-fg-color: var(--ritsu-hair-dark-color);--dashboard-hover-fg-color: var(--ritsu-hair-dark-color);--roomlist-title-fg-color: #555;--userlist-title-fg-color: #555;--tab-fg-color: #444;--tab-active-fg-color: var(--ritsu-hair-dark-color);--message-fg-color: #666;--input-fg-color: #222;--search-fg-color: #222;--panel-fg-color: #333;--menu-fg-color: #333;--upload-button-fg-color: #444;--ritsu-menu-fg-color: var(--ritsu-hair-dark-color);--ritsu-menu-hover-fg-color: var(--ritsu-hair-color)}.user-flair.user-flair,.user-extra-gender{text-shadow:1px 1px 1px #000}.actionicon-mega.actionicon-mega:hover{background:#aaa}.ui-button-text.ui-button-text:hover{color:#666}.user-profile-menu.user-profile-menu{background:#ddd;color:#333}.user-micropost-unit.user-micropost-unit{color:#333}.ritsu-menu-container li{color:#666}.ritsu-menu-container li.selected{color:#222}.ritsu-menu-container li:hover{background:#fff}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,'.lookup-button{border:0;padding:0;background:none;margin-right:.5em;margin-top:-4px}.sort-button{width:20px;height:20px;font-weight:normal;text-transform:none}.sort-button>span{padding:0;margin-top:-4px}.sort-button>div.navigation-dropdown-content{text-align:left;width:180px;top:92px}.sort-button>div.navigation-dropdown-content>div{padding:7px;font-weight:500}.sort-button>div.navigation-dropdown-content>li{display:list-item;list-style:"Â Â Â "}.sort-button>div.navigation-dropdown-content>li.selected{list-style:"âœ“"}',""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".user-profile-bottom{width:100%;height:100%;overflow:clip;max-height:480px}.user-profile-menu{max-height:700px;height:700px}.user-comment-input-background{height:75px}.user-comment-input{resize:none;height:75px;line-height:normal}.user-micropost-input{max-height:133px;min-height:35px}.user-microposts{height:auto;max-height:420px}.room-component-input-textarea{bottom:0;max-height:133px}.room-component-input{bottom:0;height:auto;max-height:133px;min-height:35px;padding-top:4px;padding-bottom:4px}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".user-profile-picture-wrapper:hover .user-profile-picture-hover{display:inline-flex}.user-profile-picture-wrapper .user-profile-picture-hover{flex-direction:column;padding:0;justify-content:center;align-items:center}.room-component-message-avatar{color:transparent}#ritsu-profile-picture-upload{display:none}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,"a.ritsu-message-anchor{text-decoration:underline}.material-icons-inline{font-size:inherit}.material-icons{user-select:none}html.largerText .room-component-message-text{font-size:1.3rem}.bio-image{padding:.3em;margin:.5em;background-color:var(--ritsu-hair-color);color:#000;display:inline-block;user-select:none;border-radius:.3em;font-size:.8em}.bio-expand{color:#00abf3;font-weight:bold;cursor:pointer}",""]),t.exports=o},function(t,e,n){var o=n(1)(!1);o.push([t.i,".embed{width:auto !important;height:auto !important;object-fit:contain;margin-top:2px}.img-fluid{width:100%;height:100%;max-width:300px;max-height:300px;object-fit:contain}.spotify{width:100%;max-width:300px;border-radius:6px;frameborder:0}",""]),t.exports=o},function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"setPrefix",(function(){return m})),n.d(o,"setLogger",(function(){return h})),n.d(o,"log",(function(){return p})),n.d(o,"info",(function(){return g})),n.d(o,"warning",(function(){return v})),n.d(o,"error",(function(){return b}));var r={};n.r(r),n.d(r,"subscriptable",(function(){return w})),n.d(r,"loggingResponseHandler",(function(){return y})),n.d(r,"noopResponseHandler",(function(){return R}));var i={};n.r(i),n.d(i,"unpack",(function(){return so})),n.d(i,"compress",(function(){return ao})),n.d(i,"parse",(function(){return co}));var s="ritsu-emerald",a="Ritsu x Emerald",c="RxE",l="0.11.0",u="https://i.imgur.com/KLtVhho.png";let d="",f=console;function m(t){d=t}function h(t){f=t}function p(t){f.log(d,t)}function g(t){f.info(d,t)}function v(t){f.warn(d,t)}function b(t){f.error(d,t)}function w(t){const e=new Set;return{subscribe:t=>{e.add(t)},unsubscribe:t=>{e.delete(t)},handler:(n,o)=>("set"===n.action&&e.forEach(t=>t(n.preference)),t(n,o))}}function y(t,e){const n=t.response;switch(n.status){case 0:return n;case 1:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' (${JSON.stringify(n.saved)}) was invalid. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),"set"===t.action&&v(`Could not set value ${JSON.stringify(n.value)} for preference '${t.preference.key}' because it was invalid.`),n;case 2:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' had the wrong type. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),n;case 3:return"get"===t.action&&(v(`The saved value for preference '${t.preference.key}' could not be parsed. Replacing it with ${JSON.stringify(n.value)}.`),e.set(t.preference,n.value)),n;case 4:switch(t.action){case"get":b(`Could not read preference '${t.preference.key}' because localStorage could not be accessed. Using value ${JSON.stringify(t.preference.default)}.`);break;case"set":b(`Could not save value ${JSON.stringify(t.response.value)} for preference '${t.preference.key}' because localStorage could not be accessed.`);break;default:A(t.action)}return n;default:return A(n.status)}}function R(t,e){return t.response}function A(t){throw new Error("assertUnreachable: "+t)}var k="undefined"!=typeof unsafeWindow?unsafeWindow:window;function x(t,e){return void 0===e?t:e}function C(t,e){switch(!0){case Number.isNaN(e):return"NaN";case e===1/0:return"Infinity";case e===-1/0:return"-Infinity";default:return e}}function E(t){return JSON.stringify(t,C)}const M=[function(t){return"boolean"==typeof t},function(t){return"number"==typeof t},N,function(t){return"symbol"==typeof t},P,function(t){return void 0===t}];function N(t){return"string"==typeof t}function P(t){return null===t}function U(t){return M.some(e=>e(t))}function _(t,e,n){return o=`${t.name}(${e.name})`,r=n,Object.defineProperty(r,"name",{value:o,writable:!1});var o,r}function S(t){return U(t)?t=>!1:_(S,t,e=>e instanceof t)}function T(t,e){e.constraints=t.concat(x([],e.constraints))}class O{constructor(t){if(""===t.key)throw new TypeError(`Empty preference key in this ${this.getClassName()}:\n${E(t)}`);this.key=t.key,this.default=t.default,this.label=t.label,this.description=x("",t.description),this.constraints=x([],t.constraints),this.dependencies=x([],t.dependencies),this.extras=x({},t.extras);const e=this.validate(t.default);N(e)&&this.invalidValue(t.default,e)}validate(t){const e=this.constraints;for(let n=0,o=e.length;n<o;n++){const o=e[n];if(!o.requirement(t))return o.message(t)}return{value:t}}toValid(t){return N(this.validate(t))?this.default:t}toString(){return`${this.getClassName()} '${this.key}'`}invalidValue(t,e){throw new Error(`${E(t)} is not a valid value for ${this}. Reason: ${e}`)}}class I extends O{constructor(t){const e=x(0,t.minLength),n=x(1/0,t.maxLength),o=[];if(t.multiline||o.push({requirement:t=>!t.includes("\n"),message:t=>"Line breaks are not allowed."}),e>0&&o.push({requirement:t=>t.length>=e,message:t=>`Minimum length is ${e} characters.`}),n<1/0&&o.push({requirement:t=>t.length<=n,message:t=>`Maximum length ${n} exceeded.`}),T(o,t),super(t),e<0)throw new Error(`Parameter 'minLength' cannot be negative, but it was ${e} in ${this}.`);this.multiline=t.multiline,this.maxLength=n,this.minLength=e}getClassName(){return"StringPreference"}toValid(t){const e=t.substring(0,this.maxLength);return super.toValid(this.multiline?e:e.replace(I.REGEX_LINE_BREAKS," "))}fromString(t){return this.validate(t)}}I.REGEX_LINE_BREAKS=/\n+/g;class j extends O{getClassName(){return"BooleanPreference"}}class B extends O{getClassName(){return"ListPreference"}}class L extends O{constructor(t){const e=t.options;if(T([{requirement:t=>e.some(e=>e.value===t),message:t=>E(t)+" is not among the available options."}],t),super(t),e.length<2)throw new Error(`Parameter 'options' has less than two elements in ${this}.`);const n=[];e.forEach(t=>{const e=this.validate(t.value);if(N(e))throw new Error(`Option value ${E(t.value)} in ${this} is invalid. Reason: ${e}`);if(n.indexOf(t.value)>-1)throw new Error(`Multiple options with value ${E(t.value)} in ${this}.`);n.push(t.value)}),this.options=e}getClassName(){return"MultichoicePreference"}toValid(t){return this.default}}var z;!function(t){t.OK="OK",t.ABSENT="ABSENT",t.TYPE_ERROR="TYPE_ERROR",t.JSON_ERROR="JSON_ERROR",t.STORAGE_ERROR="STORAGE_ERROR",t.NUMBER_ERROR="NUMBER_ERROR"}(z||(z={}));const D=()=>localStorage;function F(t,e,n){try{const o=function(t,e,n){if(null===t)throw new DOMException;const o=t.getItem(e);if(P(o))return null;const r=JSON.parse(o);if(function t(e){for(const t of M)if(t(e))return e=>t(e);if(S(Array)(e)){const n=e;return e=>S(Array)(e)&&(!(n.length>0)||e.every(t(n[0])))}if(e.constructor===Object)return n=>![void 0,null].includes(n)&&Object.keys(e).every(o=>t(e[o])(n[o]));if(e.constructor instanceof Function)return S(e.constructor);throw new TypeError(t.name+" cannot use this object as reference because it has no constructor: "+JSON.stringify(e))}(n)(r))return r;throw new TypeError("Saved value had wrong type.")}(t(),e,n);return P(o)?{status:"ABSENT",value:n}:{status:"OK",value:o}}catch(t){return{status:S(SyntaxError)(t)?"JSON_ERROR":S(TypeError)(t)?"TYPE_ERROR":"STORAGE_ERROR",value:n}}}function G(t,e,n){try{return function(t,e,n){const o=JSON.stringify(n,(t,e)=>{if("number"==typeof e&&!Number.isFinite(e))throw new RangeError(e.toString());return e});if(null===t)throw new DOMException;t.setItem(e,o)}(t(),e,n),{status:"OK",value:n}}catch(t){return{status:S(RangeError)(t)?"NUMBER_ERROR":S(SyntaxError)(t)||S(TypeError)(t)?"JSON_ERROR":"STORAGE_ERROR",value:n}}}function K(t,e){try{return t().removeItem(e),{status:"OK",value:!0}}catch(t){return{status:"STORAGE_ERROR",value:!1}}}var V;!function(t){t[t.OK=0]="OK",t[t.INVALID_VALUE=1]="INVALID_VALUE",t[t.TYPE_ERROR=2]="TYPE_ERROR",t[t.JSON_ERROR=3]="JSON_ERROR",t[t.STORAGE_ERROR=4]="STORAGE_ERROR"}(V||(V={}));const H=(t,e)=>t.response;function q(t){return`Unknown preference:\n\n${E(t)}.`}function J(t){switch(t){case"OK":case"ABSENT":return 0;case"NUMBER_ERROR":return 1;case"TYPE_ERROR":return 2;case"JSON_ERROR":return 3;case"STORAGE_ERROR":return 4}}var W=Object.assign(Object.assign(Object.assign({title:`${a} ${l}`,themeTitle:"Choose your theme"},!1),{generalTitle:"General Settings",imagesTitle:"Image Settings",messageTitle:"Message Settings",mutelistTitle:"Permanent Mutes",advancedTitle:"Advanced Settings",preferences:Object.assign(Object.assign({theme:{label:"Theme",description:"Reskin the chat"}},!1),{adBlocker:{label:"Remove ads and nags"},fancyColors:{label:"Choose your own flair color"},imgControl:{label:"Block and favorite images"},imgProtect:{label:"Hide images from low karma accounts"},imgBlur:{label:"Blur user images"},hidePfp:{label:"Hide profile pictures in chat"},showInfo:{label:"Show extra user info"},antiSpam:{label:"Mute spammers automatically"},showGender:{label:"Show gender on profile pictures"},trackKarma:{label:"Show live karma & flash changes"},mutelist:{label:"Perma mute list"},userSort:{label:"Sort users by..","name.asc":"Name Asc.","name.desc":"Name Desc.","age.asc":"Account age Asc.","age.desc":"Account age Desc."},blockReqs:{label:"Block friend requests from new accounts"},highlightMentions:{label:"Highlight your name when you're mentioned"},altpfpBackground:{label:"Choose the background colour for transparent pictures"},bigEmoji:{label:"Jumbo-sized emoji"},hideImageFallback:{label:"Hide your images from non-RxE users"},ignoreURLBlacklist:{label:"Ignore URL blacklist"},imgurAPIKey:{placeholder:"Imgur API Key",label:"Leave blank for default"},muteRegexes:{label:"Mute users matching"},toggleEmbeds:{label:"Show embeds"},largerText:{label:"Increase text size"},showAnimatedImages:{label:"Show GIFs"}}),hiddenChannels:"hidden channels",WFAF:"WFAF âŒ›",privateRooms:"Private Rooms ðŸ”’",privateRoomsPrompt:"Enter a private room key:\nOnly people with the key can enter this room.",privateRoomsWarning:"Chat history and user list is not available in unlisted rooms."}),!1);const X=null;var Y;!function(t){t[t.None=0]="None",t[t.Hide=1]="Hide",t[t.Reject=2]="Reject"}(Y||(Y={}));const Q={theme:new I({key:"theme",label:W.preferences.theme.label,description:W.preferences.theme.description,default:"ritsu",multiline:!1}),adBlocker:new j({key:"adBlocker",label:W.preferences.adBlocker.label,default:!0}),fancyColors:new j({key:"fancyColors",label:W.preferences.fancyColors.label,default:!0}),imgControl:new j({key:"imgControl",label:W.preferences.imgControl.label,default:!0}),imgProtect:new j({key:"imgProtect",label:W.preferences.imgProtect.label,default:!0}),imgBlur:new j({key:"imgBlur",label:W.preferences.imgBlur.label,default:!1}),hidePfp:new j({key:"hidePfP",label:W.preferences.hidePfp.label,default:!1}),showInfo:new j({key:"showInfo",label:W.preferences.showInfo.label,default:!0}),antiSpam:new j({key:"antiSpam",label:W.preferences.antiSpam.label,default:!0}),permaMuteList:new B({key:"permaMuteList",label:W.preferences.mutelist.label,default:[]}),showGender:new j({key:"showGender",label:W.preferences.showGender.label,default:!0}),trackKarma:new j({key:"trackKarma",label:W.preferences.trackKarma.label,default:!0}),blockedHashes:new B({key:"blockedHashes",label:"blockedHashes",default:[]}),savedPictures:new B({key:"savedPictures",label:"savedPictures",default:[]}),userSort:new I({key:"userSort",label:W.preferences.userSort.label,default:"name.asc",multiline:!1}),blockReqs:new L({key:"blockReqs",label:W.preferences.blockReqs.label,default:0,options:[{value:Y.None,label:"Off"},{value:Y.Hide,label:"Hide"},{value:Y.Reject,label:"Reject"}]}),highlightMentions:new j({key:"highlightMentions",label:W.preferences.highlightMentions.label,default:!0}),altpfpBackground:new I({key:"altpfpBackground",label:W.preferences.altpfpBackground.label,default:"#fff",multiline:!1}),bigEmoji:new j({key:"bigEmoji",label:W.preferences.bigEmoji.label,default:!0}),toggleEmbeds:new j({key:"toggleEmbeds",label:W.preferences.toggleEmbeds.label,default:!0}),largerText:new j({key:"largerText",label:W.preferences.largerText.label,default:!1}),imgurLastUploadTimes:new B({key:"imgurLastUploadTimes",label:"imgurLastUploadTimes",default:[]}),imgurPfpAlbum:new B({key:"imgurPfpAlbum",label:"imgurPfpAlbum",default:[]}),hideImageFallback:new j({key:"hideImageFallback",label:W.preferences.hideImageFallback.label,default:!1}),imgurDeleteHashes:new B({key:"imgurDeleteHashes",label:"imgurDeleteHashes",default:[]}),ignoreURLBlacklist:new j({key:"ignoreURLBlacklist",label:W.preferences.ignoreURLBlacklist.label,default:!1}),imgurAPIKey:new I({key:"imgurAPIKey",label:W.preferences.imgurAPIKey.label,default:"",multiline:!1}),muteRegexes:new B({key:"muteRegexes",label:W.preferences.muteRegexes.label,default:[]}),showAnimatedImages:new j({key:"showAnimatedImages",label:W.preferences.showAnimatedImages.label,default:!0})},Z=Object.assign(Object.assign({},Q),X),tt=new class{constructor(t,e,n=H){this.localStoragePrefix=e,this.responseHandler=n,this.cache=new Map;const o=[],r=function t(e){return Object.values(e).reduce((e,n)=>e.concat(S(O)(n)?n:t(n.h)),[])}(t);r.forEach(t=>{const e=t.key;if(o.includes(e))throw new Error(`Duplicate preference key ${E(e)}.`);this.cache.set(t,t.default),o.push(e)}),r.forEach(t=>{t.dependencies.forEach(e=>{if(void 0===this.cache.get(e.preference))throw new Error(`Dependency error in ${t}: ${q(e.preference)}`)})})}get(t){return this.getWith(this.responseHandler,t)}set(t,e){this.setWith(this.responseHandler,t,e)}getWith(t,e){return t({action:"get",preference:e,response:this.getRaw(e)},this).value}setWith(t,e,n){t({action:"set",preference:e,response:this.setRaw(e,n)},this)}reset(t){var e;this.getFromCacheOrThrowIfUnknown(t),e=this.localStoragePrefix+t.key,K(D,e)}resetAll(){for(const t of this.cache.keys())this.reset(t)}shouldBeAvailable(t){return t.dependencies.every(t=>t.condition(this.getRaw(t.preference).value))}getRaw(t){const e=this.getFromCacheOrThrowIfUnknown(t),n=(o=this.localStoragePrefix+t.key,r=t.default,F(D,o,r));var o,r;if("OK"===n.status){const e=n.value;return N(t.validate(e))?{status:1,value:t.toValid(e),saved:e}:{status:0,value:e}}return{status:J(n.status),value:e}}setRaw(t,e){if(this.getFromCacheOrThrowIfUnknown(t),N(t.validate(e)))return{status:1,value:e};this.cache.set(t,e);const n=function(t,e){return G(D,t,e)}(this.localStoragePrefix+t.key,e);return{status:J(n.status),value:n.value}}getFromCacheOrThrowIfUnknown(t){const e=this.cache.get(t);if(void 0===e)throw new Error(q(t));return e}}(Z,s+"-preference-",r.loggingResponseHandler);var et=n(0),nt=n.n(et);const{max:ot,min:rt}=Math,it=(t,e={})=>Object.assign(document.createElement(t),e),st=[];function at(t){st.push(t),Promise.resolve().then(()=>{if(!st.length)return;const t=st.join("\n");st.length=0,document.head.append(it("style",{type:"text/css",textContent:t}))})}function ct(t,e,n,o=!1){const r=t[e];t[e]=function(...t){const e=o&&n.apply(this,t);let i=null;return o&&!1===e||(i=r.apply(this,t)),o||n.apply(this,t),i}}function lt(t,e){const n=[];for(let o=0;o<t.length;o+=e){const r=t.slice(o,o+e);n.push(r)}return n}function ut(t,e){return lt(t.split(""),e).map(t=>t.join(""))}function dt(t,e,n){return rt(n,ot(e,t))}let ft;function mt(t){clearTimeout(ft),Promise.resolve().then(()=>null===RoomClient||void 0===RoomClient?void 0:RoomClient.print_append(nt.a.createElement("div",null,t)))}function ht(t){mt(t),document.body.classList.add("tmp-message"),ft=+setTimeout(()=>{null===RoomClient||void 0===RoomClient||RoomClient.print_append(),document.body.classList.remove("tmp-message")},5e3)}const pt=(t=0)=>new Promise(e=>setTimeout(e,t));function gt(t,e,n="Timed out"){return Promise.race([t,pt(e).then(()=>Promise.reject(new Error(n)))])}var vt;function bt(t){return(e,n)=>t(n,e)}!function(t){t.string=(t,e)=>t.localeCompare(e),t.numeric=(t,e)=>t-e}(vt||(vt={}));const wt=t=>{if(null===t)throw new Error("got null");if(void 0===t)throw new Error("got undefined");if("number"==typeof t&&Number.isNaN(t))throw new Error("got NaN");return t},yt=t=>e=>t===e;function Rt(t,e){return(n,o)=>e(t(n),t(o))}function At(t,e,n,o=!1){const r=o?t:Array.from(t),i="asc"===n?e:bt(e);return r.sort(i),r}function kt(t,e,n,o,r=!1){return At(t,(i=e,s=n,(t,e)=>s(t[i],e[i])),o,r);var i,s}const xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ct=Array.from({length:65},(t,e)=>String.fromCodePoint(e+917536)).join("");function Et(t){const e=btoa(t);let n="";for(let t=0;t<e.length;t+=1){const o=xt.indexOf(e[t]);if(-1===o)return null;n+=Ct[2*o]+Ct[2*o+1]}return n}function Mt(t){return"#"+t.map(t=>t.toString(16).padStart(2,"0")).join("")}function Nt(t,e,n,o,r=1){const i=Array.from(t.entries());return function(t,e){const n=document.createElement("canvas"),o=n.getContext("2d");return t(n,o),n.toDataURL(e)}((t,s)=>{t.width=r*e,t.height=r*n,o&&(s.fillStyle=Mt(o)),s.fillRect(0,0,r*e,r*n),i.forEach(([t,o])=>{const i=r*(t%e),a=r*~~(t/n);s.fillStyle=Mt(o),s.fillRect(i,a,r,r)})})}function $t(t,e,n,o){return dt(Math.round(t/e),n,o)}function Pt(t){return!t.some(t=>t<0||t>255)}function Ut(t){if(!Pt(t))throw new Error("Invalid colour "+t)}function _t([t,e,n],[o,r,i]){return[t-o,e-r,n-i].map(t=>(t/255)**2).reduce((t,e)=>t+e,0)/3}function St(t,e){const n=t.map((t,n)=>[n,_t(t,e),t]);return n.sort((t,e)=>t[1]-e[1]),n[0]}function Tt(t,e,n){return new Promise(o=>{t.addEventListener(e,o),n&&n(t)})}function Ot(t){return t.includes(null)||t.includes(void 0)?null:t}function It(t){return null==t?[]:t.filter(t=>null!=t)}function jt(t){return+new Date-+new Date(t)}function Bt(t,e,n){let o=!1;return t.flatMap(t=>{o=!o;const r=o?e(t):n(t);return null===r?[]:r instanceof Array?r:[r]})}function Lt(t,e,n){if(0===e.length)return[t];const o=e.flatMap(t=>{if("number"==typeof t){if(void 0===n)throw new Error("Length must not be undefined if matches is of type number[]");return[t,t+n]}const[e,o]=t;return[e,e+o]});o.push(void 0);return o.map((e,n,{[n-1]:o})=>t.slice(null!=o?o:0,e))}function zt(t,e,n,o){const r=Array.from(t.matchAll(e)).map(t=>{if(void 0===t.index)throw new Error("So TypeScript really was right about match.index");return[t.index,t[0].length]});return Bt(Lt(t,r),o,n)}function Dt(t,e,n,o,r=!1){const i=function(t,e,n=!1){let o=n?t:t.toLowerCase();const r=n?e:e.toLowerCase(),i=[];let s=0;for(;o.length>0;){if(s=o.indexOf(r),-1===s)return i;i.push(s+t.length-o.length),o=o.slice(s+Math.max(r.length,1))}return i}(t,e,r);return Bt(Lt(t,i,Math.max(e.length,1)),o,n)}function Ft(t){const e=Math.abs(t)>=1e3?(t/1e3).toPrecision(3)+"K":""+t;return t>=0?"+"+e:""+e}function Gt(t,e){const n=Object.getOwnPropertyNames(t).map(n=>[n,e(n,t[n])]);return Object.fromEntries(n)}function Kt(t){const e=[];for(let n=0;n<t.length;n+=1)for(let o=n+1;o<t.length;o+=1)e.push([t[n],t[o]]);return e}function Vt(t,e=""){const n=t.split(e).sort(),o=n.length;return n.filter((t,e,n)=>t!==n[e-1]).map(t=>n.reduce((e,n)=>n===t?e+1:e,0)).map(t=>t/o).reduce((t,e)=>t+-e*Math.log2(e),0)}function Ht(t){const e=(t+t).indexOf(t,1);return e>-1&&e!==t.length?t.length/e:0}const qt={allowSpace:!1,otherKeysPreventDefault:!1,otherKeysStopPropagation:!1};function Jt(t,{allowSpace:e,otherKeysStopPropagation:n,otherKeysPreventDefault:o}=qt){return{onClick:t,onKeyUp:r=>{"Enter"===r.key||e&&""===r.key?t(r):(n&&r.stopPropagation(),o&&r.preventDefault())}}}function Wt(...t){if(0===t.length)throw new Error("Must supply at least one RegExp");const e=t[t.length-1],n="string"==typeof e,o=t.slice(0,n?-1:0),r="string"==typeof e?e:e.flags;return new RegExp(o.map(t=>"string"==typeof t?t:t.source).join(""),r)}class Xt extends Error{}function Yt(t){let e=!1,n=null;return()=>(n=e?n:t(),e=!0,n)}function Qt(t){if("number"!=typeof t)return t}function Zt(t){return null===t?NaN:"number"==typeof t?t:t.id}var te=n(7),ee=n.n(te);const ne=["captcha","youtube","about:blank","open.spotify.com","i.redd.it","ibb.co"];function oe(){if(!tt.get(Q.adBlocker))return;Array.from(document.querySelectorAll("iframe")).forEach(t=>{const{src:e}=t;e&&!ne.some(t=>e.includes(t))&&t.remove()})}function re(t){var e;return null!==(e=Array.from(t.matchAll(/\[?rxe-pfp:?([A-Za-z0-9+/=\u{E0020}-\u{E005F}]+)\]?/gu)).map(t=>t[1]).slice(-1)[0])&&void 0!==e?e:null}function ie(t){const e=Array.from(t.matchAll(/\[?rxe-pfp:?([A-Za-z0-9+/=\u{E0020}-\u{E005F}]+)\]?/gu)).map(t=>t.index).filter(t=>void 0!==t).slice(-1)[0];return t.slice(0,e)}async function se(t,e){return new Promise((n,o)=>{const r={display_name:t.display_name,bio:e,flair:{color:t.flair.color},gender:t.gender};$.ajax({type:"GET",url:"/update_profile?"+$.param(r),dataType:"json",success(){null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(t.id),bo(e),n()},error:()=>o()})})}async function ae(t,e){await se(t,function(t,e){const n=ie(t);return n+("\n"===n[n.length-1]?"":"\n")+(t=>`[rxe-pfp:${t}]`)(e)}(t.bio,e))}var ce;!function(t){t[t.Created=0]="Created",t[t.Alive=1]="Alive",t[t.Destroyed=2]="Destroyed"}(ce||(ce={}));const le=new Map;class ue{constructor(t,e=!1){this.state=ce.Created,this.preference=t,e&&this.load()}assertAlive(){if(this.state===ce.Destroyed)throw new Error("Attempted to use destroyed ListPreferenceCache object");if(this.state===ce.Created)throw new Error("Attempted to use uninitialized ListPreferenceCache object")}get store(){return this.assertAlive(),this.realStore}set store(t){this.assertAlive(),this.realStore=t}destroy(){this.assertAlive(),this.state=ce.Destroyed,this.preference&&le.delete(this.preference.key)}load(){const{preference:t}=this;if(le.has(t.key)&&le.get(t.key)!==this)throw new Error(ue.ERR_PREF_IN_USE);le.set(t.key,this),this.state=ce.Alive,this.loadFrom(tt.get(this.preference))}save(){tt.set(this.preference,this.asSaved())}}ue.ERR_PREF_IN_USE="Cannot create multiple ListPreferenceCache instances     linked to the same preference. Hint: .destroy() the previous instance";class de extends ue{setItem(t,e){this._setItem(t,e),this.save()}addItem(t,e){this.setItem(t,e)}removeItem(t){const e=this._removeItem(t);return this.save(),e}}class fe extends ue{add(t){this._add(t),this.save()}remove(t){const e=this._remove(t);return this.save(),e}}class me extends fe{hasItem(t){return this.store.has(t)}hasKey(t){return!1}values(){return[...this.store.values()]}entries(){return this.values()}_add(t){this.store.add(t)}_remove(t){return this.store.delete(t)}asSaved(){return this.values()}loadFrom(t){this.store=new Set(t)}}class he extends de{hasKey(t){return this.store.has(t)}hasItem(t){return this.values().some(e=>e===t)}getItem(t){return this.store.get(t)}_removeItem(t){return this.store.delete(t)}_setItem(t,e){return this.store.set(t,e)}values(){return[...this.store.values()]}entries(){return[...this.store.entries()]}asSaved(){return[...this.store.entries()]}loadFrom(t){this.store=new Map(t)}static just(t,e){const n=new he(e,!0);t(n),n.destroy()}static addItem({key:t,item:e},n){return he.just(n=>n.addItem(t,e),n)}static removeItem({key:t},e){return he.just(e=>e.removeItem(t),e)}}const pe=t=>`\n\t Â· ${JSON.stringify(t)} (U+${t.charCodeAt(0).toString(16).padStart(4,"0").toUpperCase()})`;function ge(t){return t.replace(/(\S)\.([a-z][a-z])/gi,"$1%2E$2").replace(/https?:\/\//gi,"")}const ve=t=>t.replace(/%2E/gi,".").replace(/\s?\(\s?(\.|dot)\s?\)\s?/g,".").replace(/\.\u200b/g,"."),be=Wt("(?:",["%2E","dot",/\./.source,/ ?\( ?(?:\.|dot) ?\) ?/.source].join("|"),")","").source,we=/(https?:\/\/)?/.source,ye=/[-a-z0-9@:%_+[\]~#?&=]/.source,Re=()=>Wt(...[/\bi\.ibb\.co\/[a-z0-9]+\/[^\s.]+\.[a-z0-9]+\b/gi,/\bi\.redd\.it\/[a-z0-9]+\.[a-z0-9]+\b/gi,/\bi\.imgur\.com\/[a-z0-9]+\.[a-z0-9]+\b/gi].map(t=>`(${t.source})`).join("|"),"gi"),Ae=()=>tt.get(Q.imgurLastUploadTimes),ke=()=>Ae().filter(t=>jt(new Date(t))<=108e5),xe=()=>ke().length<50;function Ce(){var t;t=[...Ae(),+new Date].slice(-50),tt.set(Q.imgurLastUploadTimes,t)}const Ee=`You can upload 50 new images per ${$.timeago(+new Date-108e5)}.`,Me=()=>tt.get(Q.hideImageFallback),Ne="https://api.imgur.com/3/image/",$e=Et("rxe-imgur:"),Pe=()=>new RegExp(`imgur${be}com/([a-z0-9]+)`,"i"),Ue=t=>`https://i.imgur.com/${t}.png`,_e=()=>({Authorization:"Client-ID "+(tt.get(Q.imgurAPIKey)||"b8f69bdcc4d1373")});function Se({id:t,payload:e}){return{url:Ue(t),payload:e,version:"0.11.0"}}function Te(t){return Me()?`${$e}${Et(t)}`:ge(Ue(t))}async function Oe(t){const e=new FormData;e.append("image",t);const n=await fetch(Ne,{method:"POST",headers:_e(),body:e});if(!n.ok)throw new Error(n.statusText);const{data:o}=await n.json(),{id:r,deletehash:i}=o;return he.addItem({key:r,item:i},Q.imgurDeleteHashes),Ce(),{id:r,payload:Te(r)}}function Ie(t,e=!0){const n=t.match(Pe());return n&&Se({payload:e?Te(n[1]):ge(n[0]),id:n[1]})}function je(t){var e;const n=Ie(t,!1);if(n)return n;const o=null===(e=t.match(new RegExp($e+"(\\S*)")))||void 0===e?void 0:e[1];if(void 0===o)return null;return Se({id:function(t){let e="";for(let n=1;n<t.length;n+=2){const o=Ct.indexOf(t[n]);if(-1===o)throw new Error("bad image path");e+=xt[(o-1)/2]}return atob(e)}(o),payload:o})}const Be=["You are uploading your image to ",nt.a.createElement("a",{href:"https://imgurinc.com/privacy"},"Imgur"),". Anyone with the link can save or share it."];var Le=n(2),ze=n.n(Le);const De="https://github.com/Ritsu-Projects/Public-Releases/",Fe=ge(De),Ge=(t,e)=>`${e} Â· ${Me()?"Can't see it":"See just a link"}? Get RxE ${t}+: ${Fe}`;function Ke(t){const e=/\w/.test(t.payload)?"Image: "+t.payload:`[Image${t.payload}]`;return Math.random()<.5?Ge(t.version,e):e}function Ve({url:t}){return nt.a.createElement(MessagePicture,{picture:{url:t}})}function He({url:t},e=App.user){return{user:e,messages:[],picture:{url:t}}}function qe(t){return je(t)}async function Je(t){return async function(t){return Se(await Oe(t))}(t)}const We={ratelimit:Ee,destination:Be,lowKarma:"Warning: Due to low karma, images sent by you may be hidden from other users."};var Xe=n(8),Ye=n.n(Xe);const Qe=()=>nt.a.createElement(MenuMicro,null,nt.a.createElement(PictureUpload,null));function Ze(t){const{text:e}=t;return nt.a.createElement("div",null,nt.a.createElement("b",null,"Note"),": ",e)}function tn(t){const{failureReason:e}=t;return nt.a.createElement("div",{className:"picture-upload-error"},nt.a.createElement("div",null,"We couldn't upload your picture."),nt.a.createElement("div",null,"Reason: ",nt.a.createElement("span",{className:"picture-upload-error-reason"},e)))}function en(){at(Ye.a),Room.prototype.room_input=function(){return nt.a.createElement("div",{className:"room-component-input"},nt.a.createElement("textarea",{id:"room-input",className:"room-component-input-textarea",onMouseDown:()=>this.scroll(),onKeyDown:t=>this.input(t),placeholder:"Say Something..."}),nt.a.createElement("span",{className:"room-component-input-icon material-icons",title:"Attach image",onMouseDown:()=>this.upload_picture(),role:"button",tabIndex:0},"photo_camera"))},PictureUpload.prototype.body=function(){const{failureReason:t}=this.state,e=xe(),n=nt.a.createElement("div",{className:"picture-upload-info"},nt.a.createElement(Ze,{text:We.destination}),nt.a.createElement(Ze,{text:We.ratelimit}),App.user._karma<10&&nt.a.createElement(Ze,{text:We.lowKarma}),t&&nt.a.createElement(tn,{failureReason:t})),o=e?" Choose a file":` Wait ${$.timeago(function(){const t=ke().slice(0,-49);if(0===t.length)return 0;const e=Math.max(...t);return+new Date+(108e5-jt(new Date(e)))}())} before uploading again.`,r=nt.a.createElement("label",{htmlFor:"image"},nt.a.createElement("span",{className:"material-icons upload-thing",style:{cursor:e?"pointer":"not-allowed"}},e?"cloud_upload":"hourglass_top"),o),i=nt.a.createElement("input",{id:"image",className:"picture-upload-button",name:"image",type:"file",accept:"image/*",disabled:!e,onChange:()=>{var t;return e&&(null===(t=this.uploadImage)||void 0===t?void 0:t.call(this))}});return nt.a.createElement("form",{id:"picture_upload",name:"picture_upload","data-remote":"true",method:"post",action:Ne},i,r,n)}}const{min:nn,max:on}=Math;class rn{constructor(t){this.__pointer=0,this.data=t}get pointer(){return this.__pointer}set pointer(t){this.__pointer=t}advance(t=1){return this.pointer+=t,this.data[this.pointer]}read(t=1){const e=this.peek(t);return this.advance(t),e}readExactly(t){const e=this.read(t);if(void 0!==e&&e.length===t)return e}peek(t=1){const e=this.pointer+nn(0,t),n=this.pointer+on(0,t);return this.data.slice(e,n)}peekExactly(t){const e=this.peek(t);if(void 0!==e&&e.length===t)return e}get length(){return this.data.length}debug(){console.log(`${this.data.slice(0,this.pointer)}[${this.peek()}]${this.data.slice(this.pointer+1)}`)}warnExpected(t,e=1,n=!0){const{data:o,pointer:r}=this,i=n?r-e:r,s=o.slice(i-5,i),a=o.slice(i,i+e).padEnd(e,"_");return console.warn(`${t}: ${s}[${a}]`),null}outOfBounds(){return this.pointer>=this.data.length-1}}const{max:sn,ceil:an,log2:cn}=Math;function ln(t,e,n=sn(0,an(cn(t)))){if(t<0)throw new RangeError("bits can't be negative");const o=~~(n/e),r=2**o-1;return n%e!=0&&console.warn(`bitsplit: splits (${e}) does not divide evenly into relevantBits (${n}).`),Array.from({length:e},(e,n)=>{const i=n*o;return(t&r<<i)>>i}).reverse()}function un(t,e){return Array.from(t).reverse().map((t,n)=>t<<n*e).reduce((t,e)=>t+e,0)}function dn(t){if(t<0||t>63)throw new RangeError("u8 has to be from 0 to 63");return xt[t]}class fn{constructor(t,e=[]){this.numberBits=t,this._numbers=Array.from(e),this._lastBits=t}get length(){return this._numbers.length}get lastBits(){return this._lastBits}set lastBits(t){if(!(t>0&&t<=this.numberBits))throw new RangeError(`lastBits must be between 1 and ${this.numberBits} (was set to ${t})`);this._lastBits=t}set last(t){this._numbers[this.length-1]=t}get last(){return this._numbers[this.length-1]}push(t){t>1&&console.warn("GroupedBits.push got bit > 1"),this.lastBits===this.numberBits?(this._numbers.push(0),this.lastBits=1):this.lastBits+=1,this.last<<=1,this.last+=1&t}pushNumber(t,e){if(t<0)throw new RangeError("num can't be negative");this.extend(ln(t,e,e))}extend(t){t.forEach(t=>this.push(t))}pushNumbers(t,e){t.forEach(t=>this.pushNumber(t,e))}shift(){if(0===this.length)return;const t=1<<this.numberBits,e=t-1,n=1<<this.lastBits-1;let o=this.last&n?1:0;this.last-=o?n:0;const r=this.length-2;1===this.lastBits?(this._numbers.pop(),this.lastBits=this.numberBits):this.lastBits-=1;for(let n=r;n>=0;n-=1)this._numbers[n]<<=1,this._numbers[n]+=o,o=t&this._numbers[n]?1:0,this._numbers[n]&=e;return o}get numBits(){return(this.length-1)*this.numberBits+this.lastBits}shiftBits(t){const e=[];if(!(this.numBits<t)){for(let n=0;n<t;n+=1)e.push(this.shift());return un(e,1)}}pop(){if(0===this.length)return;if(1===this.lastBits)return this.lastBits=this.numberBits,this._numbers.pop()?1:0;this.lastBits-=1;const t=1&this.last?1:0;return this.last>>=1,t}consume(t){for(;t.length>0;)this.push(t.pop())}consumeLeft(t){for(;t.length>0;)this.push(t.shift())}reverse(){const t=new fn(this.numberBits);return t.consume(this),t}topUp(){return this.last<<=this.numberBits-this.lastBits,this.lastBits=this.numberBits,this}trim(){return this.lastBits===this.numberBits||(this._numbers.pop(),this.lastBits=this.numberBits),this}toNumber(){return(un(this._numbers.slice(0,-1),this.numberBits)<<this.lastBits)+this.last}regroup(t){const e=new fn(t);return e.consumeLeft(this),e}get numbers(){return Array.from(this._numbers)}representIndex(t){const e=t===this.length-1;return this.numbers[t].toString(2).padStart(e?this.lastBits:this.numberBits,"0")}debug(t=""){const e=t?t+" ":t;console.log(e+this.numbers.map((t,e)=>this.representIndex(e)).join("."))}}function mn(t,e,n){return new fn(e,t).regroup(n).topUp().numbers}function hn(t){if(!t)return null;const e=Ct.indexOf(t);if(-1!==e)return e;const n=xt.indexOf(t);return-1!==n?n:null}function pn(t){const e=Ot(t.split("").map(hn));return e?new Uint8Array(e):null}function gn(t){return Array.from(t).map(dn).join("")}function vn(t){return ln(t,3,6).map(t=>255*t/3)}function bn(t){const[e,n,o]=t.map(t=>dt(Math.round(3*t/255),0,3));return(e<<4)+(n<<2)+o}class wn{constructor(t,e=[255,255,255]){this.length=t,this.backgroundColour=e,this._pointer=0,this._nextPixel=0,this.pixels=Array.from({length:t}).fill(e)}get nextPixel(){return this._nextPixel}set nextPixel(t){if(t<0)throw new Error("nextPixel can't be negative");if(t>this.pointer)throw new RangeError("nextPixel can't be greater than pointer");if(t>this.length)throw new RangeError("nextPixel can't be out of bounds");this._nextPixel=t}get pointer(){return this._pointer}set pointer(t){if(t<0)throw new RangeError("pointer can't be negative");if(t>this.length)throw new RangeError("pointer can't be out of bounds");if(t<this.nextPixel)throw new RangeError("pointer can't be less than nextPixel");this._pointer=t}_place(t){this.pixels[this.pointer]=Array.from(t),this.pointer+=1,this.nextPixel=this.pointer}_peek(t){return this.pixels.slice(this.pointer,this.pointer+t)}inBounds(t){return t>=0&&t<=this.length}canMoveBy(t){return this.inBounds(this.pointer+t)}remaining(){return this.length-this.pointer}done(){return this.pointer>=this.length}finish(){this.pointer=this.length}seek(t){const e=this.pointer+t,n=this.inBounds(e);return n&&(this._nextPixel=e,this._pointer=e),n}get offset(){const t=this.pointer-this.nextPixel;if(t<0)throw new Error("Offset can't be negative");return t}get skipped(){return this.pixels.slice(this.nextPixel,this.pointer)}toImage(){return Array.from(this.pixels)}getNext(){var t;return null===(t=this._peek(1))||void 0===t?void 0:t[0]}pixelLogAt(t){return`${this.pixels.slice(t-10,t).map(Mt).join(" ")} [${t}: ${Mt(this.pixels[t])}]`}debug(){console.log("backgroundColour",Mt(this.backgroundColour)),console.log("nextPixel:",this.pixelLogAt(this.nextPixel)),console.log("pointer:",this.pixelLogAt(this.pointer))}}class yn extends wn{skip(t){return!!this.canMoveBy(t)&&(this.pixels.fill(this.backgroundColour,this.pointer,this.pointer+t),this.pointer+=t,!0)}placeOne(t){return!!this.canMoveBy(1)&&(this._place(t),!0)}place(t){return!!this.canMoveBy(t.length)&&(t.forEach(t=>this._place(t)),!0)}finish(){this.pixels.fill(this.backgroundColour,this.nextPixel),this.pointer=this.length,this.nextPixel=this.length}}class Rn extends wn{constructor(){super(...arguments),this.lastPreviewed=null,this.lastPreviewTrace=""}static fromImage(t){const e=new Rn(t.length);return e.pixels=Array.from(t),e}preview(t){var e;if(this.assertNoLastPreview(),this.lastPreviewTrace=null!==(e=(new Error).stack)&&void 0!==e?e:"",!this.canMoveBy(t))return null;const n=this._peek(t);return this.lastPreviewed=n,Array.from(n)}previewAtMost(t){if(this.done())return null;const e=Math.min(t,this.remaining());return this.preview(e)}peekOne(t=!0){var e,n;const o=null!==(n=null===(e=this.preview(1))||void 0===e?void 0:e[0])&&void 0!==n?n:null;return t||this.backtrack(),o}backtrack(){this.assertLastPreview(),this.lastPreviewed=null}skip(){this.assertLastPreview(),this.pointer+=this.lastPreviewed.length,this.lastPreviewed=null}consume(){this.assertLastPreview(),this.pointer+=this.lastPreviewed.length,this.nextPixel=this.pointer,this.lastPreviewed=null}skipIf(t){t?this.skip():this.backtrack()}skipCount(t){if(!this.canMoveBy(t))throw new Error("Cannot skip by given amount of pixels.");this.pointer+=t}consumeIf(t){t?this.consume():this.backtrack()}consumeCount(t){if(!this.canMoveBy(t))throw new Error("Cannot consume given amount of pixels.");this.pointer+=t,this.nextPixel=this.pointer}consumeSkipped(t){if(this.offset<t)throw new Error("Cannot consume given amount of skipped pixels.");this.nextPixel+=t}lastPreview(){return this.assertLastPreview(),Array.from(this.lastPreviewed)}findNext(t,e=1/0){const n=this.pointer+e;for(let e=this.pointer;e<this.length&&e<n;e+=1)if(t(this.pixels[e]))return e-this.pointer;return null}assertLastPreview(){if(!this.lastPreviewed)throw new Error("No last preview to reference")}assertNoLastPreview(){if(null!==this.lastPreviewed)throw o.error("Last preview happened here: \n"+this.lastPreviewTrace),new Error("Last preview wasn't closed")}}const An={PALETTE_SELECTION:"00",BACKGROUND_SELECTION_STREAM:"1",OFFSET:"01"},kn={OFFSET:1,BACKGROUND_SELECTION_STREAM:2,PALETTE_SELECTION:3},xn=()=>.01,Cn=()=>.5,{round:En}=Math,Mn={none:(t,[e,n])=>t(En(e),En(n))},Nn=2,$n=3,Pn={colour64:{map(t){const e=(1<<Nn)-1,n=255/e;return t.map(t=>$t(t,n,0,e)*n)},deserialize:t=>vn(t[0]),serialize:t=>[bn(t)],digits:1},colour512:{map(t){const e=(1<<$n)-1,n=255/e;return t.map(t=>dt(En($t(t,n,0,e)*n),0,255))},deserialize(t){if(!t)return null;const e=255/((1<<$n)-1);return mn(Array.from(t),6,$n).slice(0,3).map(t=>dt(En(t*e),0,255))},serialize(t){const e=(1<<$n)-1,n=255/e;return mn(t.map(t=>$t(t,n,0,e)),$n,6)},digits:2}};function Un(t){var e;const{width:n}=t,o=function(t){const e=document.createElement("canvas"),n=e.getContext("2d"),{width:o,height:r}=t;return e.width=o,e.height=r,n.drawImage(t,0,0),n.getImageData(0,0,o,r)}(t),r=null!==(e=function(t){const e=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);return null===e?null:ut(6===e[1].length?e[1]:e[1].replace(/[0-9a-f]/gi,"$&$&"),2).map(t=>parseInt(t,16))}(tt.get(Q.altpfpBackground)))&&void 0!==e?e:[255,255,255];return(t,e)=>{const i=4*(e*n+t),s=Array.prototype.slice.call(o.data,i,i+3),a=o.data[i+3]/255;return 3!==s.length?(console.warn(`Failed getting image data for index ${i} (data[${o.data.length}])`,s),null):(s.forEach((t,e)=>{s[e]=a*t+(1-a)*r[e]}),s)}}function _n(t,{interpolator:e,width:n,height:o}){const r=Array.from({length:n*o}),i=Un(t),s=Math.min(t.height/o,t.width/n),[a,c]=[s*n,s*o],l=(t.width-a)/2,u=(t.height-c)/2;for(let t=0;t<n;t+=1)for(let a=0;a<o;a+=1){const o=e(i,[l+t*s,u+a*s],[0,0]);null===o&&console.warn(`Interpolation failed at ${t}, ${a}`),r[a*n+t]=null!=o?o:[0,0,0]}return r}const{ceil:Sn}=Math,Tn=Gt(An,(t,e)=>parseInt(e,2)),On=Gt(An,(t,e)=>e.length),In=Gt(kn,(t,e)=>6*e-On[t]),jn=Gt(In,(t,e)=>(1<<e)-1),Bn=t=>Object.keys(Tn).find(e=>(t&(t=>64-(1<<6-On[t]))(e))==Tn[e]<<6-On[e]);{0;const t=Kt(Object.entries(An)).find(([[t,e],[n,o]])=>e.startsWith(o)||o.startsWith(e));if(void 0!==t)throw new Error(`The following header types overlap: ${t[0][0]} and ${t[1][0]}`)}const Ln=Pn.colour64,zn=Pn.colour512;function Dn(t,e){Ut(t),Ut(e);const n=Ln.map(t),o=_t(t,e),r=_t(n,e);return Math.min(r,o)<=xn()}function Fn(t,e){Ut(t);const[n,o,r]=St(e,t);return o>xn()?null:[n,r]}function Gn(t,e){var n;return null!==(n=Fn(t,e))&&void 0!==n?n:Fn(Ln.map(t),e)}class Kn{get name(){return this.constructor.name}}class Vn extends Kn{}class Hn extends Kn{constructor(t,e){super(),this.width=Hn.clampSize(t),this.height=Hn.clampSize(e)}get pixels(){return this.width*this.height}toString(){return`${this.width}, ${this.height}`}static clampSize(t){return dt(16*Sn(t/16),16,128)}static parseSize(t){return 16*(t+1)}static compressSize(t){return t/16-1}representation(){return`${this.name}(${this.width}, ${this.height})`}serialize(){const t=Hn.compressSize(this.width),e=Hn.compressSize(this.height);return console.assert(t<8&&e<8,"width or height of SizeSpecifier token exceed 3 bits"),dn((t<<3)+e)}static readTape(t){const e=hn(t.read());if(null===e)return null;const[n,o]=ln(e,2,6);return new Hn(Hn.parseSize(n),Hn.parseSize(o))}static fromTape(t){var e;return null!==(e=this.readTape(t))&&void 0!==e?e:t.warnExpected("expected size specifier")}}class qn extends Kn{constructor(t){if(super(),this.colours=t,0===t.length)throw new Error("No colours supplied");if(t.length>qn.paletteLength)throw new Error("Too many colours supplied");if(t.some(t=>!Pt(t)))throw new RangeError("Invalid colour");const e=16-this.colours.length;this.completePalette=[...this.colours,...Array.from({length:e},()=>this.colours.slice(-1)[0])]}representation(){const{name:t,colours:e}=this;return`${t}([${Array.from(e).map(Mt).join(", ")}])`}serialize(){return gn(this.completePalette.map(qn.colourSpace.serialize).flat())}static readTape(t){const e=t.readExactly(qn.expectedDigits);if(!e)return null;const n=Ot(e.split("").map(hn));if(!n)return null;const o=Ot(lt(n,qn.colourSpace.digits).map(qn.colourSpace.deserialize));return o?new qn(o):null}static fromTape(t){var e;return null!==(e=this.readTape(t))&&void 0!==e?e:t.warnExpected("expected palette specifier",qn.expectedDigits)}static fromRGB(t){return new qn(t)}}qn.paletteLength=16,qn.expectedDigits=16*zn.digits,qn.colourSpace=zn;class Jn extends Vn{}const Wn=(Xn="PALETTE_SELECTION",(Yn=class t extends Jn{constructor(e){if(super(),this.paletteIndices=e,e.length!==t.expectedColours)throw new Error(`Palette selection size does not match ${t.expectedColours} expected colours: ${e}`);if(e.some(t=>t<0||t>qn.paletteLength))throw new Error("Invalid palette indicies: "+e)}static matchHeader(t){return Bn(t)===Xn}get name(){return"PALETTE_SELECTION"===Xn?"PaletteSelection":"PaletteSelectionShort"}representation(){return`${this.name}([${this.paletteIndices.join(", ")}])`}serialize(){const t=new fn(6);return t.pushNumber(Tn[Xn],On[Xn]),t.pushNumbers(Array.from(this.paletteIndices),4),gn(t.topUp().numbers)}static tryMake(e,n){if(n.length>qn.paletteLength)throw new Error("Palette too long");if(e.length<t.expectedColours)return null;const o=Ot(Array.from(e.slice(0,t.expectedColours)).map(t=>{var e;return null===(e=Gn(t,n))||void 0===e?void 0:e[0]}));return o?new t(o):null}static fromTape(e){const n=this.readTape(e);return null==n?e.warnExpected("expected PaletteSelection token",t.expectedDigits):n}static readTape(e){const n=e.readExactly(t.expectedDigits);if(void 0===n)return null;const o=pn(n);if(null===o)return null;const r=new fn(4);r.pushNumbers(Array.from(o),6);const i=r.shiftBits(On[Xn]);if(i!==Tn[Xn])throw new Error(`Bytes read (${null==i?void 0:i.toString(2)}) do not start with palette selection header`);return new t(r.trim().numbers)}renderFrom(t){if(t.length<16)throw new Error("Received incomplete palette");return Array.from(this.paletteIndices).map(e=>t[e])}toPixelBuffer(t,e){return t.place(this.renderFrom(e.palette.completePalette))}static fromPixelBuffer(e,n,o=!1){const{expectedColours:r}=t;if(!(o?e.offset>=r:0===e.offset))return null;const i=o?e.skipped.slice(0,r):e.preview(r);if(!i)return null;const s=n.palette.completePalette,a=t.tryMake(i,s);return o?null!==a&&e.consumeSkipped(r):e.consumeIf(null!==a),a}}).expectedColours=(t=>~~(In[t]/4))(Xn),Yn.expectedDigits=kn[Xn],Yn);var Xn,Yn;class Qn extends Vn{constructor(t,e){if(super(),this.paletteIndex=t,this.length=e,t>16)throw new Error("Invalid palette index");if(e<=0)throw new Error("Length must be positive");if(e>Qn.maxLength)throw new Error("Length too big")}static matchHeader(t){return"BACKGROUND_SELECTION_STREAM"===Bn(t)}representation(){return`${this.name}(${this.paletteIndex}, ${this.length})`}serialize(){const t=new fn(6);return t.pushNumber(Tn.BACKGROUND_SELECTION_STREAM,On.BACKGROUND_SELECTION_STREAM),t.pushNumber(this.paletteIndex,4),t.pushNumber(this.length-1,In.BACKGROUND_SELECTION_STREAM-4),gn(t.topUp().numbers)}renderFrom(t){if(t.length<16)throw new Error("Received incomplete palette");return Array.from({length:this.length}).fill(t[this.paletteIndex])}static fromTape(t){const e=this.readTape(t);return null===e&&t.warnExpected("expected BackgroundSelectionStream token",Qn.expectedDigits),e}static readTape(t){const e=t.readExactly(Qn.expectedDigits);if(void 0===e)return null;const n=pn(e);if(null===n)return null;const o=new fn(6,Array.from(n)),r=o.shiftBits(On.BACKGROUND_SELECTION_STREAM);if(r!==Tn.BACKGROUND_SELECTION_STREAM)throw new Error(`Bytes read (${null==r?void 0:r.toString(2)}) do not start with background selection header`);const i=o.shiftBits(4),s=o.shiftBits(In.BACKGROUND_SELECTION_STREAM-4);return void 0===i||void 0===s?null:new Qn(i,s+1)}toPixelBuffer(t,e){return t.backgroundColour=e.palette.completePalette[this.paletteIndex],t.skip(this.length)}static fromPixelBuffer(t,e,n=!1){if(t.done())throw new Error("Buffer is exhausted");const{offset:o,backgroundColour:r,skipped:i}=t,{completePalette:s}=e.palette;if(o<(n?1:Wn.expectedColours))return null;if(Dn(i[i.length-1],r)||i.pop(),i.some(t=>!Dn(t,r)))throw t.debug(),new Error("Cannot create stream over non-bg colour");const a=Gn(r,s);return t.consumeSkipped(i.length),new Qn(a[0],i.length)}}Qn.expectedDigits=kn.BACKGROUND_SELECTION_STREAM,Qn.maxLength=1<<In.BACKGROUND_SELECTION_STREAM-4;class Zn extends Vn{constructor(){super(...arguments),this.offset=NaN}}const to=function(t){var e;return(e=class e extends Zn{constructor(e,n){if(super(),e<0)throw new RangeError("Offset can't be negative");if(e>jn[t])throw new Error(`Offset ${e} too big to encode`);this.colour=Ln.map(n),this.offset=e}static matchHeader(e){return Bn(e)===t}get name(){return"OFFSET"===t?"OffsetColour":"OffsetColourLong"}representation(){return`${this.name}(${this.offset}, ${Mt(this.colour)})`}serialize(){const n=new fn(6);n.pushNumber(Tn[t],On[t]),n.pushNumber(this.offset,In[t]),n.topUp();const o=gn([...n.numbers,...Ln.serialize(this.colour)]);if(o.length!==e.expectedDigits)throw new Error(`Expected token serialization of length ${e.expectedDigits}, got "${o}"`);return o}static fromTape(t){const n=this.readTape(t);return n||t.warnExpected("expected OffsetColour token",e.expectedDigits),n}static readTape(n){const o=n.readExactly(kn[t]);if(!o)return n.advance(Ln.digits),null;const r=pn(o);if(!r)return n.advance(Ln.digits),null;const i=new fn(6);i.pushNumbers(Array.from(r),6);const s=i.shiftBits(On[t]);if(s!==Tn[t])throw new Error(`Bytes read (${null==s?void 0:s.toString(2)}) do not start with offset header`);const a=i.toNumber(),c=n.read(Ln.digits);if(null===c)return null;const l=pn(c);if(null===l||l.length!==Ln.digits)return null;const u=Ln.deserialize(Array.from(l));return null===u?null:new e(a,u)}getRGB(){return this.colour}toPixelBuffer(t,e){const n=t.skip(this.offset);return n&&t.placeOne(this.getRGB()),n}static fromPixelBuffer(t,n=!1){const o=n?t.skipped.slice(-1)[0]:t.getNext(),r=n?t.offset-1:t.offset;if(r<0)throw new Error("Can't use last skipped pixel");const i=new e(r,o);return n?t.consumeSkipped(1):t.consumeCount(1),i}}).expectedDigits=kn[t]+Ln.digits,e.maxOffset=jn[t],e}("OFFSET"),eo=to;function no(t){return console.log("tokens:\n",t.map(t=>t instanceof Kn?`${t.representation()}: '${t.serialize()}'`:t).join("\n"))}class oo{static serializeTokens(t){console.time("serializeTokens()");const e=t.map(t=>t.serialize()).join("");return console.timeEnd("serializeTokens()"),e}static writeImage(t,e){const{size:n,palette:o}=e,r=o.completePalette[0],i=new yn(e.size.pixels,r);t.forEach(t=>t.toPixelBuffer(i,e));return Nt(i.toImage(),n.width,n.height,r,4)}}var ro;!function(t){t[t.BackgroundColour=0]="BackgroundColour",t[t.PaletteColour=1]="PaletteColour",t[t.CustomColour=2]="CustomColour"}(ro||(ro={}));class io{static readToken(t,e){if(t.done())throw new Error("Pixel buffer exhausted");const{maxLength:n}=Qn,{maxOffset:o}=eo,{BackgroundColour:r,CustomColour:i,PaletteColour:s}=ro,{offset:a,backgroundColour:c}=t,{completePalette:l}=e.palette,u=function(t,e,n){const o=Gn(t,n);if(null===o)return[ro.CustomColour,t];const r=o[1];return function([t,e,n]){return([o,r,i])=>t===o&&e===r&&n===i}(r)(e)?[ro.BackgroundColour,e]:[ro.PaletteColour,r]}(t.getNext(),c,l),[d,f]=u,m=a-n,h=a-o;if(m>0){if(h>0)throw t.debug(),new Error("Unreachable");n>=o&&console.warn("strangely, this happened (1)");const e=d===r,i=wt(eo.fromPixelBuffer(t,e));return d===s&&(t.backgroundColour=f),i}if(h<0)return d===r?null:d===i?wt(eo.fromPixelBuffer(t)):this.backgroundChangeToken(t,e,f);if(n<o&&console.warn("strangely, this happened (2)"),d===r&&m<0)return null;const p=Qn.fromPixelBuffer(t,e,!0);return d===s&&(t.backgroundColour=f),wt(p)}static backgroundChangeToken(t,e,n){const o=Yt(()=>Qn.fromPixelBuffer(t,e)),{offset:r}=t;if(0===r||o())return t.backgroundColour=n,0===r?null:wt(o());const i=e.palette.completePalette,s=Wn.expectedColours-t.offset;if(s<0)throw t.debug(),new Error("Expected offset less than PaletteSelection's worth, got "+t.offset);const a=t.preview(s);if(null==a?void 0:a.every(t=>Gn(t,i))){t.skip();const n=Wn.fromPixelBuffer(t,e,!0);if(!n)throw new Error("Checks insufficient");return n}a&&t.backtrack();const c=Qn.fromPixelBuffer(t,e,!0);return c?(t.backgroundColour=n,c):wt(to.fromPixelBuffer(t))}static toTokens(t,e){console.time(`fromPixels(${e.size.toString()})`);const n=[];for(;!t.done();){const o=t.remaining(),{offset:r}=t,i=this.readToken(t,e);null!==i?n.push(i):t.skipCount(1);const s=t.skipped.slice(-1)[0];if(t.offset&&!Dn(s,t.backgroundColour))throw t.debug(),console.log("Last token",null==i?void 0:i.representation()),no(It(n).slice(-10)),new Error("Last skipped colour is not background color");if(o===t.remaining()&&r===t.offset)throw console.error("Last token",null==i?void 0:i.representation()),t.debug(),new Error("No pixels processed")}for(;this.isFinalTokenUseless(n,t,e);)n.pop();return console.timeEnd(`fromPixels(${e.size.toString()})`),n}static isFinalTokenUseless(t,e,n){var o;const r=t[t.length-1];if(void 0===r)return!1;const i=null===(o=Gn(e.backgroundColour,n.palette.completePalette))||void 0===o?void 0:o[0];if(null===i)throw new Error(`pixels.backgroundColour ${e.backgroundColour} strayed from palette`);return r instanceof Qn&&r.paletteIndex===i||(!!(r instanceof Wn&&r.paletteIndices.every(yt(i)))||!!(r instanceof Zn&&Dn(r.getRGB(),e.backgroundColour)))}static parseMetadata(t){const e=Hn.fromTape(t);if(!e)return null;const n=qn.fromTape(t);return n?{size:e,palette:n}:null}static parseContent(t){const e=[];for(;!t.outOfBounds();){const n=hn(t.peek());if(null===n)return t.warnExpected("expected valid b64 digit",1,!1);if(to.matchHeader(n)){const n=to.fromTape(t);if(!n)return null;e.push(n)}else if(eo.matchHeader(n)){const n=eo.fromTape(t);if(!n)return null;e.push(n)}else if(Wn.matchHeader(n)){const n=Wn.fromTape(t);if(!n)return null;e.push(n)}else{if(!Qn.matchHeader(n))return t.warnExpected("unknown header type: 0b"+n.toString(2));{const n=Qn.fromTape(t);if(!n)return null;e.push(n)}}}return e}}const so=function(t){const e={};return n=>(Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t(n)),e[n])}(t=>{const e=new rn(t),n=io.parseMetadata(e);if(!n)return null;const o=io.parseContent(e);return null===o?null:oo.writeImage(o,n)});async function ao(t,e){const n=await gt(async function(t){const e=new FileReader;if(await Tt(e,"load",e=>e.readAsDataURL(t)),!e.result)throw new Error("Got no result reading file");return e.result.toString()}(t),5e3,"Could not read file"),r=await gt(async function(t){const e=new Image;return await Tt(e,"load",e=>{e.src=t}),e}(n),5e3,"Could not load image");k.open(Nt(_n(r,{interpolator:Mn.none,width:r.width,height:r.height}),r.width,r.height));const{pixels:i,metadata:s}=class{static readImage(t,e){console.time("readImage()");const n=new Hn(e.width,e.height),{width:o,height:r}=n;Object.assign(e,{width:o,height:r});const i=_n(t,e).map(Pn.colour512.map);if(0===i.length)throw new Error("Error sampling image");const s=i.map(Pn.colour512.serialize).map(t=>t.map(dn).join("")),a=this.selectPalette(s),c=qn.fromRGB(a),l={pixels:Rn.fromImage(i),metadata:{size:n,palette:c}};return console.timeEnd("readImage()"),l}static selectPalette(t){const e=Pn.colour512,n=[];let o=function(t){const e={};Array.prototype.forEach.call(t,t=>{var n;const o=(null!==(n=e[t])&&void 0!==n?n:0)+1;e[t]=o});const n=Array.from(Object.entries(e));return kt(n,"1",vt.numeric,"desc",!0),Array.from(n)}(t).map(([t,e])=>[t,e,1]);for(;n.length<qn.paletteLength&&o.length>0;){const t=Array.from(pn(o.shift()[0]));n.push(e.deserialize(t)),o=o.map(([t,o])=>{const r=e.deserialize(Array.from(pn(t))),i=n.map(t=>_t(t,r));return[t,o,Math.min(...i)]}),At(o,Rt(([t,e,n])=>e*n**Cn(),vt.numeric),"desc",!0)}return n}}.readImage(r,e),{width:a,height:c}=s.size;const l=[s.size,s.palette],u=io.toTokens(i,s);const d=[...l,...u];const f=oo.serializeTokens(d);return function(t){if(t.length<=7500)return;const{length:e}=t;throw o.warning(`attempted to produce string (${e}): ${t}`),new Xt(`Resolution too big (result would be ${e} characters long)`)}(f),f}function co(t){return t}const lo="0",uo="i";const fo={0:i,i:{unpack:t=>Ue(t),compress:async t=>(await Oe(t)).id,parse:t=>function(t){const e=t.match(Pe());return e?e[1]:null}(t)}};function mo(t,e){if(!(e in fo))throw new Error(`Format '${e}' not implemented`);const n=fo[e].parse(t);return null===n?null:e+n}const ho={feed:{name:"Feed"},info:{name:"Info"},pictures:{name:"My Album"}};function po(){const{id:t}=App.user;MenuReactMicro.close(),null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(t)}function go(...t){return t.map(t=>{return e=t,n=(null===UserProfileReact||void 0===UserProfileReact?void 0:UserProfileReact.state.tab)===t,nt.a.createElement("div",{onMouseDown:null===UserProfileReact||void 0===UserProfileReact?void 0:UserProfileReact.switch_tab.bind(UserProfileReact,e),className:n?"user-profile-tab user-profile-tab-active":"user-profile-tab"},ho[e].name);var e,n})}function vo(){PictureAlbum.prototype.set_display_picture=function(t){const e=mo(t.url,uo);e&&(ae(App.user,e),po())},PictureAlbum.prototype.delete_picture=function(t){const e=mo(t.url,uo),n=[...tt.get(Q.imgurPfpAlbum)];e&&n.includes(e)&&(n.splice(n.indexOf(e),1),tt.set(Q.imgurPfpAlbum,n),po())},UserProfile.prototype.tabs=function(){const t=["feed","info"];return this.state.data.user.id===App.user.id&&t.push("pictures"),nt.a.createElement("div",null,...go(...t))},PictureAlbum.prototype.add_to_album=function(){PictureUploader.onUploaded=function(t){const{url:e}=t;bo(e),po()}},PictureAlbum.prototype.upload_picture=function(){ze.a.render(Qe(),document.getElementById("ui-hatch-2"))},PictureAlbum.prototype.componentDidMount=function(){const t=tt.get(Q.imgurPfpAlbum).map(t=>({url:7===t.length?Ue(t):Ue(t.substring(1))}));this.setState({pictures:t,loaded:!0})}}function bo(t){let e=re(t);const n=t.match(Pe());7!==(null==e?void 0:e.length)&&n&&(e="i"+n[1]);const o=tt.get(Q.imgurPfpAlbum);o&&e&&!o.includes(e)&&(tt.set(Q.imgurPfpAlbum,[...o,e]),null===UserProfileReact||void 0===UserProfileReact||UserProfileReact.load(App.user.id))}n(9);function wo(t){const e=t instanceof Array?t.join(""):t;return{message:e,uppercase:e.split("").filter(t=>t.toLowerCase()!==t),entropySplit:Vt(e,/\s+/),entropy:Vt(e),repeating:Ht(e),noLowerCase:e.toUpperCase()===e}}function yo(t){var e,n,o;const r=null===(e=Qt(t))||void 0===e?void 0:e.created_at;return{accountCreated:r?new Date(r):new Date,id:Zt(t),displayName:null!==(o=null===(n=Qt(t))||void 0===n?void 0:n.display_name)&&void 0!==o?o:""}}var Ro,Ao;(Ao=Ro||(Ro={})).legacy=function(t,{messages:e}){const n=Date.now(),{message:o,uppercase:r}=wo(e);t.scoreLegacy+=(1e3/(jt(t.lastMessageTime)||n))**.2,t.scoreLegacy/=Math.max(1/Math.E,Math.E-Math.log(10+o.length+r.length)/4)},Ao.strikeBased=function(t,e){const{max:n,log10:o}=Math,r=Date.now(),{accountCreated:i}=yo(e.user),{message:s,entropySplit:a,noLowerCase:c,repeating:l}=wo(e.messages),u=r-t.lastMessageTime||1500;if(u<=1e3?t.scoreStrikes+=1:u>2e3&&(t.scoreStrikes=n(0,t.scoreStrikes-o(u))),jt(i)<6e5){const e=s.length>200;(a<2||l>3)&&e&&(t.scoreStrikes+=1),t.scoreStrikes*=c?3:2}},Ao.experimental=function(t,e){const{max:n,abs:o}=Math,{accountCreated:r}=yo(e.user),i=wo(e.messages),{entropy:s,uppercase:a}=i,c=i.message.trim(),{length:l}=c,u=l?l**-.2:1,d=l?l/n(a.length+l-3,l):1,f=.75*(jt(r||new Date)/864e5)**.1,m=s*d*u*f,h=(m+function(t){const{message:e}=wo(t),n=e.toLowerCase(),r=Vt(n)-Vt(n+c);return o(r)}(t.lastMessage)*m)/2,p=n(jt(t.lastMessageTime||r||new Date),500);t.scoreExperimental/=p/2e3,t.scoreExperimental+=1-h,t.scoreExperimental=n(0,t.scoreExperimental)};const ko=[19364487,19422865,11427049,16008266,21550262,21541886,14267520],xo={},Co={};function Eo(t){var e;const{messages:n,user:o}=t;if(void 0===n)return;const r=Zt(o),i=Date.now();xo[r]=null!==(e=xo[r])&&void 0!==e?e:{scoreLegacy:1,scoreStrikes:0,scoreExperimental:1,lastMessageTime:0,lastMessage:""};const s=xo[r];Ro.legacy(s,t),Ro.strikeBased(s,t),Ro.experimental(s,t),s.lastMessageTime=i,s.lastMessage=n.join(""),function(t,e){const{id:n,displayName:o}=yo(e),{room:r}=App,i=t.scoreStrikes,s=ko.includes(n),a=r.muted.includes(n),c=!s&&i>=3&&!a&&tt.get(Q.antiSpam),l=i<1&&a&&Co[n];if(c){if(n===App.user.id)return ht("AutoMute: You would have gotten muted"),void console.log("User would be muted here");Co[n]=!0,r.mute(n,o,"spam"),ht(`AutoMute: Muted user ${o}.`)}l&&(delete Co[n],r.unmute(n),ht(`AutoMute: Unmuted user ${o}.`))}(s,o)}function Mo(t){const e=Zt(t);delete xo[e]}function No(t){if(null==(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.id)||"private"===(null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.mode))return;const{user:e}=t;"number"!=typeof e&&(e.display_name=e.display_name.replace(/[\u061C\u200E-\u200F\u202A-\u202E\u2066-\u2069]/g,"")),function({user:t,user_disconnected:e}){if(!("state"in RoomChannelMembersClient)||"number"==typeof t)return;if(e)return void ht(`User ${t.display_name} left the chat.`);const n=Zt(t),{members:o}=RoomChannelMembersClient.state;o.map(Zt).includes(n)||ht(`User ${t.display_name} joined the chat.`),RoomChannelMembersClient.add_member(t)}(t),Eo(t)}var $o=n(10),Po=n.n($o);const Uo={};var _o;function So(t){t.onerror||(t.onerror=async()=>{switch(function(t){return(t=>t.classList.contains("room-component-message-picture"))(t)?_o.NoFallbackAvailable:t.src.startsWith("https://robohash.org/")||t.src.startsWith("data:image")?_o.AviconFallback:t.src.includes("/avicons_strict/")?_o.NoFallbackAvailable:_o.RobohashFallback}(t)){case _o.RobohashFallback:t.src=`https://robohash.org/yay${t.src}.png?set=set4`;break;case _o.AviconFallback:t.src="https://emeraldchat.com/avicons_strict/1.png"}})}function To(t,e){return!0===Uo[t.src]?(e&&(t.src=e),!1):!1===Uo[t.src]&&(t.src="https://emeraldchat.com/avicons_strict/1.png",!0)}function Oo(t){if(t.classList.contains("zoomIn"))return;if(!Re().test(t.src))return;const{src:e}=t;To(t)||async function(t){const e=await fetch(t),n=await e.arrayBuffer(),o=new Uint8Array(n.slice(0,4)),r=Array.from(o).map(t=>t.toString(16)).join("");if(r.startsWith("424d"))return"image/bmp";switch(r){case"89504e47":return"image/png";case"47494638":return"image/gif";case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"25504446":return"application/pdf";default:return}}(e).then(n=>{Uo[e]="image/gif"!==n,To(t,e)})}function Io(){document.querySelectorAll('img[src*="/badges/tick.svg"]').forEach(t=>{var e;const n=t.parentElement;t.outerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.1 146.8">\n<path d="M140 59l-5-5c-2-2-3-3-2-6V39v-1c0-12-10-21-21-22h-11c-2 0-4 0-6-3l-7-7c-4-3-9-5-15-5-5 0-10 2-14 6-3 1-5 3-6 5-3 4-5 5-9 4h-9a25 25 0 00-21 33v1c0 2 0 3-2 5l-5 5-1 2a26 26 0 00-2 29c1 4 4 7 7 10l3 3-1 4c0 15 12 26 26 26h6c3-1 5 0 7 2 3 4 6 7 10 9a22 22 0 0023-1c4-1 8-4 10-8l6-3 6 1c15 0 26-11 26-25v-3c0-2 1-4 3-5l7-9c2-4 4-9 4-14 0-7-2-13-7-18zm-29-9l-37 55c-2 2-3 4-5 4-4 0-6-1-8-3L42 86c-3-3-4-7-1-10s7-3 10 1l13 12c2 2 3 2 4-1l31-46c3-4 6-6 11-3 4 3 3 7 1 11z" fill="#1da0f1"/>\n<path d="M110 39c-4-3-8-1-11 3L68 89c-1 2-2 2-4 0L51 77c-3-4-7-4-10-1s-2 7 1 10l20 20c1 2 3 3 7 3 2 0 3-2 5-4l37-55c2-4 3-8-1-11z" fill="#fefefe"/>\n</svg>',null===(e=null==n?void 0:n.querySelector("svg"))||void 0===e||e.classList.add("user-badge-tick")}),Array.from(document.images).forEach(t=>{var e;So(t),t.complete&&0===t.naturalHeight&&(null===(e=t.onerror)||void 0===e||e.call(t,"")),tt.get(Q.showAnimatedImages)||Oo(t)})}function jo(){var t,e;if(!tt.get(Q.fancyColors))return;const n=document.querySelector('label.ui-select[for="flair-select"]');if(!n||"flair-select"!==(null===(t=n.firstElementChild)||void 0===t?void 0:t.id))return;n.htmlFor="flair-select-old";const o=new Event("change",{bubbles:!0}),r=n.cloneNode();r.classList.add("disable-after"),n.firstElementChild.id="flair-select-old",n.style.display="none";const i=it("input",{id:"flair-select",className:"alt-flair-select",value:App.user.flair.color}),s=it("input",{id:"flair-select",type:"color",className:"picker-flair-select",value:App.user.flair.color,oninput:()=>{var t;i.value=s.value,null===(t=n.firstChild)||void 0===t||t.dispatchEvent(o)}});r.append(i,s),null===(e=n.parentElement)||void 0===e||e.insertBefore(r,n.nextSibling),i.oninput=()=>{var t;s.value=i.value,null===(t=n.firstChild)||void 0===t||t.dispatchEvent(o)}}!function(t){t[t.RobohashFallback=0]="RobohashFallback",t[t.AviconFallback=1]="AviconFallback",t[t.NoFallbackAvailable=2]="NoFallbackAvailable"}(_o||(_o={}));var Bo=n(11),Lo=n.n(Bo);function zo(t){let e;const n=t.apply(this);return this.props.data?(this.props.data.data&&(e=this.props.data.data.sender.gender),this.props.data.gender&&(e=this.props.data.gender),n.props.children?n.props.children[0].props["data-gender"]=e:n.props["data-gender"]=e,n):n}function Do(t){var e,n,o;const r=(null!==(n=null!==(e=t._karma)&&void 0!==e?e:t.karma)&&void 0!==n?n:0)<10,i=!(null===(o=null==t?void 0:t.display_picture)||void 0===o?void 0:o.includes("emeraldchat.com/uploads"))||r?`https://robohash.org/yay${t.id}.png?set=set4`:t.display_picture,s=Zt(App.user)===Zt(t);if(r&&!s&&tt.get(Q.imgProtect))return i;if(void 0===t.bio)return console.warn("user.bio is undefined"),i;const a=re(t.bio);if(!a)return i;return function(t){const e=t[0];return e in fo?fo[e].unpack(t.slice(1)):(console.error(`could not unpack image: ${t} (unknown format '${e}')`),null)}(a)||i}function Fo(t,e,n){const o=t.prototype;ct(o,e,(function(...t){n(this,...t).forEach(t=>{void 0!==t&&(function(t){return t&&"object"==typeof t&&"display_picture"in t&&void 0!==t.display_picture&&void 0!==t.bio}(t)?t.display_picture=Do(t):function(t,e,n){var o,r,i;const s=null!==(r=null===(o=null==t?void 0:t.constructor)||void 0===o?void 0:o.displayName)&&void 0!==r?r:null===(i=null==t?void 0:t.construct)||void 0===i?void 0:i.name,a=s?s+".prototype":"(???)",c=e+"()";console.warn(`[interceptDebug] ${a}.${c} got user = `,n)}(o,e,t))})}),!0)}function Go(){const t=document.querySelector(".main-logo");t&&(function(){const t=document.querySelector(".navigation-notification-icons"),e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(document.fullscreenEnabled&&(null==t?void 0:t.children)&&!Array.from(null==t?void 0:t.children).some(t=>{var e;return null===(e=null==t?void 0:t.textContent)||void 0===e?void 0:e.includes("full")})&&!e){const e=it("span",{className:"material-icons navigation-notification-unit",textContent:"open_in_full",onmousedown:async()=>{document.fullscreenElement?(document.exitFullscreen(),e.textContent="open_in_full"):(await document.body.requestFullscreen(),e.textContent="close_fullscreen")}}),n=it("span");n.append(e),t.prepend(n)}}(),function(t){const e=Do(App.user);t instanceof HTMLImageElement&&t.src!==e&&(t.src=e)}(t),function(){if(document.head.querySelector(`link[rel="icon"][href="${u}"]`))return;document.head.querySelectorAll('link[rel="icon"]').forEach(t=>t.remove());const t=it("link",{rel:"icon",href:u});document.head.prepend(t)}(),function(t){var e;if(document.querySelector(".karma-tracker"))return;const n=it("div",{className:"karma-tracker"});null===(e=null==t?void 0:t.parentElement)||void 0===e||e.insertBefore(n,null==t?void 0:t.nextSibling)}(t),function(t){const e=`${App.user.display_name||"(...)"} - ${c} ${l}`;document.title!==e&&(document.title=e);const n=document.querySelector(".main-logo-text");if(!n){const n=it("div",{className:"main-logo-text",textContent:e});t.parentElement&&t.parentElement.insertBefore(n,t.nextSibling)}n&&n.textContent!==e&&(n.textContent=e)}(t))}var Ko=n(12),Vo=n.n(Ko);var Ho=n(13),qo=n.n(Ho);let Jo=null;function Wo(t){500===t.status&&(App.room&&App.room.leave(App.room.id),k.location.href="/")}function Xo(t){const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(t===Jo)return;null!==Jo&&function(t){const e=it("div",{className:"karma-delta "+(t>0?"positive":"negative"),textContent:Ft(t)});document.body.append(e),setTimeout(()=>e.classList.add("zoom"),250),setTimeout(()=>e.remove(),5e3)}(t-Jo),Jo=t;const n=document.querySelector(".karma-tracker");if(n)if(e){if(!t)return void(n.textContent="");t>0?n.textContent="+"+t:t<=0&&(n.textContent=""+t),n.style.color=t>0?"#3ec435":"#eb3b3b"}else n.textContent=t?"Karma: "+t:""}function Yo(){const{id:t}=App.user;t?$.ajax({type:"GET",url:"/profile_json?id="+t,dataType:"json",success:t=>Xo(t.user.karma),error:t=>Wo(t)}):setTimeout(Yo,500)}function Qo(){const t=RoomChannelMembers.prototype.setState;RoomChannelMembers.prototype.setState=function(e){e&&"members"in e&&function(t,e){const n=It(t);It(e).forEach(t=>{!function(t,e){e.delta=t?e.karma-t.karma:0}(n.find(({id:e})=>e===t.id),t)})}(this.state.members,e.members),t.call(this,e)};const e=UserUnit.prototype.body;UserUnit.prototype.body=function(){const t=e.call(this),n=this.props.data;return n.delta<0&&(t.props.className+=" down"),n.delta>0&&(t.props.className+=" up"),t}}function Zo(t){var e,n,o;if(!(null===(o=null===(n=null===(e=App.room)||void 0===e?void 0:e.id)||void 0===n?void 0:n.startsWith)||void 0===o?void 0:o.call(n,"channel")))return!1;if(!(RoomChannelMembersClient instanceof nt.a.Component))return!1;const r=+App.room.id.slice(7),i=t.find(({channel:t})=>t.id===r);if(!i)return!1;const s=It(RoomChannelMembersClient.state.members);It(i.members).forEach(t=>{const e=s.findIndex(({id:e})=>e===t.id);e>-1?s[e]=t:s.push(t)});const a=function(t){const e=RoomChannelMembersClient.state.members_persistent||[],n=t.filter(t=>!e.find(e=>(null==e?void 0:e.id)===t.id)),o=[...e,...n];return o.length>100&&o.splice(0,o.length-100),o}(s);RoomChannelMembersClient.setState({members:s,members_persistent:a});const c=i.members.find(t=>(null==t?void 0:t.id)===App.user.id);return!!c&&(Xo(c.karma),!0)}function tr(t){const e=(n=t.text_channels,RoomChannelSelectClient.state.text_channels.map(t=>{const e=n.find(({channel:e})=>e.id===t.channel.id);if(!e)return t;const{members:o}=e;return Object.assign(Object.assign({},t),{members:o})}));var n;RoomChannelSelectClient.setState({text_channels:e});Zo(e)||Yo()}function er(){const{id:t}=App.user;t?(setTimeout(er,6e4),RoomChannelMembersClient instanceof nt.a.Component&&$.ajax({type:"GET",url:"channels_default",dataType:"json",success:tr,error:Wo})):setTimeout(er,500)}const nr=/^(?:spotify:|https:\/\/[a-z]+\.spotify\.com\/(track\/|user\/(.*)\/|playlist\/))([a-zA-Z0-9]+)(.*)$/,or=/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,rr=t=>or.test(t),ir=t=>nr.test(t),sr=t=>{const e=or.exec(t);return e?e[6]:null},ar=t=>{const e=nr.exec(t);return e?e[1]+e[3]:null};function cr(t){return rr(t)&&sr(t)?(t=>`<div class="ritsu-youtube-embed embed"> <iframe class="embed-responsive-item" \n  loading="lazy"\n  src="https://www.youtube.com/embed/${sr(t)}"\n  frameborder="0" allowfullscreen></iframe></div>`)(t):ir(t)&&ar(t)?((t,e)=>`<div class="ritsu-spotify-embed spotify embed"><iframe \n  src="https://open.spotify.com/embed/${ar(t)}?utm_source=generator"\n  loading="lazy"\n  height="${e} !important" frameBorder="0" allowfullscreen="" \n  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">\n  </iframe></div>`)(t,(t=>t.includes("playlist")?380:80)(t)):null}class lr extends nt.a.Component{render(){const{href:t}=this.props,e=(t=>/^https?:\/\//.test(t)?t:"https://"+t)(t);try{const o=new URL(e),i=(r=o.host,Array.from(r.matchAll(/[^-._a-zA-Z0-9~]/g)).map(t=>t[0])),s=i.length>0,a=`âš  Are you sure you want to open this link? âš \nNote that shady sites can guess your location and earmark your browser. Beware URLs on safe domains that look like redirects. The site you're about to visit is hosted by ${o.host}.`+((n=i).length>0?"\nâš  Type this link yourself instead if you don't want to be fooled. âš \nThe following characters in the link look suspicious:\n"+n.map(pe):"");return o.protocol.toLowerCase().startsWith("javascript")?t:nt.a.createElement("a",{className:"ritsu-message-anchor",href:s?"#":o.href,target:"_blank",onClick:t=>{confirm(a)&&!s||t.nativeEvent.preventDefault()},rel:"noreferrer"},e)}catch(e){return e instanceof Error&&o.error(e.message),t}var n,r}}const ur=t=>e=>t().some(t=>t.test(e)),dr=ur(()=>[/\//g,/[^.]+?\.[^.]+?\.[^.]+?/g,/\.com|\.org|\.net|\.co\.uk|\.eu|\.us|\.gov|\.io/]),fr=ur(()=>[/emeraldchat/gi,/grabify/gi,/ip-puller/gi,/hackingvision/gi,/iplogger/gi,/bit\.ly/gi,/blasze/gi,/ps3CFW/gi,/powercut/gi,/whatstheirip/gi,/\.gift/gi,/(^|https?:\/\/)\w{3}\.\w{2}(\/|$)/gi]),mr=ur(()=>[/(^|https?:\/\/)(i\.)?ibb\.co(\/|$)/gi]),hr=t=>{const e=ve(t),n=t||null;if(!dr(e))return n;if(e.match(/^[^\s@]+@[^\s@]+(\.|(%2E))\u200b?[^\s@]+$/gi))return e;const o=tt.get(Q.ignoreURLBlacklist);return mr(e)||!fr(e)||o?nt.a.createElement(lr,{href:e}):n};function pr(t,e){return zt(t,Wt(we,`(${be}|${ye}){2,256}`,be+"[a-z]{2,}",`\\b(\\/(${be}|${ye}|\\/)*)?`,"gi"),hr,e)}var gr=n(14),vr=n.n(gr);function br(t){const e="channel"===this.state.mode?50:5e3,{messages:n}=this.state;t.forEach(t=>{0===t.messages.length&&t.messages.push(""),n.length>e&&n.shift();const o=n[n.length-1];if(o&&Zt(o.user)===Zt(t.user)&&!o.picture&&!t.picture&&o.messages.length<16){const e=o.messages,i=e[e.length-1];if(!i||t.messages[0]===i)return;(rr(r=i)||ir(r))&&n.push(t),o.messages.push(t.messages[0])}else n.push(t);var r}),1===t.length?this.state.messages=n:this.setState({messages:n})}function wr(t){const{user:e,karma:n,colour:o,textShadow:r,timeago:i}=t;return nt.a.createElement("span",{className:"user-extra"},nt.a.createElement("b",null,"(",n,")")," / ",nt.a.createElement("span",{style:{color:o,textShadow:r,whiteSpace:"nowrap"}},i),e.master&&!e.proxy&&nt.a.createElement("b",{style:{color:"#f00"}}," CALLAN "),e.mod&&!e.proxy&&nt.a.createElement("b",{style:{color:"#f00"}}," MOD "))}function yr(){at(vr.a),Message.prototype.content=function(){var t,e,n;const{picture:o,messages:r,user:i}=this.props.data,s=Zt(this.props.data.user)===Zt(App.user),a=tt.get(Q.imgProtect),c=(null===(t=Qt(i))||void 0===t?void 0:t.temp)||(null!==(n=null===(e=Qt(i))||void 0===e?void 0:e.karma)&&void 0!==n?n:0)<10;return o&&!(!s&&c&&a)?nt.a.createElement(MessagePicture,{picture:o}):o?[nt.a.createElement("div",null,"(Image blocked) ",pr(o.url,t=>t))]:r.map(t=>nt.a.createElement("div",{key:JSON.stringify(t)},this.process(t)))},Message.prototype.render=function(){var t,e,n,o,r,i,s,a;this.props.data.user||console.warn("this.props.data.user may be falsy despite declaration");const c=null!==(t=function(t){if(!("state"in RoomChannelMembersClient))return;const{members:e,members_persistent:n}=RoomChannelMembersClient.state;return(e||n).find(e=>(null==e?void 0:e.id)===t)}(Zt(this.props.data.user))||Qt(this.props.data.user))&&void 0!==t?t:null,l=Zt(this.props.data.user)===Zt(App.user);let u=!1;App.room.muted.includes(Zt(c))&&(u=!0);try{const t=tt.get(Q.muteRegexes)[0];if(t&&(null==c?void 0:c.display_name)){const{source:e,flags:n}=t,o=new RegExp(e,n),r=["","(?:)"].includes(e);o.test(c.display_name)&&!r&&(u=!0)}}catch(t){}const d={string:(null===(e=null==c?void 0:c.display_name)||void 0===e?void 0:e.trim())||"(no name)",flair:null!==(n=null==c?void 0:c.flair)&&void 0!==n?n:{color:""}},f=Ft(null!==(r=null!==(o=null==c?void 0:c._karma)&&void 0!==o?o:null==c?void 0:c.karma)&&void 0!==r?r:0),m=c?function(t){const e=Math.log(+new Date-+new Date(t.created_at)+1);return Math.min(e/Math.log(5e11),1)}(c):0,h=(null==c?void 0:c.created_at)&&new Date(null==c?void 0:c.created_at),p=h&&!Number.isNaN(h.getTime())?$.timeago(h):null,g=`hsl(${256*m}, 50%, 50%)`,v=["room-component-message-text"],{picture:b}=this.props.data;b&&v.push("ritsu-would-blur-heavy"),u&&v.push("ritsu-message-hidden");const w=["room-component-message-avatar"];(null===(i=null==c?void 0:c.display_picture)||void 0===i?void 0:i.startsWith("https://robohash.org/"))||(null===(s=null==c?void 0:c.display_picture)||void 0===s?void 0:s.startsWith("https://emeraldchat.com/avicons_strict/"))||l||w.push("ritsu-would-blur");const y=c?nt.a.createElement(wr,{user:c,karma:f,timeago:p,color:g,textShadow:"0.005em 0.005em #FFF5"}):null;return nt.a.createElement("div",{className:"room-component-message-container","data-id":null==c?void 0:c.id},nt.a.createElement("div",{className:"room-component-message-left"},nt.a.createElement("img",{className:w.join(" "),alt:"User display avatar",src:null==c?void 0:c.display_picture,onMouseDown:t=>c&&UserViewGenerator.generate({event:t,user:c})})),nt.a.createElement("div",{className:"room-component-message-right"},nt.a.createElement("div",{className:"room-component-flair"},nt.a.createElement(Flair,{data:d})),nt.a.createElement(Badge,{badge:null!==(a=null==c?void 0:c.badge)&&void 0!==a?a:null}),tt.get(Q.showInfo)&&y,nt.a.createElement("div",{className:v.join(" ")},u?nt.a.createElement("i",null,"Blocked message"):this.content())))},Room.prototype.received=function(t){var e,n,o,r;Zt(t.user)!==App.user.id&&t.messages&&(App.room.play_sound("/sfx/simple_alert.wav"),this.append(t),PushNotifications.idle()&&PushNotifications.send(null!==(n=null===(e=Qt(t.user))||void 0===e?void 0:e.display_name)&&void 0!==n?n:"",{icon:null!==(r=null===(o=Qt(t.user))||void 0===o?void 0:o.display_picture)&&void 0!==r?r:"",body:t.messages[0]}))}}function Rr(){var t,e;const n=document.querySelectorAll(".room-component-message-container"),o=null===(t=null===RoomClient||void 0===RoomClient?void 0:RoomClient.state)||void 0===t?void 0:t.messages;if(null==o?void 0:o.length)for(let t=0;t<o.length;t+=1){const r=null===(e=n[t])||void 0===e?void 0:e.querySelector(".room-component-message-text");if(!r||r.classList.contains("ritsu-message-hidden"))continue;const{messages:i}=o[t],s=r.childNodes;for(;s&&s.length>i.length;)s[0].remove();if(!s||!s[0].classList)return;tt.get(Q.bigEmoji)&&1===i.length&&/^\p{Extended_Pictographic}{1,5}$/u.test(i[0])?s[0].classList.add("jumbo-message"):s[0].classList.remove("jumbo-message")}}const Ar=(()=>{let t=0;return()=>"key-"+ ++t})();function kr(){Room.prototype.room_messages=function(t="room-component-messages"){let e=null,n="",o=0;return this.state.messages.forEach(t=>{o+=t.messages.length}),this.state.messages_count>o&&this.state.messages.length>0&&(e=nt.a.createElement("div",{role:"button",tabIndex:0,onMouseDown:()=>this.load_messages(o),className:"room-component-load-button"},"Load More (",o," of ",this.state.messages_count,")")),"private"===this.state.mode&&this.state.messages.length<1&&(n=nt.a.createElement("div",{className:"room-notification"},"No messages here yet. Start a conversation!")),RoomChannelSelectClient.state&&"channel"===this.state.mode&&this.state.messages.length<1&&(n=nt.a.createElement("div",{className:"room-notification"},"No messages here yet!")),nt.a.createElement("div",{id:"messages",className:t},nt.a.createElement(MuteButton,null),this.state.print,n,e,this.state.messages.map(t=>(t.user=function(t){var e;const n=null===(e=null===RoomChannelMembersClient||void 0===RoomChannelMembersClient?void 0:RoomChannelMembersClient.state)||void 0===e?void 0:e.members_persistent;return n?(n.forEach(e=>{(null==e?void 0:e.id)===t.user.id&&(t.user=e)}),t.user):t.user}(t),t.key||(t.key=Ar()),nt.a.createElement(Message,{data:t,key:t.key}))),this.state.print_append)},Room.prototype.append=function(t){br.call(this,[t])}}function xr(){document.querySelectorAll(".room-component-message-text").forEach(t=>{t.childNodes.forEach(t=>{t.classList.contains("text-only")&&(t.querySelector(".embed")||t.querySelector(".room-component-message-picture-container")||t.querySelector(".room-component-message-picture"))&&t.classList.remove("text-only"),t.classList.contains("text-only")||t.classList.contains("room-component-message-picture-container")||t.querySelector(".room-component-message-picture-container")||t.querySelector(".embed")||t.querySelector(".room-component-message-picture")||t.classList.add("text-only")})})}var Cr=n(15),Er=n.n(Cr),Mr=n(5),Nr={insert:"head",singleton:!1},$r=(Er()(Mr.a,Nr),Mr.a.locals||{});function Pr(){return nt.a.createElement("div",{className:$r.ldsDualRing})}function Ur(){const t={match:"text",match_video:"video",match_voice:"voice",channel:"",private:""};function e(t){const{channel:e}=t;this.setState({current_channel:e}),"voice"===e.channel_type&&this.voice_connect(t),null===RoomClient||void 0===RoomClient||RoomClient.clear_messages(),$.ajax({type:"GET",url:"channel_json?id="+e.id,dataType:"json",success(t){const{messages:e}=t;RoomChannelMembersClient.setState({members:t.members}),RoomClient&&br.call(RoomClient,e),null===RoomClient||void 0===RoomClient||RoomClient.scroll()}}),App.room.join("channel"+e.id),RoomClient.state.last_message=null,null===RoomClient||void 0===RoomClient||RoomClient.scroll()}Room.prototype.componentDidMount=function(){this.clear_print();const{mode:e}=this.state,n=t[e];n?this.setState({print:nt.a.createElement(MatchMenu,{data:{queue:n}})}):"channel"===e?this.setState({right_panel:!0,left_panel:!0,print:""}):"private"===e&&(this.setState({right_panel:!0,left_panel:!0}),$.ajax({type:"GET",url:"/default_private_messages?id="+this.props.data.id,dataType:"json",success:function(t){App.room.join(this.props.data.id),br.call(this,t.messages),this.setState({messages_count:t.messages_count,id:this.props.data.id}),this.scroll()}.bind(this)}))},Room.prototype.trim_messages=function(){const t="channel"===this.state.mode?100:5e3,{messages:e}=this.state;e.length>t&&e.shift(),this.setState({messages:e})},Room.prototype.start_typing=function(t){var e;if(t.id===App.user.id)return;let n;n=null===(e=RoomChannelMembersClient.state.members.find(e=>(null==e?void 0:e.id)===t.id))||void 0===e?void 0:e.display_name,n||(n=t.display_name),this.setState({typing:n}),k.typing_timer=setTimeout(()=>{this.stop_typing()},1e4)},RoomChannelSelect.prototype.join=function(t){App.webrtc.client&&this.voice_disconnect(),this.expand(!1),this.setState({messages:[]}),this.updated=e.bind(this),this.updated(t),this.updated=function(){}}}function _r(){k.MenuReactMicroStatic||(k.MenuReactMicroStatic={close:()=>null===MenuReactMicro||void 0===MenuReactMicro?void 0:MenuReactMicro.close()}),k.DashboardClient||(k.DashboardClient={setState:()=>{}}),$(k).off("resize").on("resize",()=>{const t=document.getElementById("messages");t&&(t.scrollTop=t.scrollHeight)}),Dashboard.prototype.ads=function(){return nt.a.createElement("div",{})},function(){function t(t){if(!t.updater.isMounted(t))return;const e=ze.a.findDOMNode(t);e&&ze.a.unmountComponentAtNode(e.parentNode)}function e(e){$(e[0]).removeClass("animated fadeIn"),$(e[0]).removeClass("animated fadeOut"),$(e[1]).addClass("animated zoomOut"),setTimeout(t.bind(null,this),70)}function n(){e.call(this,["#menu-micro-bg","#menu-micro"])}function o(e){t(this),e.nativeEvent.stopImmediatePropagation()}Menu.prototype.close=function(){e.call(this,[".ui-bg",".ui-menu"])},UserProfile.prototype.close=function(){e.call(this,[".ui-bg",".user-profile-menu"]),setTimeout(()=>{UserProfileReact=null})},FriendsMenu.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/friends_json",dataType:"json",success:function(t){const{friends:e}=t;t.friends=e.filter(t=>null!==t);const n=this.state.skippedMissing||0,o=e.filter(t=>null===t);this.setState({friends:t.friends,count:t.count,skippedMissing:n+o.length})}.bind(this)})},FriendsMenu.prototype.load_friends=function(){const t=this.state.skippedMissing||0,e=this.state.friends.length+t;$.ajax({type:"GET",url:"/load_friends_json?offset="+e,dataType:"json",success:function(e){if(0===e.length)return;const n=e.filter(t=>null===t),o=e.filter(t=>!n.includes(t)),r={skippedMissing:t+n.length,search:[],friends:[...this.state.friends,...o],count:this.state.count};this.setState(r)}.bind(this)})},MenuMicro.prototype.close=n,MenuMicroStatic.prototype.close=n,UserView.prototype.close=function(){document.removeEventListener("mousedown",this.exit_click,!1),t(this)},UserView.prototype.view_profile=function(){const{id:e}=this.state.user;UserProfileReact?UserProfileReact.switch(e):ze.a.render(nt.a.createElement(UserProfile,{key:e,id:e}),document.getElementById("ui-hatch")),t(this)},Popup.prototype.close=o,Picture.prototype.close=o,UserView.prototype.exit_click=function(t){t.target instanceof HTMLElement&&(t.target.matches(".user-profile-micro, .user-profile-micro *")||this.close())},UserProfile.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/profile_json?id="+this.props.id,dataType:"json",success:t=>this.setState({data:t}),error:()=>this.close()})},UserProfile.prototype.componentDidMount=function(){$.ajax({type:"GET",url:"/profile_json?id="+this.props.id,dataType:"json",success:t=>this.setState({data:t}),error:()=>this.close()})};const r=t=>/posted on your profile.*/g.test(t),i=t=>/liked your comment.*/g.test(t);NotificationUnit.prototype.action=function(t){var e,n,o,s,a;const{target:c}=t;if(!(c instanceof Node))return;const l=c instanceof Element?c:c.parentElement;if(!l)return;if(l.matches(".notification-button, .notification-button *"))return;const u=this.props.data;let d=null!==(e=u.data.sender)&&void 0!==e?e:u.data.user;const{content:f}=u.data;if((r(f)||i(f))&&(d=u.data.user),!("unit"in u.data)||"friend_request"===u.tier)return void(d?UserViewGenerator.generate({event:t,user:d}):console.error("Could not get notification user for UserView."));"unit"in u.data&&(App.params=u.data.unit);let m=null!==(a=null!==(o=null===(n=u.data.unit)||void 0===n?void 0:n.post.author_id)&&void 0!==o?o:null===(s=u.data.unit)||void 0===s?void 0:s.comment.author_id)&&void 0!==a?a:u.data.sender.id;(r(f)||i(f))&&(m=u.data.user.id),UserProfileReact&&UserProfileReact.load(m);const h=nt.a.createElement(UserProfile,{id:m});ze.a.render(h,document.getElementById("ui-hatch"))}}(),App.karma.data[0].range[1]=-1/0,App.temp.check=()=>{},Flair.prototype.render=function(){const{data:{flair:t,string:e},onClick:n}=this.props;return nt.a.createElement("span",{className:"user-flair",style:null!=t?t:{color:""},onClick:n},e)},UserProfile.prototype.render=function(){const t=this.state.data?[this.top(),this.bottom()]:[nt.a.createElement(Pr)];return nt.a.createElement("div",{className:"ui-menu-container"},nt.a.createElement("div",{onMouseDown:this.close.bind(this),className:"animated fadeIn ui-bg"}),nt.a.createElement("div",{className:"animated zoomIn user-profile-menu"},...t))},Ur()}const Sr=new me(Q.blockedHashes),Tr=new me(Q.savedPictures);const Or=function(t){const e={};return async n=>{const o="number"==typeof n?n.toString():n;return Object.prototype.hasOwnProperty.call(e,o)||(e[o]=await t(o)),e[o]}}(async t=>{const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")});async function Ir(){var t;document.querySelectorAll(".room-component-message-picture-container").forEach(async t=>{if(tt.get(Q.imgControl)&&!t.querySelector(".picture-control")){const e=it("div",{className:"picture-control"});e.append(it("div",{className:"picture-button block material-icons",textContent:"delete_forever",title:"Block this image",onmousedown:t=>{var e,n;if(!(t.target instanceof HTMLElement))return;const o=null===(n=null===(e=t.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.firstChild;!async function(t){if(!t)return;const e=await Or(t);Sr.add(e),Ir()}(null==o?void 0:o.src)}})),e.append(it("div",{className:"picture-button save material-icons",textContent:"bookmark_border",title:"Bookmark this image",onmousedown:t=>{var e,n;if(!(t.target instanceof HTMLElement))return;const o=null===(n=null===(e=t.target.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.firstChild;!function(t){t&&Tr.add(t)}(null==o?void 0:o.src)}})),t.append(e)}if(!(t.firstChild instanceof HTMLImageElement))return;const{src:e}=t.firstChild,n=await Or(e);Sr.hasItem(n)&&(t.firstChild.src="")});const e=document.querySelector("form#picture_upload");if(!e)return;const n=e.parentElement,o=n.querySelector(".ui-menu-text");"B"===(null===(t=null==o?void 0:o.firstElementChild)||void 0===t?void 0:t.tagName)?o.style.display="none":o&&(o.style.display="");if(n.querySelector(".image-grid"))return;const r=n.querySelector(".ui-menu-buttons"),i=it("div",{className:"image-grid"});Tr.values().forEach(t=>{const e=it("div",{style:`background-image: url(${encodeURI(t)}), url(${encodeURI("https://emeraldchat.com/avicons_strict/1.png")})`,onmousedown:()=>{!function(t){const e=(new Date).toISOString(),n={author_id:App.user.id,created_at:e,description:null,id:955e4+~~(1e6*Math.random()),image:{thumb:{url:t},url:t},image_processing:!1,image_tmp:null,micropost_id:null,picture_album_id:null,temporary:!1,title:null,updated_at:e,url:t};PictureUploader.onUploaded(n)}(t),MenuReactMicro.close()}});e.append(it("div",{className:"picture-button material-icons",textContent:"bookmark_remove",title:"Unbookmark this image",onmousedown:n=>{n.stopPropagation(),confirm("Are you sure you want to unbookmark this image?")&&(Tr.remove(t),e.remove())}})),i.append(e)}),n.insertBefore(i,r)}function jr(){return`${a} ${l}`}const Br={};function Lr(t,e){Br[t]||(Br[t]=[]),Br[t].push(e)}function zr(t,e){Br[t]||(Br[t]=[]);const n=Br[t].indexOf(e);n>-1&&Br[t].splice(n,1)}function Dr(t,e){Br[t]||(Br[t]=[]);let n=!1;const o=Object.assign(Object.assign({},e),{type:t,preventDefault(){n=!0}});return Br[t].forEach(t=>t(o)),n}function Fr(){const t={version:jr,addEventListener:Lr,removeEventListener:zr,dispatchEvent:Dr};ct(App.room,"join",t=>{Dr("room.join",{room:t}),ct(App.room.client,"received",t=>{var e;Dr("room.received",t),t.user&&t.user_disconnected&&Dr("user.left",t),t.user&&t.user_connected&&Dr("user.joined",t),t.messages&&t.messages.length&&Dr("user.message",t),(e=t).typing?null===RoomClient||void 0===RoomClient||RoomClient.start_typing(e.user):null===RoomClient||void 0===RoomClient||RoomClient.stop_typing()})}),ct(App.room,"leave",t=>{Dr("room.leave",{room:t})}),k.RxE=t}function Gr(){var t;const e=document.evaluate("//li[text()='Emerald Gold']",document).iterateNext();tt.get(Q.adBlocker)&&e instanceof HTMLElement?e.remove():e&&(null===(t=null==e?void 0:e.parentElement)||void 0===t?void 0:t.firstChild)===e&&e.parentElement.append(e)}function Kr(t){const{id:e,value:n,onChange:o,children:r}=t;return nt.a.createElement("div",null,nt.a.createElement("input",{type:"checkbox",id:e,checked:n,onChange:o}),nt.a.createElement("label",{htmlFor:e},e in Z?Z[e].label:null!=r?r:null))}function Vr(t){const{id:e,value:n,onChange:o,inline:r}=t,i=Z[e];if(!(i instanceof L))throw new Error("RadioSetting can only be used with MultichoicePreference");return nt.a.createElement("div",{className:"ritsu-radio-setting-root"},nt.a.createElement("label",{htmlFor:e,className:"m1 "+$r.settingsSection},i.label),nt.a.createElement("div",{id:e,style:{display:"flex",flexDirection:r?"row":"column"}},i.options.map(({value:t,label:r})=>nt.a.createElement("div",{className:"ritsu-radio-setting-option"},nt.a.createElement("input",{type:"radio",id:`${e}-option-${t}`,name:e,value:t,checked:n===t,onChange:()=>o(t)}),nt.a.createElement("label",{htmlFor:`${e}-option-${t}`},r)))))}function Hr(t){const{id:e,value:n,onChange:o,placeholder:r,children:i}=t;return nt.a.createElement("div",null,nt.a.createElement("input",{id:e,value:n,placeholder:r,onChange:o}),nt.a.createElement("label",{htmlFor:e},e in Z?Z[e].label:null!=i?i:null))}function qr(t){const e=new Set(t.map(t=>t[0])),n=new Set(tt.get(Q.permaMuteList).map(t=>t[0])),{added:o,removed:r}=function(t,e){const n=new Set,o=new Set;return Array.from(t.values()).forEach(t=>{e.has(t)||n.add(t)}),Array.from(e.values()).forEach(e=>{t.has(e)||o.add(e)}),{added:n,removed:o}}(n,e);o.forEach(t=>App.room.mute(t)),r.forEach(t=>App.room.unmute(t))}class Jr extends nt.a.Component{constructor(t){super(t),this.state={items:Array.from(t.value)}}handleItemRemoval(t){const{onChange:e,removeItem:n}=this.props,o=n(t,this.items());this.setState({items:o}),e(o)}items(){const{items:t}=this.state;return Array.from(t)}itemJSX(t){const{renderItem:e}=this.props;return nt.a.createElement("div",null,nt.a.createElement("span",Object.assign({className:"ui-button-text",style:{margin:"0 0.5em 0 0",padding:"0 0.5em",borderRadius:"0.25em",backgroundColor:"#e00000"}},Jt(()=>this.handleItemRemoval(t),{allowSpace:!0}),{role:"button",tabIndex:0}),"Ã—"),nt.a.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},e(t)))}render(){const{id:t,children:e}=this.props,{items:n}=this.state;if(!(Z[t]instanceof B))throw new Error("ListSetting can only be used with ListPreference");return nt.a.createElement("div",null,nt.a.createElement("div",{id:t,style:{display:"block"}},0===n.length?e:n.map(this.itemJSX.bind(this))))}}function Wr(t,e){const{[t]:n}=e,o="applySettings"in e?e.applySettings:e.applyHacks;return nt.a.createElement(Kr,{id:t,value:n,onChange:()=>o({[t]:!n})})}function Xr(t,e){return nt.a.createElement("div",{className:"m1 "+t},e)}function Yr(t){const e=nt.a.createElement(UserProfile,{id:t});ze.a.render(e,document.getElementById("ui-hatch"))}const Qr={g:"Global",i:"Case insensitive",m:"Multiline",u:"Unicode"};function Zr(t){var e,n;const{id:o,value:r,onChange:i,flagsAllowed:s,children:a}=t;let c=null!==(e=null==r?void 0:r.source)&&void 0!==e?e:"",l=null!==(n=null==r?void 0:r.flags)&&void 0!==n?n:"";const u=(t,e)=>{if(null!=t&&(c=t),null!=e&&(l=e.join("")),""!==c)try{i(new RegExp(c,l))}catch(t){i({source:c,flags:l})}else i({source:c,flags:l})};return nt.a.createElement("div",null,nt.a.createElement(Hr,{id:o+"-text",value:c,placeholder:"Regular expression",onChange:({currentTarget:t})=>u(t.value)},o in Z?Z[o].label:a),s.split("").map(t=>Object.prototype.hasOwnProperty.call(Qr,t)?nt.a.createElement(Kr,{id:`${o}-flag-${t}`,value:l.includes(t),onChange:({currentTarget:e})=>{const n=(o=t,l.split("").filter(t=>t!==o));var o;const r=[...n,t];u(null,e.checked?r:n)}},Qr[t]):null))}function ti(t){var e;const{muteRegexes:n,applySettings:o}=t;return nt.a.createElement("div",{className:$r.settings},Xr($r.settingsSection,W.generalTitle),Wr("adBlocker",t),Wr("trackKarma",t),Wr("fancyColors",t),function(t,e){const{applySettings:n,[t]:o}=e;return nt.a.createElement(Vr,{id:t,value:o,onChange:e=>n({[t]:e}),inline:!1})}("blockReqs",t),Xr($r.settingsSection,W.imagesTitle),Wr("imgBlur",t),Wr("imgProtect",t),Wr("hidePfp",t),Wr("showAnimatedImages",t),Wr("imgControl",t),Wr("hideImageFallback",t),Xr($r.settingsSection,W.messageTitle),Wr("antiSpam",t),Wr("showGender",t),Wr("showInfo",t),Wr("highlightMentions",t),Wr("bigEmoji",t),Wr("toggleEmbeds",t),Wr("largerText",t),Xr($r.settingsSection,W.advancedTitle),Wr("ignoreURLBlacklist",t),function(t,e,n){const{applySettings:o,[t]:r}=e;return nt.a.createElement(Hr,{id:t,value:r,onChange:e=>o({[t]:e.target.value}),placeholder:n})}("imgurAPIKey",t,W.preferences.imgurAPIKey.placeholder),nt.a.createElement(Zr,{id:"muteRegexes",value:null!==(e=n[0])&&void 0!==e?e:{source:"",flags:""},onChange:({source:t,flags:e})=>o({muteRegexes:[{source:t,flags:e}]}),flagsAllowed:"i"}),function(t){const{applySettings:e,permaMuteList:n}=t;return nt.a.createElement(Jr,{id:"permaMuteList",value:n,removeItem:([t],e)=>e.filter(e=>e[0]!==t),renderItem:([t,e])=>[nt.a.createElement("span",{className:"ritsu-permamutelist-user-name"},e),nt.a.createElement("span",{className:"material-icons permamute-list",onClick:()=>Yr(t),onKeyDown:()=>Yr(t),role:"button",tabIndex:0},"account_circle")],onChange:t=>{qr(t),e({permaMuteList:t}),null===NotificationsReact||void 0===NotificationsReact||NotificationsReact.update()}},"No mutes active")}(t))}var ei=n(16),ni=n.n(ei),oi=n(6),ri=n.n(oi),ii=n(17),si=n.n(ii),ai=n(18),ci=n.n(ai);const li=["default","ritsu","light"];function ui(){const t=tt.get(Q.theme);let e=document.head.querySelector(".custom-theme");e||(document.head.append(it("style",{className:"custom-theme",type:"text/css"})),e=document.head.querySelector(".custom-theme"));const n=[ni.a];switch(t){case"default":default:break;case"ritsu":n.push(ri.a,si.a);break;case"light":n.push(ri.a,ci.a)}e.textContent=n.join("\n")}function di(t){const{theme:e,applyTheme:n}=t;return nt.a.createElement("div",null,nt.a.createElement("div",{className:"m1 "+$r.settingsSection},W.themeTitle),li.map(t=>nt.a.createElement("div",null,nt.a.createElement("input",{type:"radio",id:t,name:"theme",value:t,checked:e===t,onChange:()=>n(t)}),nt.a.createElement("label",{htmlFor:t},t[0].toUpperCase()+t.slice(1)))))}class fi extends nt.a.Component{constructor(){super({}),this.applySettings=t=>{const{settings:e}=this.state,n=Object.assign(Object.assign({},e),t);Object.keys(t).forEach(e=>tt.set(Q[e],t[e])),gi(),this.setState({settings:n,needsReload:!0})},this.applyTheme=t=>{tt.set(Q.theme,t),document.body.classList.add("themeChange"),ui(),this.setState({theme:t}),setTimeout(()=>document.body.classList.remove("themeChange"),1e3)},this.v=t=>{},this.state=Object.assign(Object.assign({},pi()),{needsReload:!1})}render(){const{theme:t,settings:e,R:n,needsReload:o}=this.state;return nt.a.createElement("div",null,nt.a.createElement(di,{theme:t,applyTheme:this.applyTheme}),nt.a.createElement(ti,Object.assign({},e,{applySettings:this.applySettings})),!1,o&&nt.a.createElement("div",{className:$r.reloadWarning},"You may need to reload the app for your changes to take effect."))}}function mi(){return nt.a.createElement(Menu,null,nt.a.createElement("div",{key:"custom_menu",className:$r.ritsuMenuContainer},"Ritsu Settings",nt.a.createElement("br",null),nt.a.createElement("br",null),nt.a.createElement(fi,null),nt.a.createElement("div",{className:"ui-menu-buttons"},nt.a.createElement("div",{role:"button",tabIndex:0,className:"ui-button-text",onMouseDown:()=>MenuReact.close()},"Close"))))}function hi(t){return Gt(function(t,e){const n=Object.getOwnPropertyNames(t).filter(n=>t[n]instanceof e).map(e=>[e,t[e]]);return Object.fromEntries(n)}(t,j),(t,e)=>tt.get(e))}function pi(){return Object.assign(Object.assign({theme:tt.get(Q.theme)},!1),{settings:Object.assign(Object.assign({},hi(Q)),{muteRegexes:tt.get(Q.muteRegexes),imgurAPIKey:tt.get(Q.imgurAPIKey),blockReqs:tt.get(Q.blockReqs),permaMuteList:tt.get(Q.permaMuteList)})})}function gi(){const t=pi().settings;Object.keys(t).forEach(e=>{"boolean"==typeof t[e]&&document.documentElement.classList.toggle(e,t[e])}),ui()}function vi(){ze.a.render(nt.a.createElement(mi,null),document.getElementById("ui-hatch"))}function bi(){const t=document.querySelector(".navigation-dropdown-ritsu"),e=document.querySelector(".navigation-dropdown-content");!t&&e&&e.prepend(it("li",{className:"navigation-dropdown-ritsu",textContent:"Ritsu Menu",onmousedown:vi}))}var wi=n(19),yi=n.n(wi);const Ri=nt.a.createElement("button",{className:"material-icons navigation-notification-unit lookup-button",onClick:function(){if("undefined"==typeof UserViewReact&&(UserViewGenerator.generate({event:{preventDefault:()=>{},clientX:100,clientY:100},user:{karma:100,id:2}}),UserViewReact.close(),"undefined"==typeof UserViewReact))return;const t=prompt("Enter a user id",""+UserViewReact.state.user.id);if(null===t)return;const e=parseInt(t,10);Number.isNaN(e)||(UserViewReact.state.user.id=e,UserViewReact.view_profile())},type:"button"},"face"),Ai=nt.a.createElement("div",{className:"navigation-dropdown-content"},nt.a.createElement("div",null,W.preferences.userSort.label),["name.asc","name.desc","age.asc","age.desc"].map(t=>nt.a.createElement("li",{className:tt.get(Q.userSort)===t?"selected":"",onClick:()=>function(t){tt.set(Q.userSort,t),RoomChannelMembersClient instanceof RoomChannelMembers&&RoomChannelMembersClient.setState(RoomChannelMembersClient.state)}(t)},W.preferences.userSort[t]))),ki=nt.a.createElement("div",{className:"navigation-dropdown sort-button"},nt.a.createElement("span",{className:"material-icons navigation-notification-unit"},"arrow_drop_down"),Ai);let xi;function Ci(t,e){var n;"setState"in RoomChannelMembersClient&&(null===RoomClient||void 0===RoomClient||RoomClient.setState({messages:[],current_channel:t}),RoomChannelMembersClient.setState({members:[]}),App.room.join(t),document.querySelectorAll(".channel-unit").forEach(t=>t.classList.remove("channel-unit-active")),null===(n=document.querySelector(e))||void 0===n||n.classList.add("channel-unit-active"),null===RoomClient||void 0===RoomClient||RoomClient.print(nt.a.createElement("div",null,W.privateRoomsWarning)),xi=t)}function Ei(){document.querySelector(".wfaf.channel-unit-active")||Ci("",".wfaf")}function Mi(){const t=prompt(W.privateRoomsPrompt);null!=t&&Ci(t,".private-rooms")}function Ni(t){const{type:e}=t||{},{action:n}=t||{},{text:o}=t||{};return nt.a.createElement("div",{className:"channel-unit "+e,onClick:()=>n(),onKeyPress:()=>n(),role:"button",tabIndex:0},o)}function $i(){RoomChannelSelect.prototype.body=function(){const{text_channels:t}=this.state;return nt.a.createElement("div",{className:"room-component-module"},nt.a.createElement("div",{className:"room-user-label"},"text channels"),t.map(t=>this.channel_button(t)),nt.a.createElement("div",{className:"room-user-label"},W.hiddenChannels),nt.a.createElement(Ni,{type:"wfaf",action:Ei,text:W.WFAF}),nt.a.createElement(Ni,{type:"private-rooms",action:Mi,text:W.privateRooms}))},function(){const t=ActionCable.Subscriptions.prototype.reject;ActionCable.Subscriptions.prototype.reject=function(e){e===App.room.client.identifier&&App.room.id===xi&&mt("ERROR: You could not join room "+(xi||"WFAF")),t.call(this,e)}}()}function Pi(){function t(t){null===RoomClient||void 0===RoomClient||RoomClient.trim_messages();const e=null===RoomClient||void 0===RoomClient?void 0:RoomClient.state.messages;e&&(t.forEach(t=>{0===e.length&&e.unshift(t);const n=e[0],o=Zt(n.user)===Zt(t.user),r=n.picture||t.picture,i=n.messages.length>=16;if(!o||r||i)return void e.unshift(t);const s=t.messages[0];n.messages[0]===s||n.messages.unshift(t.messages[0])}),null===RoomClient||void 0===RoomClient||RoomClient.setState({messages:e}))}Room.prototype.load_messages=function(e){const n=(o=e)+20<=RoomClient.state.messages_count?-o-20:-RoomClient.state.messages_count;var o;$.ajax({type:"GET",url:`/room_load_more?loaded=${n}&id=${this.state.id}`,dataType:"json",success:e=>t.call(this,e.reverse())})},Room.prototype.switch=function(t){this.clear_print();const{id:e}=t;App.room.join(e),this.state.last_message=null,this.setState({id:e,messages:[],messages_count:0,typing:null,mode:t.mode||"default"}),"private"===t.mode&&$.ajax({type:"GET",url:"/default_private_messages?id="+e,dataType:"json",success:t=>{br.call(this,t.messages),this.setState({messages_count:t.messages_count}),this.scroll()}})}}var Ui=n(20),_i=n.n(Ui);const Si=t=>"Enter"===t.key&&!t.shiftKey;function Ti(t){if(!t.clipboardData)return;const{items:e}=t.clipboardData;Array.from(e).forEach(t=>{!async function(t){var e;if("file"!==t.kind)return;const n=t.getAsFile();if(!n||!confirm("Are you sure you want to upload this image in chat?"))return;const o=await Je(n);RoomClient&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,o))}(t)})}var Oi=n(21),Ii=n.n(Oi);const ji=lo;async function Bi(t,e,n){const o=await async function(t){for(let e=0;e<t.length;e+=1)try{return await t[e]()}catch(n){if(!(n instanceof Xt&&e!==t.length-1))throw n;console.log(`Item ${e} threw: `,n.message)}throw new Error("funcs cannot be empty")}([128,96,64,48].map(e=>()=>async function(t,e,n){if(!(e in fo))throw new Error(`Format '${e}' not implemented`);return fo[e].compress(t,n).then(t=>e+t)}(t,n,(t=>({interpolator:Mn.none,width:t,height:t}))(e))));console.log(`compressed: ${o.length} chars`),await ae(e,o)}async function Li(t,e,n){if(t)if(t.type.startsWith("image"))try{await Bi(t,e,n)}catch(t){t instanceof Error&&alert(t.message)}else alert("File is not an image or its format is not supported.");else alert("No file uploaded.")}const zi=(t,e)=>n=>{var o;const{currentTarget:r}=n,i=null===(o=r.files)||void 0===o?void 0:o[0];try{Li(i,t,e)}catch(t){alert("Image loading failed: "+t)}},Di=(t,e)=>()=>{const n=prompt("Paste URL:","");if(null===n)return;const o=mo(n,e);null!==o?ae(t,o):alert("Invalid URL")};function Fi(){const{user:t,current_user:e}=this.state.data,n=(t=>e=>{var n;e.preventDefault(),e.stopPropagation();const o=null===(n=e.dataTransfer.files)||void 0===n?void 0:n[0];try{Li(o,t,ji)}catch(t){alert("Image loading failed: "+t)}})(t),{display_picture:o}=t;if(t.id!==e.id)return nt.a.createElement("img",Object.assign({className:"user-profile-avatar",alt:"User avatar",src:o},Jt((t=>()=>{ze.a.render(nt.a.createElement(Picture,{data:{src:t.display_picture}}),document.getElementById("ui-hatch-2"))})(t))));return nt.a.createElement("span",{onDrop:n},nt.a.createElement("img",{alt:"User avatar",className:"user-profile-avatar",src:o,onDrop:n}),nt.a.createElement("input",{id:"ritsu-profile-picture-upload",type:"file",onChange:zi(t,uo),onDrop:n}),nt.a.createElement("label",{className:"user-profile-picture-hover",htmlFor:"ritsu-profile-picture-upload",onDrop:n},null,nt.a.createElement("span",{className:"material-icons",style:{fontSize:"36px"},title:"Upload a profile picture"},"cloud_upload")),nt.a.createElement("input",{id:"ritsu-profile-picture-use-existing",style:{fontSize:"12px"},className:"btn",title:"Upload using imgur",onDrop:n,type:"button",value:"Add from Imgur",onClick:Di(t,uo)}))}function Gi(t){const e=tt.get(Q.blockReqs);t.friend_requests=t.friend_requests.filter(t=>{const n=new Date(t.data.sender.created_at),o=e!==Y.None&&jt(n)<864e5,r=App?App.room.muted.includes(t.sender_id):t.seen;return!o&&!r||(e!==Y.Reject||$.ajax({type:"GET",url:`/friends_decline?friend_id=${t.sender_id}&notification_id=${t.id}`,dataType:"json"}),!1)})}function Ki(){return $.ajax({type:"GET",url:"/notifications_json",dataType:"json",success:function(t){Gi(t),NotificationsReact.setState({data:t})}}),"updated"}const Vi=t=>t?nt.a.createElement(Flair,{data:{string:t,flair:App.user.flair}}):null;function Hi(){const t=Message.prototype.process;Message.prototype.process=function(e){const n=t.bind(this),o=e.includes("youtu.be")||e.includes("youtube.com"),r=App.user.display_name.replace(/[^\w\s]/g,"").trim();if(!r||o||!tt.get(Q.highlightMentions))return n(e);return Dt(e,r,Vi,t=>Dt(t,App.user.display_name,Vi,n))}}const qi=t=>t.split(""),Ji=t=>ut(t,2),Wi={none:qi("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"),italic:Ji("ð˜¢ð˜£ð˜¤ð˜¥ð˜¦ð˜§ð˜¨ð˜©ð˜ªð˜«ð˜¬ð˜­ð˜®ð˜¯ð˜°ð˜±ð˜²ð˜³ð˜´ð˜µð˜¶ð˜·ð˜¸ð˜¹ð˜ºð˜»ð˜ˆð˜‰ð˜Šð˜‹ð˜Œð˜ð˜Žð˜ð˜ð˜‘ð˜’ð˜“ð˜”ð˜•ð˜–ð˜—ð˜˜ð˜™ð˜šð˜›ð˜œð˜ð˜žð˜Ÿð˜ ð˜¡"),bold:Ji("ð—®ð—¯ð—°ð—±ð—²ð—³ð—´ð—µð—¶ð—·ð—¸ð—¹ð—ºð—»ð—¼ð—½ð—¾ð—¿ð˜€ð˜ð˜‚ð˜ƒð˜„ð˜…ð˜†ð˜‡ð—”ð—•ð—–ð——ð—˜ð—™ð—šð—›ð—œð—ð—žð—Ÿð— ð—¡ð—¢ð—£ð—¤ð—¥ð—¦ð—§ð—¨ð—©ð—ªð—«ð—¬ð—­ðŸ¬ðŸ­ðŸ®ðŸ¯ðŸ°ðŸ±ðŸ²ðŸ³ðŸ´ðŸµ"),boldItalic:Ji("ð™–ð™—ð™˜ð™™ð™šð™›ð™œð™ð™žð™Ÿð™ ð™¡ð™¢ð™£ð™¤ð™¥ð™¦ð™§ð™¨ð™©ð™ªð™«ð™¬ð™­ð™®ð™¯ð˜¼ð˜½ð˜¾ð˜¿ð™€ð™ð™‚ð™ƒð™„ð™…ð™†ð™‡ð™ˆð™‰ð™Šð™‹ð™Œð™ð™Žð™ð™ð™‘ð™’ð™“ð™”ð™•"),underline:Ji("aÍŸbÍŸcÍŸdÍŸeÍŸfÍŸgÍŸhÍŸiÍŸjÍŸkÍŸlÍŸmÍŸnÍŸoÍŸpÍŸqÍŸrÍŸsÍŸtÍŸuÍŸvÍŸwÍŸxÍŸyÍŸzÍŸAÍŸBÍŸCÍŸDÍŸEÍŸFÍŸGÍŸHÍŸIÍŸJÍŸKÍŸLÍŸMÍŸNÍŸOÍŸPÍŸQÍŸRÍŸSÍŸTÍŸUÍŸVÍŸWÍŸXÍŸYÍŸZÍŸ0ÍŸ1ÍŸ2ÍŸ3ÍŸ4ÍŸ5ÍŸ6ÍŸ7ÍŸ8ÍŸ9ÍŸ"),squared:Ji("ðŸ„°ðŸ„±ðŸ„²ðŸ„³ðŸ„´ðŸ„µðŸ„¶ðŸ„·ðŸ„¸ðŸ„¹ðŸ„ºðŸ„»ðŸ„¼ðŸ„½ðŸ„¾ðŸ„¿ðŸ…€ðŸ…ðŸ…‚ðŸ…ƒðŸ…„ðŸ……ðŸ…†ðŸ…‡ðŸ…ˆðŸ…‰ðŸ„°ðŸ„±ðŸ„²ðŸ„³ðŸ„´ðŸ„µðŸ„¶ðŸ„·ðŸ„¸ðŸ„¹ðŸ„ºðŸ„»ðŸ„¼ðŸ„½ðŸ„¾ðŸ„¿ðŸ…€ðŸ…ðŸ…‚ðŸ…ƒðŸ…„ðŸ……ðŸ…†ðŸ…‡ðŸ…ˆðŸ…‰"),squaredFull:Ji("ðŸ…°ðŸ…±ðŸ…²ðŸ…³ðŸ…´ðŸ…µðŸ…¶ðŸ…·ðŸ…¸ðŸ…¹ðŸ…ºðŸ…»ðŸ…¼ðŸ…½ðŸ…¾ðŸ…¿ðŸ†€ðŸ†ðŸ†‚ðŸ†ƒðŸ†„ðŸ†…ðŸ††ðŸ†‡ðŸ†ˆðŸ†‰ðŸ…°ðŸ…±ðŸ…²ðŸ…³ðŸ…´ðŸ…µðŸ…¶ðŸ…·ðŸ…¸ðŸ…¹ðŸ…ºðŸ…»ðŸ…¼ðŸ…½ðŸ…¾ðŸ…¿ðŸ†€ðŸ†ðŸ†‚ðŸ†ƒðŸ†„ðŸ†…ðŸ††ðŸ†‡ðŸ†ˆðŸ†‰"),circled:qi("â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“žâ“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“Žâ“â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨"),superscript:qi("áµƒáµ‡á¶œáµˆáµ‰á¶ áµÊ°á¶¦Ê²áµË¡áµâ¿áµ’áµ–áµ Ê³Ë¢áµ—áµ˜áµ›Ê·Ë£Ê¸á¶»á´¬á´®á¶œá´°á´±á¶ á´³á´´á´µá´¶á´·á´¸á´¹á´ºá´¼á´¾áµ á´¿Ë¢áµ€áµâ±½áµ‚Ë£Ê¸á¶»â°Â¹Â²Â³â´âµâ¶â·â¸â¹"),medieval:Ji("ð–†ð–‡ð–ˆð–‰ð–Šð–‹ð–Œð–ð–Žð–ð–ð–‘ð–’ð–“ð–”ð–•ð––ð–—ð–˜ð–™ð–šð–›ð–œð–ð–žð–Ÿð•¬ð•­ð•®ð•¯ð•°ð•±ð•²ð•³ð•´ð•µð•¶ð•·ð•¸ð•¹ð•ºð•»ð•¼ð•½ð•¾ð•¿ð–€ð–ð–‚ð–ƒð–„ð–…"),cursive:Ji("ð’¶ð’·ð’¸ð’¹ð‘’ð’»ð‘”ð’½ð’¾ð’¿ð“€ð“ð“‚ð“ƒð‘œð“…ð“†ð“‡ð“ˆð“‰ð“Šð“‹ð“Œð“ð“Žð“ð’œðµð’žð’Ÿð¸ð¹ð’¢ð»ð¼ð’¥ð’¦ð¿ð‘€ð’©ð’ªð’«ð’¬ð‘…ð’®ð’¯ð’°ð’±ð’²ð’³ð’´ð’µ"),cursiveBold:Ji("ð“ªð“«ð“¬ð“­ð“®ð“¯ð“°ð“±ð“²ð“³ð“´ð“µð“¶ð“·ð“¸ð“¹ð“ºð“»ð“¼ð“½ð“¾ð“¿ð”€ð”ð”‚ð”ƒð“ð“‘ð“’ð““ð“”ð“•ð“–ð“—ð“˜ð“™ð“šð“›ð“œð“ð“žð“Ÿð“ ð“¡ð“¢ð“£ð“¤ð“¥ð“¦ð“§ð“¨ð“©"),monospace:qi("ï½ï½‚ï½ƒï½„ï½…ï½†ï½‡ï½ˆï½‰ï½Šï½‹ï½Œï½ï½Žï½ï½ï½‘ï½’ï½“ï½”ï½•ï½–ï½—ï½˜ï½™ï½šï¼¡ï¼¢ï¼£ï¼¤ï¼¥ï¼¦ï¼§ï¼¨ï¼©ï¼ªï¼«ï¼¬ï¼­ï¼®ï¼¯ï¼°ï¼±ï¼²ï¼³ï¼´ï¼µï¼¶ï¼·ï¼¸ï¼¹ï¼ºï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™"),smallcaps:qi("á´€Ê™á´„á´…á´‡êœ°É¢ÊœÉªá´Šá´‹ÊŸá´É´á´á´˜QÊ€êœ±á´›á´œá´ á´¡xÊá´¢á´€Ê™á´„á´…á´‡êœ°É¢ÊœÉªá´Šá´‹ÊŸá´É´á´á´˜QÊ€êœ±á´›á´œá´ á´¡xÊá´¢"),hooked:qi("Î±á‚¦ÆˆÔƒÒ½ÏÉ Ô‹Î¹ÊÆ™Ê…É±É³ÏƒÏÏ™É¾Ê‚ÆšÏ…Ê‹É¯xáƒ§È¥"),boldSerif:Ji("ðšð›ðœððžðŸð ð¡ð¢ð£ð¤ð¥ð¦ð§ð¨ð©ðªð«ð¬ð­ð®ð¯ð°ð±ð²ð³ð€ðð‚ðƒð„ð…ð†ð‡ðˆð‰ðŠð‹ðŒððŽððð‘ð’ð“ð”ð•ð–ð—ð˜ð™ðŸŽðŸðŸðŸ‘ðŸ’ðŸ“ðŸ”ðŸ•ðŸ–ðŸ—")};function Xi(t,e){return e.split("").map(e=>{var n;const o=Wi.none.indexOf(e);return null!==(n=Wi[t][o])&&void 0!==n?n:e}).join("")}const Yi=t=>t;function Qi(t){const e=t.toLocaleLowerCase();return nt.a.createElement("span",Object.assign({},{className:"material-icons",title:e}),t.slice(2,-1))}function Zi({length:t}){return t>1?[nt.a.createElement("br",null),nt.a.createElement("br",null)]:nt.a.createElement("br",null)}function ts(t){return t.startsWith("[[")&&t.endsWith("]]")?Xi("squaredFull",t.slice(2,-2)):t.startsWith("((")&&t.endsWith("))")?Xi("circled",t.slice(2,-2)):t.startsWith("{{")&&t.endsWith("}}")?Xi("medieval",t.slice(2,-2)):t.endsWith("))")||t.endsWith("]]")||t.endsWith("}}")?t:t.startsWith("***")?Xi("boldItalic",t.slice(3,-3)):t.startsWith("**")?Xi("bold",t.slice(2,-2)):t.startsWith("*")?Xi("italic",t.slice(1,-1)):t.startsWith("__")?Xi("underline",t.slice(2,-2)):t.startsWith("_")?Xi("italic",t.slice(2,-2)):t.startsWith("`")?Xi("monospace",t.slice(1,-1)):t.startsWith("^^")?Xi("superscript",t.slice(2,-2)):t.startsWith(",,")?Xi("hooked",t.slice(2,-2)):t}function es(t,e=Yi){return function(t,e=Yi){return zt(t.replace(/^[\s\n]+|[\s\n]+$/g,""),/\n+/g,Zi,e)}(t,t=>function(t,e=Yi){return zt(t,/m:[-_a-z]+:/gi,Qi,e)}(t,t=>pr(t,e)))}const ns={shrug:"Â¯\\_(ãƒ„)_/Â¯",tableflip:"(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»",tableflip2:"(ãƒŽà² ç›Šà² )ãƒŽå½¡â”»â”â”»",unflip:"â”¬â”€â”€â”¬ ãƒŽ( ã‚œ-ã‚œãƒŽ)"},os={all:{rxelink:()=>RoomClient.send("Link to RxE extension for Emerald: "+De)},on:t=>({run:e=>(os.all[t]=e,os)}),prefix:".",process(t){if(!t.startsWith(os.prefix))return!1;const e=t.slice(os.prefix.length).split(" "),n=os.findCommand(e[0]);return null==n||n(...e.slice(1)),!!n},findCommand(t){const e=Object.getOwnPropertyNames(os.all).find(e=>e===t);return e?os.all[e]:void 0},checkMail:t=>/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/gi.test(t),processMail:t=>t.replace(/\./gi,".â€‹")};function rs(){var t;t=ns,Object.entries(t).forEach(([t,e])=>os.on(t).run(()=>RoomClient.send(e))),Room.prototype.send=function(t){const e=this.process?this.process(t):t;null!==e&&(this.append({messages:[e],user:App.user}),App.room.client.speak({message:e}),this.scroll())},Room.prototype.process=function(t){return os.process(t)?null:os.checkMail(t)?os.processMail(t):ge(function(t,e=Yi){return zt(t,/(?<=\s|^|\.,;!\?)(\*{1,3}|_{1,2}|~~|`|\^\^|,,|\[{2}|\({2}|\{{2})\S(?:.*?\S)?(?:\1|\]{2}|\){2}|\}{2})(?=\s|$|\.,;!\?)/g,ts,e).join("")}(t))}}function is({raw:t,onRemove:e}){const n=e&&(()=>{confirm("Are you sure you want to remove your profile picture?")&&e()});return nt.a.createElement("div",{title:t,className:"bio-image"},"Profile picture (",function(t){switch(t){case lo:return"format0";case uo:return"imgur";default:return"unknown"}}(t[0]),", ",t.length," chars)",!!n&&[" ",nt.a.createElement("b",Object.assign({},Jt(n)),"Ã—")])}function ss(t,e,n){const o=t.split(/ +/g);if(o.length>36&&e){const t=o.slice(0,36).join(" ");return nt.a.createElement("span",null,es(t)," ...",nt.a.createElement("span",Object.assign({className:"user-micropost-text-button"},Jt(n))," More"))}return es(t,Micropost.prototype.youtube_process)}var as=n(22),cs=n.n(as);function ls(){at(cs.a);const t=Message.prototype.process;Message.prototype.process=function(e){const n=t.bind(this);return e.includes("youtu.be")||e.includes("youtube.com")?n(e):function(t,e=Yi){if(Re().test(t))return zt(t,Re(),t=>Ve({url:"https://"+t}),()=>"");const n=qe(t);return null!==n?Ve(n):e(t)}(ve(e),t=>es(t,n))},UserProfile.prototype.bio=function(){const{compact_bio:t,data:{user:e}}=this.state,n=t&&e.bio.length>202,o=re(e.bio),r=ie(e.bio),i=o&&nt.a.createElement(is,{raw:o,onRemove:e.id===App.user.id?()=>se(e,r):null}),s=r.slice(0,202)+"... ",a=n?s:r;return nt.a.createElement("span",null,es(a),n&&nt.a.createElement("span",{role:"button",tabIndex:0,onMouseDown:()=>this.bio_expand(),className:"bio-expand"},"Show More"),!n&&i)},Micropost.prototype.content=function(){const{data:t,compact:e}=this.state;if(!t)return null;const{content:n}=t.micropost;return nt.a.createElement("div",{style:{width:"100%"}},ss(n,e,()=>this.more()))},Comment.prototype.content=function(){const{comment_data:t,compact:e}=this.state;if(!t)return null;const{content:n}=t.comment;return nt.a.createElement("div",{style:{width:"100%"}},ss(n,e,()=>this.more()))}}const us=[[Room,"Room"],[UserProfile,"UserProfile"],[FriendUnit,"FriendUnit"],[Micropost,"Micropost"],[MessageNotificationUnit,"MessageNotificationUnit"],[Message,"Message"],[RoomUserUnit,"RoomUserUnit"],[UserUnit,"UserUnit"],[UserView,"UserView"],[Dashboard,"Dashboard"]];var ds=n(23),fs=n.n(ds);function ms(t){const e=tt.get(Q.toggleEmbeds),n=document.querySelectorAll("."+t);e&&n&&n.forEach(t=>{const e=Array.from(t.children);e&&e.forEach(t=>{if(t.querySelectorAll(".embed").length)return;const e=ve(t.innerText);if(!rr(e)&&!ir(e))return;const n=document.createElement("div");n.classList.add("embed"),n.innerHTML="<br>"+cr(e),t.appendChild(n)})})}function hs(){at(fs.a),ms("user-comment-right"),ms("user-micropost-right"),ms("room-component-message-text")}!async function(){const t=`(${[]})`;o.log(`${a} Version ${l} ${t}`),async function(){Notifications.prototype.update=Ki,NotificationsReact&&(NotificationsReact.update=Ki,NotificationsReact.state&&NotificationsReact.state.data?Gi(NotificationsReact.state.data):console.warn("failed to filter friend requests early"))}(),await(async t=>{for(;!t();)await pt()})(()=>!!k.App),us.forEach(([t,e])=>{t.displayName=e}),_r(),function(){if("undefined"==typeof GM_getValue)return;const t=GM_getValue("theme",!1);t&&(tt.set(Q.theme,t),o.log("Migrated THEME"),GM_deleteValue("theme"));const e=GM_getValue("hacks",!1);e&&(tt.set(Q.adBlocker,!!e.disableNags),tt.set(Q.fancyColors,!!e.fancyColors),o.log("Migrated HACKS"),GM_deleteValue("hacks"));const n=GM_getValue("settings",!1);n&&(tt.set(Q.imgControl,!!n.imgControl),tt.set(Q.imgProtect,!!n.imgProtect),tt.set(Q.showInfo,!!n.showInfo),o.log("Migrated SETTINGS"),GM_deleteValue("settings"));const r=GM_getValue("blockedPictures",!1);if(r instanceof Array){const t=[...tt.get(Q.blockedHashes)];r.forEach(e=>{t.includes(e)||t.push(e)}),tt.set(Q.blockedHashes,t),o.log("Migrated BLOCKED PICTURES"),GM_deleteValue("blockedPictures")}const i=GM_getValue("savedPictures",!1);if(i instanceof Array){const t=[...tt.get(Q.savedPictures)];i.forEach(e=>{t.includes(e)||t.push(e)}),tt.set(Q.savedPictures,t),o.log("Migrated SAVED PICTURES"),GM_deleteValue("savedPictures")}}(),Fr(),at(ee.a),document.body.addEventListener("mouseup",({target:t})=>{t instanceof HTMLElement&&t.classList.contains("mute-button")&&Cookies.set("muted",MuteButtonClient.state.muted?"t":"")}),MuteButton.prototype.componentDidMount=function(){const t=Cookies.get("muted");this.setState({muted:"t"===t||void 0===t})},gi(),yr(),Sr.load(),Tr.load(),at(Po.a),at(Vo.a),vo(),Qo(),er(),at(qo.a),function(){const t=RoomChannelSelect.prototype.join;RoomChannelSelect.prototype.join=function(e){e.members&&(e.members=It(e.members)),t.call(this,e)};const e=RoomPrivate.prototype.setState;function n(){var t,e;null===(t=document.querySelector(".wfaf"))||void 0===t||t.classList.remove("channel-unit-active"),null===(e=document.querySelector(".private-rooms"))||void 0===e||e.classList.remove("channel-unit-active"),ct(App.room.client,"received",No,!0)}RoomPrivate.prototype.setState=function(t){return t&&"online"in t&&(t.online=It(t.online)),t&&"offline"in t&&(t.offline=It(t.offline)),e.call(this,t)},ct(App.room,"join",n),App.room.client&&n()}(),function(){const t=tt.get(Q.showGender);document.documentElement.classList.toggle("showGender",t),at(Lo.a);const e=MessageNotificationUnit.prototype.image;MessageNotificationUnit.prototype.image=function(){return zo.call(this,e)};const n=NotificationUnit.prototype.image;NotificationUnit.prototype.image=function(){return zo.call(this,n)};const o=SearchUnit.prototype.body;SearchUnit.prototype.body=function(){return zo.call(this,o)};const r=UserUnit.prototype.body;UserUnit.prototype.body=function(){return zo.call(this,r)};const i=FriendUnit.prototype.body;FriendUnit.prototype.body=function(){return zo.call(this,i)};const s=RoomUserUnit.prototype.body;RoomUserUnit.prototype.body=function(){return zo.call(this,s)};const a=Message.prototype.render;Message.prototype.render=function(){var t,e;const n=a.apply(this);return n&&"object"==typeof n&&"props"in n&&(n.props.children[0].props.children.props["data-gender"]=null!==(e=null===(t=Qt(this.props.data.user))||void 0===t?void 0:t.gender)&&void 0!==e?e:""),n}}(),kr(),Pi(),function(){RoomChannelMembers.prototype.body=function(){const{members:t}=this.state;if(!t)return null;if(t.length<1)return nt.a.createElement("div",{className:"room-component-module"},nt.a.createElement("div",{className:"room-user-label"},Ri));const e=It(t).map(t=>nt.a.createElement(UserUnit,{key:t.id,data:t}));return nt.a.createElement("div",{className:"room-component-module"},nt.a.createElement("div",{className:"room-user-label"},Ri,"online â€” "+t.length,ki),e)};const t=RoomChannelMembers.prototype.setState;RoomChannelMembers.prototype.setState=function(e){var n;if(!e||!("members"in e))return;this.state.members||console.warn("this.state.members is falsy despite declaration");const o=It(null!==(n=this.state.members)&&void 0!==n?n:[]).map(t=>t.id),r=It(e.members),[i,s]=tt.get(Q.userSort).split("."),a="asc"===s?"asc":"desc";"age"===i?kt(r,"id",bt(vt.numeric),a,!0):kt(r,"display_name",vt.string,a,!0),r.forEach(t=>{o.some(yt(t.id))||k.RxE.dispatchEvent("room.userlist",t)}),e.members=r,t.call(this,e)},Room.prototype.disconnected=function(t){"channel"===this.state.mode&&RoomChannelMembersClient.remove_member(t.user)},at(yi.a)}(),function(){function t(){NotificationsReact.update(),null===UserViewReact||void 0===UserViewReact||UserViewReact.forceUpdate(),null===RoomClient||void 0===RoomClient||RoomClient.forceUpdate()}App.room.muted.push(...tt.get(Q.permaMuteList).map(t=>t[0])),UserView.prototype.bottom=function(){const{id:t}=this.state.user,e=App.room.muted.includes(t),n=tt.get(Q.permaMuteList).map(t=>t[0]).includes(t);return nt.a.createElement("div",{className:"user-profile-micro-bottom"},nt.a.createElement("div",{onMouseDown:this.view_profile.bind(this),className:"user-profile-micro-button"},"View Profile"),nt.a.createElement("div",{onMouseDown:this.message.bind(this),className:"user-profile-micro-button"},"Message"),this.mod_button(),nt.a.createElement("div",{onMouseDown:e?this.unmute.bind(this):this.mute.bind(this),className:"user-profile-micro-button",disabled:n},e?"Unmute":"Mute"),nt.a.createElement("div",{onMouseDown:n?this.permaunmute.bind(this):this.permamute.bind(this),className:"user-profile-micro-button"},n?"Perma Unmute":"Perma Mute"),nt.a.createElement("div",{onMouseDown:this.close.bind(this),className:"user-profile-micro-button"},"Close"))},UserView.prototype.permamute=function(){const{id:e,display_name:n}=this.state.user;he.addItem({key:e,item:n},Q.permaMuteList),App.room.mute(e,n,"Permamuted by user"),t()},UserView.prototype.permaunmute=function(){const{id:e}=this.state.user;he.removeItem({key:e},Q.permaMuteList),App.room.unmute(e),t(),Mo(e)},UserView.prototype.mute=function(){App.room.mute(this.state.user.id),this.setState({muted:!0}),t()},UserView.prototype.unmute=function(){const{id:e}=this.state.user;App.room.unmute(e),this.setState({muted:!1}),t(),Mo(e)}}(),function(){en(),Room.prototype.upload_picture=function(){ze.a.render(Qe(),document.getElementById("ui-hatch-2")),PictureUploader.onUploaded=function(t){var e;if(!RoomClient)return;const n=Ie(t.url,!0);n&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,n))}},Room.prototype.sendRitsuPicture=function(t){this.append(He(t)),App.room.client.speak({message:Ke(t)}),this.scroll()},PictureUpload.prototype.uploadImage=async function(){var t,e;if(!xe())return;const n=null===(t=document.querySelector(".picture-upload-button").files)||void 0===t?void 0:t[0];if(n)try{const t=await Je(n);this.close(),UserProfileReact?bo(t.url):RoomClient&&(null===(e=RoomClient.sendRitsuPicture)||void 0===e||e.call(RoomClient,t))}catch(t){this.setState({failureReason:t instanceof Error?t.message:""+t})}};const t=Room.prototype.received;Room.prototype.received=function(e){var n;const r=t.bind(this),i=null===(n=e.messages)||void 0===n?void 0:n[0];if(!i)return;const s=qe(i);if(s)try{return void r(He(s,e.user))}catch(t){t instanceof Error&&o.error(t.message)}else r(e)}}(),function(){function t(t){const{data:e}=this.state;void 0!==e&&(e.comments.unshift(t.comment.id),this.setState({data:e,compact:this.state.compact,reply:!0}))}function e(t){const e=this.state.data||{microposts:[]};this.setState({data:{microposts:[t.micropost.id,...e.microposts]}})}function n(){return this.state.reply?nt.a.createElement("div",{className:"animated zoomIn user-comment-input-background"},nt.a.createElement("textarea",{className:"user-comment-input",onKeyDown:this.comment_input.bind(this),id:"comment-input",placeholder:"Comment..."})):null}at(_i.a),Room.prototype.input=function(t){const e=$(t.target),n=""+e.val(),o="ArrowUp"===t.key&&this.state.last_message;Si(t)?(this.send(n),this.setState({last_message:n}),e.val(""),e.css("height","34px")):o&&e.val(this.state.last_message),0!==n.length&&n.includes("\n")||e.css("height","34px");const r=e.get(0);r.style.height=r.scrollHeight+"px",document.onpaste=Ti,null===RoomClient||void 0===RoomClient||RoomClient.scroll(),(Si(t)||o)&&t.preventDefault(),Si(t)||App.room.client.typing()},Micropost.prototype.comment_input=function(e){var n;if(!Si(e))return;const o=$(e.target),r=encodeURIComponent(""+o.val());this.setState({data:this.state.data,reply:!1,compact:this.state.compact}),o.val(""),e.preventDefault(),o.trigger("blur");const i=null===(n=this.state.data)||void 0===n?void 0:n.micropost.id;void 0!==i&&$.ajax({type:"GET",url:`/comments_create?id=${i}&content=${r}`,dataType:"json",success:t.bind(this)})},Microposts.prototype.micropost_input=function(t){if(t.target instanceof HTMLInputElement)return;const n=$(t.target),o=encodeURIComponent(""+n.val());if(!Si(t))return;n.val(""),n.trigger("blur"),t.preventDefault();const r=this.props.data.wall_id;$.ajax({type:"GET",url:`/microposts_create?id=${r}&content=${o}`,dataType:"json",success:e.bind(this)})},Microposts.prototype.render=function(){const t=this.state.data?this.state.data.microposts:[],e=nt.a.createElement("div",{className:"user-microposts"},t.map(t=>nt.a.createElement(Micropost,{key:t,data:{id:t}}))),n=nt.a.createElement("div",{className:"user-micropost-input-background"},nt.a.createElement("textarea",{className:"user-micropost-input",onKeyDown:this.micropost_input.bind(this),id:"micropost-input",placeholder:"Say Something..."}));return nt.a.createElement("span",{key:this.props.data.wall_id},n,e)},Micropost.prototype.write_comment=n,Comment.prototype.write_comment=n}(),function(){at(Ii.a),UserProfile.prototype.profile_picture=Fi;const{Comment:t}=k,e=MessageNotificationUnit;Fo(Room,"received",(t,{user:e})=>[Qt(e)]),Fo(Room,"append",(t,{user:e})=>[Qt(e)]),Fo(RoomChannelMembers,"setState",(t,e)=>e&&"members"in e?It(e.members):[]),Fo(UserProfile,"profile_picture",({state:t})=>[t.data.user]),Fo(FriendUnit,"body",t=>[t.props.data]),Fo(t,"render",t=>{var e;return[null===(e=t.state.comment_data)||void 0===e?void 0:e.user]}),Fo(Micropost,"render",t=>{var e;return[null===(e=t.state.data)||void 0===e?void 0:e.author]}),Fo(e,"image",t=>[t.props.data.data.sender]),Fo(Message,"render",t=>[Qt(t.props.data.user)]),Fo(NotificationUnit,"render",t=>[Qt(t.props.data.data.sender)]),Fo(RoomUserUnit,"body",t=>[t.props.data]),Fo(UserUnit,"body",t=>[t.props.data]),Fo(UserView,"top",t=>[t.state.user]),ct(Dashboard.prototype,"render",(function(){App.user.bio&&(this.state.user.display_picture=Do(App.user))}),!0)}(),Hi(),ls(),rs(),function(t){function e(){t.forEach(t=>t())}let n;new MutationObserver(()=>{cancelAnimationFrame(n),n=requestAnimationFrame(e)}).observe(document.body,{subtree:!0,childList:!0}),e()}([xr,hs,Gr,bi,Go,Ir,jo,Rr,oe,Io,$i])}()}]);